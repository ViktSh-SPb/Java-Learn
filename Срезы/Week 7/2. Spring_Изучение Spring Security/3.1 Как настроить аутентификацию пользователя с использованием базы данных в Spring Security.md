# ‚úÖ **–®–ê–ì 1. –°–æ–∑–¥–∞—Ç—å —Å—É—â–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (User Entity)**
–ù–∞–ø—Ä–∏–º–µ—Ä, —Ç–∞–±–ª–∏—Ü–∞ `users`:
```java
@Entity
@Table(name = "users")
public class UserEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.UUID)
    private UUID id;

    private String username;

    private String password;

    private boolean enabled = true;

    @ElementCollection(fetch = FetchType.EAGER)
    @CollectionTable(name = "user_roles", joinColumns = @JoinColumn(name = "user_id"))
    @Column(name = "role")
    private Set<String> roles;
}
```
# ‚úÖ **–®–ê–ì 2. –°–æ–∑–¥–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**
```java
public interface UserRepository extends JpaRepository<UserEntity, UUID> {
    Optional<UserEntity> findByUsername(String username);
}
```
# ‚úÖ **–®–ê–ì 3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `UserDetails`**
Spring Security —Ç—Ä–µ–±—É–µ—Ç –æ–±—ä–µ–∫—Ç, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
```java
public class SecurityUser implements UserDetails {

    private final UserEntity user;

    public SecurityUser(UserEntity user) {
        this.user = user;
    }

    @Override
    public Collection<? extends GrantedAuthority> getAuthorities() {
        return user.getRoles()
            .stream()
            .map(SimpleGrantedAuthority::new)
            .collect(Collectors.toList());
    }

    @Override
    public String getPassword() {
        return user.getPassword();
    }

    @Override
    public String getUsername() {
        return user.getUsername();
    }

    @Override
    public boolean isAccountNonExpired() { return true; }

    @Override
    public boolean isAccountNonLocked() { return true; }

    @Override
    public boolean isCredentialsNonExpired() { return true; }

    @Override
    public boolean isEnabled() { return user.isEnabled(); }
}
```
# ‚úÖ **–®–ê–ì 4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `UserDetailsService`**
```java
@Service
public class CustomUserDetailsService implements UserDetailsService {

    private final UserRepository userRepository;

    public CustomUserDetailsService(UserRepository userRepository) {
        this.userRepository = userRepository;
    }

    @Override
    public UserDetails loadUserByUsername(String username) {
        return userRepository.findByUsername(username)
            .map(SecurityUser::new)
            .orElseThrow(() -> new UsernameNotFoundException("User not found: " + username));
    }
}
```
# ‚úÖ **–®–ê–ì 5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å PasswordEncoder**
–°–∞–º—ã–π –±–µ–∑–æ–ø–∞—Å–Ω—ã–π ‚Äî BCrypt:
```java
@Bean
public PasswordEncoder passwordEncoder() {
    return new BCryptPasswordEncoder();
}
```
# ‚úÖ **–®–ê–ì 6. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å AuthenticationManager —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º UserDetailsService**
–° Spring Security 6 (Spring Boot 3) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∏–Ω `AuthenticationManager`:
```java
@Bean
public AuthenticationManager authenticationManager(
        AuthenticationConfiguration config
) throws Exception {
    return config.getAuthenticationManager();
}
```
# ‚úÖ **–®–ê–ì 7. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SecurityFilterChain**
–≠—Ç–æ –≤–∞—à–∞ –æ—Å–Ω–æ–≤–Ω–∞—è Security-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {

    private final CustomUserDetailsService customUserDetailsService;
    private final PasswordEncoder passwordEncoder;

    public SecurityConfig(CustomUserDetailsService customUserDetailsService,
                          PasswordEncoder passwordEncoder) {
        this.customUserDetailsService = customUserDetailsService;
        this.passwordEncoder = passwordEncoder;
    }

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .csrf(csrf -> csrf.disable())
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/public/**").permitAll()
                .anyRequest().authenticated()
            )
            .userDetailsService(customUserDetailsService)
            .formLogin(withDefaults());

        return http.build();
    }
}
```
# üîê **–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ?**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å.
2. Spring –≤—ã–∑—ã–≤–∞–µ—Ç `UserDetailsService.loadUserByUsername()`.
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ –±–∞–∑—ã.
4. –ü–∞—Ä–æ–ª—å —Å–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ `PasswordEncoder.matches()`.
5. –ï—Å–ª–∏ –æ–∫ ‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è Authentication, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ SecurityContext.
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω.
# ‚≠ê –ü–ª—é—Å: –∫–∞–∫ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª–∏ –≤ –ë–î –±–µ–∑–æ–ø–∞—Å–Ω–æ
–ü–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º:
```java
user.setPassword(passwordEncoder.encode(rawPassword));
userRepository.save(user);
```
# üìå –ò—Ç–æ–≥
–ß—Ç–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ –ë–î –≤ Spring Security, –≤–∞–º –Ω—É–∂–Ω–æ:
1. **–°—É—â–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
2. **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**
3. **–ö–ª–∞—Å—Å UserDetails**
4. **UserDetailsService**
5. **PasswordEncoder**
6. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å SecurityFilterChain**