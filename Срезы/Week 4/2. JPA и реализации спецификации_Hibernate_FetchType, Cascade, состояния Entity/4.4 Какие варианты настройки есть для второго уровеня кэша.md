## üß© –ß—Ç–æ —Ç–∞–∫–æ–µ –≤—Ç–æ—Ä–æ–π —É—Ä–æ–≤–µ–Ω—å –∫—ç—à–∞
**Second Level Cache (L2 Cache)** ‚Äî –æ–±—â–∏–π –∫—ç—à –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏ Hibernate.  
–û–Ω —Ö—Ä–∞–Ω–∏—Ç —Å—É—â–Ω–æ—Å—Ç–∏, –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤, —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –ë–î –ø–æ–≤—Ç–æ—Ä–Ω–æ.
–û–Ω:
- –∂–∏–≤—ë—Ç –¥–æ–ª—å—à–µ, —á–µ–º `Session`,
- –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º (–∫–ª–∞—Å—Ç–µ—Ä–Ω—ã–º),
- –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –ª–æ–≥–∏–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
## ‚öôÔ∏è –û—Å–Ω–æ–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
–ï—Å—Ç—å **4 –∫–ª—é—á–µ–≤—ã—Ö –∞—Å–ø–µ–∫—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Ç–æ—Ä–æ–≥–æ —É—Ä–æ–≤–Ω—è –∫—ç—à–∞**:
1. üîß **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Hibernate**
2. üè∑Ô∏è **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—É—â–Ω–æ—Å—Ç–µ–π –∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π**
3. üí° **–í—ã–±–æ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –∫—ç—à–∞**
4. ‚öôÔ∏è **–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞**
### 1. üîß –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Hibernate
–ê–∫—Ç–∏–≤–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `application.properties` / `hibernate.cfg.xml` / `persistence.xml`:
```properties
# –í–∫–ª—é—á–∞–µ–º 2-–π —É—Ä–æ–≤–µ–Ω—å –∫—ç—à–∞
spring.jpa.properties.hibernate.cache.use_second_level_cache=true

# –í–∫–ª—é—á–∞–µ–º –∫—ç—à –∑–∞–ø—Ä–æ—Å–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
spring.jpa.properties.hibernate.cache.use_query_cache=true

# –£–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∫—ç—à–∞
spring.jpa.properties.hibernate.cache.region.factory_class=org.hibernate.cache.ehcache.EhCacheRegionFactory

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π ‚Äî –∫–∞–∫–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
spring.jpa.properties.javax.persistence.sharedCache.mode=ENABLE_SELECTIVE
```
### 2. üè∑Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—É—â–Ω–æ—Å—Ç–µ–π –∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π
–ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å, –∫–∞–∫–∏–µ –∏–º–µ–Ω–Ω–æ –æ–±—ä–µ–∫—Ç—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è, –∏ –∫–∞–∫:
#### –ü—Ä–∏–º–µ—Ä:
```java
@Entity
@Cache(usage = CacheConcurrencyStrategy.READ_WRITE, region = "userCache")
public class User {
    @Id
    private Long id;
    private String name;

    @OneToMany(mappedBy = "user")
    @Cache(usage = CacheConcurrencyStrategy.NONSTRICT_READ_WRITE)
    private List<Order> orders;
}
```
üìò –ó–¥–µ—Å—å:
- `usage` ‚Äî —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è (—Å–º. –Ω–∏–∂–µ)
- `region` ‚Äî –∏–º—è —Ä–∞–∑–¥–µ–ª–∞ (–º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞–∑–Ω—ã–µ TTL –∏ –æ–±—ä–µ–º –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤)
### 3. üí° –í—ã–±–æ—Ä –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –∫—ç—à–∞
Hibernate –Ω–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç L2-–∫—ç—à —Å–∞–º, –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–≤–Ω–µ—à–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**.  
–°–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã:

|–ü—Ä–æ–≤–∞–π–¥–µ—Ä|–ö–ª–∞—Å—Å —Ñ–∞–±—Ä–∏–∫–∏ (`region.factory_class`)|–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏|
|---|---|---|
|**Ehcache**|`org.hibernate.cache.ehcache.EhCacheRegionFactory`|–ü—Ä–æ—Å—Ç–æ–π, –Ω–∞–¥—ë–∂–Ω—ã–π, —Ñ–∞–π–ª–æ–≤—ã–π –∏–ª–∏ in-memory|
|**Infinispan**|`org.hibernate.cache.infinispan.InfinispanRegionFactory`|–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –∫—ç—à|
|**Hazelcast**|`com.hazelcast.hibernate.HazelcastCacheRegionFactory`|–°–µ—Ç–µ–≤–æ–π, –∫–ª–∞—Å—Ç–µ—Ä–Ω—ã–π, –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤|
|**Caffeine**|`org.hibernate.cache.jcache.JCacheRegionFactory`|–ß–µ—Ä–µ–∑ JCache API, –±—ã—Å—Ç—Ä—ã–π Java-only|
|**Redis (—á–µ—Ä–µ–∑ –∞–¥–∞–ø—Ç–µ—Ä)**|`io.github.jhipster.cache.redis.RedisRegionFactory`|–í–Ω–µ—à–Ω–∏–π, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π, –∫—ç—à –≤–Ω–µ JVM|
### 4. ‚öôÔ∏è –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ (`CacheConcurrencyStrategy`)
–ö–∞–∂–¥–∞—è —Å—É—â–Ω–æ—Å—Ç—å —É–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ Hibernate –±—É–¥–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫—ç—à—É:

|–°—Ç—Ä–∞—Ç–µ–≥–∏—è|–û–ø–∏—Å–∞–Ω–∏–µ|–ì–¥–µ –ø–æ–¥—Ö–æ–¥–∏—Ç|
|---|---|---|
|**READ_ONLY**|–¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ, –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–µ—â–µ–Ω—ã|–°—Ç–∞—Ç–∏—á–Ω—ã–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏, –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã|
|**NONSTRICT_READ_WRITE**|–û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ–¥–∫–∏, –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è "–≥—Ä—è–∑–Ω–æ–µ" —á—Ç–µ–Ω–∏–µ|–ü–æ—á—Ç–∏ —Å—Ç–∞—Ç–∏—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã|
|**READ_WRITE**|–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏|–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –æ–±—ã—á–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π|
|**TRANSACTIONAL**|–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω—ã–π, –¥–ª—è JTA|–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è JTA –∏–ª–∏ –∫–ª–∞—Å—Ç–µ—Ä–Ω—ã–π –∫—ç—à|
## üß± –ü—Ä–∏–º–µ—Ä –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
`application.properties`:
```properties
spring.jpa.properties.hibernate.cache.use_second_level_cache=true
spring.jpa.properties.hibernate.cache.region.factory_class=org.hibernate.cache.jcache.JCacheRegionFactory
spring.jpa.properties.javax.persistence.sharedCache.mode=ENABLE_SELECTIVE
```
`ehcache.xml`:
```xml
<ehcache>
    <cache name="userCache" maxEntriesLocalHeap="1000" timeToLiveSeconds="300"/>
    <cache name="orderCache" maxEntriesLocalHeap="500" timeToLiveSeconds="120"/>
</ehcache>
```
–ö–ª–∞—Å—Å:
```java
@Entity
@Cache(usage = CacheConcurrencyStrategy.READ_WRITE, region = "userCache")
public class User {
    ...
}
```
## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏

|–ü–∞—Ä–∞–º–µ—Ç—Ä|–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ|
|---|---|
|`hibernate.cache.region_prefix`|–ü—Ä–µ—Ñ–∏–∫—Å –¥–ª—è —Ä–µ–≥–∏–æ–Ω–æ–≤ –∫—ç—à–∞|
|`hibernate.cache.use_structured_entries`|–•—Ä–∞–Ω–∏—Ç—å —Å–ª–æ–∂–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∫–∞–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏|
|`hibernate.cache.use_minimal_puts`|–ù–µ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤ –∫—ç—à, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –µ—Å—Ç—å|
|`hibernate.generate_statistics`|–í–∫–ª—é—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫—ç—à-—Ö–∏—Ç–∞–º/–ø—Ä–æ–º–∞—Ö–∞–º|
## üß† –ò—Ç–æ–≥–æ

|–ù–∞—Å—Ç—Ä–æ–π–∫–∞|–ß—Ç–æ –¥–µ–ª–∞–µ—Ç|
|---|---|
|`use_second_level_cache`|–í–∫–ª—é—á–∞–µ—Ç 2-–π —É—Ä–æ–≤–µ–Ω—å –∫—ç—à–∞|
|`use_query_cache`|–í–∫–ª—é—á–∞–µ—Ç –∫—ç—à HQL/Criteria|
|`region.factory_class`|–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∫—ç—à–∞|
|`CacheConcurrencyStrategy`|–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö|
|`region`|–ò–º—è –æ–±–ª–∞—Å—Ç–∏ –∫—ç—à–∞ —Å –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ TTL –∏ –æ–±—ä—ë–º–æ–º|
