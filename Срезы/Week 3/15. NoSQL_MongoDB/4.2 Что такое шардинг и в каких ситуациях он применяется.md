## 1Ô∏è‚É£ **–ß—Ç–æ —Ç–∞–∫–æ–µ —à–∞—Ä–¥–∏–Ω–≥**
**–®–∞—Ä–¥–∏–Ω–≥ (Sharding)** ‚Äî —ç—Ç–æ –º–µ—Ç–æ–¥ **–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è** –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: –¥–∞–Ω–Ω—ã–µ **—Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —á–∞—Å—Ç–∏ (—à–∞—Ä–¥—ã)**, –∫–∞–∂–¥–∞—è –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ –∏–ª–∏ –∫–ª–∞—Å—Ç–µ—Ä–µ.
- –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è –∫–æ–ø–∏—Ä—É–µ—Ç –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –¥–∞–Ω–Ω—ã–µ, —à–∞—Ä–¥–∏–Ω–≥ **–¥–µ–ª–∏—Ç –¥–∞–Ω–Ω—ã–µ**.
- –ö–∞–∂–¥—ã–π —à–∞—Ä–¥ —Å–æ–¥–µ—Ä–∂–∏—Ç **–ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–∏**.
- MongoDB –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **shard key** ‚Äî –ø–æ–ª–µ –∏–ª–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –ø–æ–ª–µ–π, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –¥–∞–Ω–Ω—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –º–µ–∂–¥—É —à–∞—Ä–¥–∞–º–∏.
üìå –ü—Ä–∏–º–µ—Ä: –∫–æ–ª–ª–µ–∫—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –º–∏–ª–ª–∏–æ–Ω–∞–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –ø–æ `user_id` –Ω–∞ 3 —à–∞—Ä–¥–∞:
```
Shard1: user_id 1‚Äì1,000,000
Shard2: user_id 1,000,001‚Äì2,000,000
Shard3: user_id 2,000,001‚Äì3,000,000
```
## 2Ô∏è‚É£ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —à–∞—Ä–¥–∏–Ω–≥–∞ –≤ MongoDB**
```
          +----------------+
          |    –ö–ª–∏–µ–Ω—Ç      |
          +----------------+
                   |
                   v
          +----------------+
          |  Mongos Router |
          +----------------+
            /      |      \
           v       v       v
      +--------+ +--------+ +--------+
      | Shard1 | | Shard2 | | Shard3 |
      +--------+ +--------+ +--------+
```
- **Mongos** ‚Äî –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–æ–≤, –∑–Ω–∞–µ—Ç, –Ω–∞ –∫–∞–∫–æ–π —à–∞—Ä–¥ –ø–æ–ø–∞–¥—ë—Ç –¥–æ–∫—É–º–µ–Ω—Ç.
- **Config Servers** ‚Äî —Ö—Ä–∞–Ω—è—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –æ —à–∞—Ä–¥–∞—Ö –∏ –∫–ª—é—á–∞—Ö.
- **Shards** ‚Äî —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Ö—Ä–∞–Ω—è—Ç –¥–∞–Ω–Ω—ã–µ.
## 3Ô∏è‚É£ **–ö–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —à–∞—Ä–¥–∏–Ω–≥**
- –û—á–µ–Ω—å **–±–æ–ª—å—à–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏**, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø–æ–º–µ—â–∞—é—Ç—Å—è –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ.
- **–í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –∑–∞–ø–∏—Å—å**, –∫–æ–≥–¥–∞ –æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä –Ω–µ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è.
- –°–∏—Ç—É–∞—Ü–∏–∏, –∫–æ–≥–¥–∞ **–Ω—É–∂–Ω–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**.
–ü—Ä–∏–º–µ—Ä:
- –°–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å–µ—Ç—å —Å –º–∏–ª–ª–∏–æ–Ω–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –ø–æ—Å—Ç–æ–≤.
- –ú–∞–≥–∞–∑–∏–Ω —Å –º–∏–ª–ª–∏–æ–Ω–∞–º–∏ –∑–∞–∫–∞–∑–æ–≤ –∏ —Ç–æ–≤–∞—Ä–æ–≤.
## 4Ô∏è‚É£ **–í—ã–±–æ—Ä shard key**
Shard key ‚Äî –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
- –î–æ–ª–∂–µ–Ω **—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ** –º–µ–∂–¥—É —à–∞—Ä–¥–∞–º–∏.
- –ü–æ–ª—è —Å –≤—ã—Å–æ–∫–æ–π –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é (`user_id`, `order_id`) –ø–æ–¥—Ö–æ–¥—è—Ç –ª—É—á—à–µ.
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä shard key ‚Üí **hot shard problem**, –∫–æ–≥–¥–∞ –æ–¥–∏–Ω —à–∞—Ä–¥ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω, –∞ –¥—Ä—É–≥–∏–µ –ø—É—Å—Ç—ã.
## 5Ô∏è‚É£ **–ü–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã —à–∞—Ä–¥–∏–Ω–≥–∞**
### ‚úÖ –ü–ª—é—Å—ã:
- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –Ω–∞–≥—Ä—É–∑–∫–∏.
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å –æ—á–µ–Ω—å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä—ë–º–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö.
- –°–æ–≤–º–µ—Å—Ç–∏–º —Å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π (–∫–∞–∂–¥—ã–π —à–∞—Ä–¥ –º–æ–∂–µ—Ç –±—ã—Ç—å Replica Set).
### ‚ùå –ú–∏–Ω—É—Å—ã:
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è.
- –í—ã–±–æ—Ä shard key –∫—Ä–∏—Ç–∏—á–µ–Ω.
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö ‚Üí hot shard problem.
- –°–ª–æ–∂–Ω–µ–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã, –æ—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏–µ –≤—Å–µ —à–∞—Ä–¥—ã (scatter-gather).
## 6Ô∏è‚É£ **–ò—Ç–æ–≥**
1. **–®–∞—Ä–¥–∏–Ω–≥** = –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —á–∞—Å—Ç–∏.
2. **–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è** –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–∞—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ –Ω–∞ –∑–∞–ø–∏—Å—å.
3. **Shard key** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫ –¥–∞–Ω–Ω—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è.
4. –ö–∞–∂–¥—ã–π —à–∞—Ä–¥ –º–æ–∂–µ—Ç –±—ã—Ç—å **—Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω** –¥–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏.