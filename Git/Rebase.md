# Rebase
**Git rebase** - это мощная команда, которая позволяет перезаписать историю коммитов. Она используется для:
- Изменения порядка коммитов
- Объединения (сквошинга) коммитов
- Удаления или редактирования коммитов
- Переноса ветки на новый базовый коммит (отсюда название - *rebase*)
Когда вы делаете rebase, Git:
1. "Отрезает" ваши коммиты от текущей ветки.
2. Переносит их на указанный коммит (или ветку).
3. Применяет их заново, создавая новые коммиты (с новыми хешами).
Это отличается от `git merge`, который создает новый коммит слияния.
## Базовое использование
### Перебазирование текущей ветки на другую
``` bash
git checkout feature
git rebase main
```
Теперь ветка *feature* будет начинаться с актуального состояния *main*.
### Интерактивный Rebase (-i)
Позволяет редактировать коммиты перед применением:
```bash
git rebase -i HEAD~3 # Редактировать последние 3 коммита
```
Откроется редактор с возможностью:
- **pick** - оставить коммит как есть.
- **reword** - изменить сообщение коммита.
- **edit** - остановиться для внесения изменений.
- **squash** - объединить с предыдущим коммитом.
- **drop** - удалить коммит.
## Примеры использования
### Объединение нескольких коммитов в один
```bash
git rebase -i HEAD~3
```
В редакторе меняем *pick* на *squash* (или *s*) для коммитов, которые нужно объединить.
### Изменить сообщение старого коммита
```bash
git rebase -i HEAD~2
```
В редакторе меняем *pick* на *reword* для нужного коммита.
### Удалить коммит из истории
```bash
git rebase -i HEAD~3
```
В редакторе удаляем строку с ненужным коммитом или меняем *pick* на *drop*
## Rebase vs Merge

| Rebase                        | Merge                     |
| ----------------------------- | ------------------------- |
| Перезаписывает историю        | Сохраняет историю         |
| Делает историю линейной       | Создает коммиты слияния   |
| Опасен для общих веток        | Безопасен для общих веток |
| Лучше для локальных изменений | Лучше для публичных веток |
#### Когда использовать rebase?
- Перед пул-реквестом, чтобы упростить историю.
- Для поддержания чистой линейной истории.
#### Когда использовать merge?
- При слиянии публичных веток (например, *main* и *develop*).
- Если важно сохранить точную историю изменений.
## Опасности Rebase
- Перезаписывает историю - нельзя использовать для уже отправленных в общий репозиторий коммитов.
- Конфликты - при *rebase* может потребоваться разрешать конфликты для каждого коммита.
- Потеря коммитов - если сделать *rebase* неправильно, можно потерять изменения.
### Как отменить rebase?
```bash
git reflog                  # Найти старый HEAD
git reset --hard HEAD@{n}   # Вернуться к нему
```
## Продвинутые сценарии
### Rebase с пропуском коммита
```bash
git rebase --onto main feature~2 feature
```
Переносит ветку *feature* на *main*, пропуская 2 последних коммита
### Автоматический squash при rebase
```bash
git rebase -i --autosquash HEAD~5
```
Автоматически помечает коммиты для squash, если в сообщениях есть *fixup!* или *squash!*.