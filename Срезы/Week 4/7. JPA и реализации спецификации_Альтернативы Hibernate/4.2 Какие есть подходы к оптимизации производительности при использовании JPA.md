## ‚öôÔ∏è 1. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö**
### üîπ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **FetchType.LAZY** –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
–ù–µ –∑–∞–≥—Ä—É–∂–∞–π —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
```java
@OneToMany(fetch = FetchType.LAZY)
private List<Order> orders;
```
> ‚ùó –ó–∞–≥—Ä—É–∂–∞–π –¥–∞–Ω–Ω—ã–µ **—Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –æ–Ω–∏ —Ä–µ–∞–ª—å–Ω–æ –Ω—É–∂–Ω—ã**.  
> –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤—Å—ë —Å—Ä–∞–∑—É ‚Äî –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **fetch join** –∏–ª–∏ **entity graph** (—Å–º. –Ω–∏–∂–µ).
### üîπ –ü—Ä–∏–º–µ–Ω—è—Ç—å **fetch join** –≤ JPQL –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è N+1
```java
@Query("SELECT c FROM Customer c JOIN FETCH c.orders")
List<Customer> findAllWithOrders();
```
> Hibernate –≤—ã–ø–æ–ª–Ω–∏—Ç **–æ–¥–∏–Ω SQL-–∑–∞–ø—Ä–æ—Å** –≤–º–µ—Å—Ç–æ N –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–≤.
### üîπ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Entity Graph** (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–±)
–ü–æ–∑–≤–æ–ª—è–µ—Ç —è–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å, –∫–∞–∫–∏–µ —Å–≤—è–∑–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å.
```java
@EntityGraph(attributePaths = {"orders", "profile"})
List<Customer> findAll();
```
> –£–¥–æ–±–Ω–æ, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –≥–∏–±–∫–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–≥—Ä—É–∑–∫–æ–π –±–µ–∑ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è JPQL.
### üîπ –ò–∑–±–µ–≥–∞—Ç—å —Å–ª–∏—à–∫–æ–º —à–∏—Ä–æ–∫–∏—Ö –≤—ã–±–æ—Ä–æ–∫
‚Äî –ù–µ –¥–µ–ª–∞–π `SELECT *`.  
‚Äî –ó–∞–≥—Ä—É–∂–∞–π **—Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è** —Å –ø–æ–º–æ—â—å—é **DTO-–ø—Ä–æ–µ–∫—Ü–∏–π**:
```java
@Query("SELECT new com.example.dto.UserDto(u.id, u.name) FROM User u")
List<UserDto> findAllUsers();
```
> –£–º–µ–Ω—å—à–∞–µ—Ç –æ–±—ä—ë–º –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ —É—Å–∫–æ—Ä—è–µ—Ç –º–∞–ø–ø–∏–Ω–≥.
## üß† 2. **–†–∞–±–æ—Ç–∞ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º**
### üîπ –í–∫–ª—é—á–∏—Ç—å **–ø–µ—Ä–≤–∏—á–Ω—ã–π –∫—ç—à (Persistence Context)**
–û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç **–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**: –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
### üîπ –î–æ–±–∞–≤–∏—Ç—å **–≤—Ç–æ—Ä–∏—á–Ω—ã–π –∫—ç—à (2nd Level Cache)**
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏.  
–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤:
- **Ehcache**
- **Hazelcast**
- **Infinispan**
```properties
spring.jpa.properties.hibernate.cache.use_second_level_cache=true
spring.jpa.properties.hibernate.cache.region.factory_class=org.hibernate.cache.ehcache.EhCacheRegionFactory
```
> ‚ö†Ô∏è –ü–æ–¥—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–µ–¥–∫–æ –∏–∑–º–µ–Ω—è–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤).
## üß© 3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**
### üîπ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **batch insert / update**
Hibernate –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –º–∞—Å—Å–æ–≤—ã–µ –≤—Å—Ç–∞–≤–∫–∏ –æ–¥–Ω–∏–º –±–∞—Ç—á–µ–º.
```properties
spring.jpa.properties.hibernate.jdbc.batch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
```
> üí° –û—Å–æ–±–µ–Ω–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –±–æ–ª—å—à–æ–≥–æ –æ–±—ä—ë–º–∞ –¥–∞–Ω–Ω—ã—Ö (ETL, –º–∏–≥—Ä–∞—Ü–∏–∏, —Ç–µ—Å—Ç–æ–≤—ã–µ –≤—Å—Ç–∞–≤–∫–∏).
### üîπ –ò–∑–±–µ–≥–∞—Ç—å –ª–∏—à–Ω–∏—Ö `flush()` –∏ `clear()`
–û–Ω–∏ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –ª–∏—à–Ω–∏–º SQL-–∑–∞–ø—Ä–æ—Å–∞–º.
### üîπ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `merge()` –∏ `persist()` –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ
- `persist()` ‚Äî –¥–ª—è –Ω–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤;
- `merge()` ‚Äî –¥–ª—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö, –∏–Ω–∞—á–µ Hibernate –º–æ–∂–µ—Ç —Å–¥–µ–ª–∞—Ç—å –ª–∏—à–Ω–∏–π `SELECT` –ø–µ—Ä–µ–¥ `UPDATE`.
## üìä 4. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —á—Ç–µ–Ω–∏—è (query tuning)**
### üîπ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é (`setMaxResults`, `Pageable`)
```java
Page<User> page = userRepository.findAll(PageRequest.of(0, 50));
```
> –¢–∞–∫ –º–æ–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –≤—ã–±–æ—Ä–∫—É –∏ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç—ã—Å—è—á–∏ –∑–∞–ø–∏—Å–µ–π –≤ –ø–∞–º—è—Ç—å.
### üîπ –ò–Ω–¥–µ–∫—Å—ã –≤ –ë–î
–°–æ–∑–¥–∞–≤–∞–π –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ–ª—è—Ö:
```java
@Table(indexes = @Index(name = "idx_user_email", columnList = "email"))
```
### üîπ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **native query**, –µ—Å–ª–∏ JPQL –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–µ–Ω
–ò–Ω–æ–≥–¥–∞ –ø—Ä–æ—â–µ –∏ –±—ã—Å—Ç—Ä–µ–µ –Ω–∞–ø–∏—Å–∞—Ç—å –Ω–∞—Ç–∏–≤–Ω—ã–π SQL.
```java
@Query(value = "SELECT * FROM users WHERE active = true", nativeQuery = true)
List<User> findActiveUsers();
```
## ‚ö° 5. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏**
- –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π **–¥–ª–∏–Ω—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** ‚Äî —á–µ–º –¥–æ–ª—å—à–µ –æ–Ω–∞ –¥–ª–∏—Ç—Å—è, —Ç–µ–º –±–æ–ª—å—à–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –∏ –∑–∞–¥–µ—Ä–∂–µ–∫.
- –ò–∑–±–µ–≥–∞–π –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ **–≤–Ω–µ @Transactional**, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ `LazyInitializationException`.
- –ò—Å–ø–æ–ª—å–∑—É–π `readOnly = true`, –∫–æ–≥–¥–∞ –∑–∞–ø–∏—Å—å –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è:
    ```java
    @Transactional(readOnly = true)
    public List<User> findAll() { ... }
    ```
## üßÆ 6. **–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞–Ω–∞–ª–∏–∑ SQL**
### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
- `spring.jpa.show-sql=true`
- `hibernate.format_sql=true`
- **p6spy** –∏–ª–∏ **datasource-proxy** ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç SQL –∏ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤.
- **Hibernate Statistics** API (`SessionFactory.getStatistics()`)
> üí° –° –∏—Ö –ø–æ–º–æ—â—å—é –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç—Å–ª–µ–¥–∏—Ç—å N+1 –ø—Ä–æ–±–ª–µ–º—É.
## üíæ 7. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏**

|–ü—Ä–∏—ë–º|–ü–æ–ª—å–∑–∞|
|---|---|
|`@BatchSize(size = N)`|—É–º–µ–Ω—å—à–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ SQL –ø—Ä–∏ –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ|
|`@Cacheable`|–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–¥–∫–æ –∏–∑–º–µ–Ω—è–µ–º—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π|
|DTO + `@Query`|–∏—Å–∫–ª—é—á–∞–µ—Ç –ª–∏—à–Ω–∏–µ —Å–≤—è–∑–∏ –∏ –ª–µ–Ω–∏–≤—ã–µ –∑–∞–≥—Ä—É–∑–∫–∏|
|Use `Stream` API (`@QueryHints`)|—ç–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö|
## üöÄ –ò–¢–û–ì

|–ö–∞—Ç–µ–≥–æ—Ä–∏—è|–¶–µ–ª—å|
|---|---|
|üîç –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö|–ò–∑–±–µ–∂–∞—Ç—å N+1, —É–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤|
|üíæ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ|–°–Ω–∏–∑–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –±–∞–∑—É|
|üßÆ –ë–∞—Ç—á–∏–Ω–≥|–£—Å–∫–æ—Ä–∏—Ç—å –º–∞—Å—Å–æ–≤—ã–µ –≤—Å—Ç–∞–≤–∫–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è|
|‚öôÔ∏è –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏|–ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏|
|üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥|–ù–∞–π—Ç–∏ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞|
