## 1Ô∏è‚É£ –ß—Ç–æ —Ç–∞–∫–æ–µ Entity Graph
**Entity Graph** ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± **–¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ —É–∫–∞–∑–∞—Ç—å**, –∫–∞–∫–∏–µ —Å–≤—è–∑–∏ —Å—É—â–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ –ø–æ–¥–≥—Ä—É–∑–∏—Ç—å —Å—Ä–∞–∑—É –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞.
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å **–ø–æ–¥–≥—Ä—É–∑–∫—É LAZY-–ø–æ–ª–µ–π** –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏—Ö `fetch = LAZY`.
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç **–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é SQL-–∑–∞–ø—Ä–æ—Å–æ–≤** –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç N+1.
## 2Ô∏è‚É£ –ö–∞–∫ Entity Graph —Ä–µ—à–∞–µ—Ç N+1
### üîπ –ü—Ä–æ–±–ª–µ–º–∞ –±–µ–∑ –≥—Ä–∞—Ñ–∞
```java
List<Author> authors = authorRepository.findAll();
for (Author a : authors) {
    a.getBooks().size(); // LAZY ‚Üí –æ—Ç–¥–µ–ª—å–Ω—ã–π SQL –¥–ª—è –∫–∞–∂–¥–æ–π –∫–Ω–∏–≥–∏
}
```
- 1 –∑–∞–ø—Ä–æ—Å –¥–ª—è –∞–≤—Ç–æ—Ä–æ–≤ + N –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∫–Ω–∏–≥ ‚Üí N+1
### üîπ –†–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `@EntityGraph`
```java
@EntityGraph(attributePaths = {"books"})
List<Author> findAll();
```
**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. Hibernate —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç **–æ–¥–∏–Ω SQL-–∑–∞–ø—Ä–æ—Å —Å JOIN**, –ø–æ–¥–≥—Ä—É–∂–∞—è –∞–≤—Ç–æ—Ä–æ–≤ –∏ –∏—Ö –∫–Ω–∏–≥–∏ —Å—Ä–∞–∑—É.
2. N+1 –∑–∞–ø—Ä–æ—Å–æ–≤ –±–æ–ª—å—à–µ –Ω–µ—Ç, —Ç–∞–∫ –∫–∞–∫ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
**SQL –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–æ–π:**
```sql
SELECT a.*, b.*
FROM authors a
LEFT JOIN books b ON a.id = b.author_id;
```
### üîπ –ü–ª—é—Å—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Entity Graph

|–ü–ª—é—Å|–û–±—ä—è—Å–Ω–µ–Ω–∏–µ|
|---|---|
|‚úÖ –†–µ—à–∞–µ—Ç N+1|–í—Å–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Å–≤—è–∑–∏ –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º|
|‚úÖ –ù–µ –º–µ–Ω—è–µ—Ç LAZY|LAZY-—Å–≤—è–∑–∏ –æ—Å—Ç–∞—é—Ç—Å—è –ª–µ–Ω–∏–≤—ã–º–∏ –≤ –¥—Ä—É–≥–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö|
|‚úÖ –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ|–ù–µ –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å JOIN FETCH –≤ –∫–∞–∂–¥–æ–º JPQL-–∑–∞–ø—Ä–æ—Å–µ|
|‚úÖ –ì–∏–±–∫–æ—Å—Ç—å|–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –≥—Ä–∞—Ñ—ã (`@NamedEntityGraph`) –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö|
### üîπ –ü—Ä–∏–º–µ—Ä —Å NamedEntityGraph
```java
@NamedEntityGraph(
    name = "Author.books",
    attributeNodes = @NamedAttributeNode("books")
)
@Entity
public class Author { ... }
```
–ò—Å–ø–æ–ª—å–∑—É–µ–º –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:
```java
@EntityGraph(value = "Author.books")
Optional<Author> findById(Long id);
```
- Hibernate –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç –∫–Ω–∏–≥–∏ –≤–º–µ—Å—Ç–µ —Å –∞–≤—Ç–æ—Ä–æ–º.
- N+1 –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è.
## 3Ô∏è‚É£ –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã
- Entity Graph —Ä–µ—à–∞–µ—Ç **N+1 —Ç–æ–ª—å–∫–æ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω—ã—Ö —Å–≤—è–∑–µ–π**.
- –ú–æ–∂–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —Å DTO –∏–ª–∏ `JOIN FETCH` –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –≤—ã–±–æ—Ä–æ–∫.
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è **Spring Data JPA** –∏ –æ–±—ã—á–Ω–æ–≥–æ `EntityManager`.
### ‚úÖ –ò—Ç–æ–≥
- **Entity Graph** ‚Äî –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–¥–≥—Ä—É–∑–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π.
- –ü–æ–º–æ–≥–∞–µ—Ç **–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å N+1**, —Å–æ—Ö—Ä–∞–Ω—è—è –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ª–µ–Ω–∏–≤—ã–º–∏ —Å–≤—è–∑—è–º–∏.
- –û—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç `JOIN FETCH` —Ç–µ–º, —á—Ç–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–ø–æ–≤—Ç–æ—Ä–Ω–æ** –∏ –Ω–µ –º–µ–Ω—è—Ç—å fetch-—Ç–∏–ø –≤ —Å—É—â–Ω–æ—Å—Ç–∏.