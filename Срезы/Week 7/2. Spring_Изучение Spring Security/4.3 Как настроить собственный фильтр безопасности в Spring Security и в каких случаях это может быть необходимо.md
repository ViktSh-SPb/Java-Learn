# ‚úÖ **–ö–æ–≥–¥–∞ –Ω—É–∂–µ–Ω —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –≤ Spring Security?**
–ö–∞—Å—Ç–æ–º–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∫–æ–≥–¥–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ Spring Security –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ.  
–¢–∏–ø–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏üëá
### üîπ 1. JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ JWT (–∞ –Ω–µ —Å–µ—Å—Å–∏–∏), –Ω—É–∂–µ–Ω —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π `OncePerRequestFilter`, –∫–æ—Ç–æ—Ä—ã–π:
- —á–∏—Ç–∞–µ—Ç `Authorization: Bearer ...`;
- –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω;
- –ø–æ–º–µ—â–∞–µ—Ç `Authentication` –≤ SecurityContext.
### üîπ 2. API-key –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
–ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –ø—Ä–∏—Å—ã–ª–∞–µ—Ç `X-API-KEY`, —Ñ–∏–ª—å—Ç—Ä –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–ª—é—á.
### üîπ 3. –ú–Ω–æ–≥–æ—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (MFA/2FA)
–§–∏–ª—å—Ç—Ä –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å:  
–∫–æ–¥—ã, —Å—Ç–∞—Ç—É—Å—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.
### üîπ 4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ/–∞—É–¥–∏—Ç/—Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
–ù–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–ø–∏—Å–∞—Ç—å –≤ –ª–æ–≥ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ—Å–ª–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.
### üîπ 5. Rate Limiting / Anti-DDOS
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å IP / —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–æ –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä.
### üîπ 6. –û–±—Ä–∞–±–æ—Ç–∫–∞ CORS/CSRF –≤ –æ—Å–æ–±—ã—Ö —Å–ª—É—á–∞—è—Ö
–ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∫–∞—Å—Ç–æ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞.
# üõ† **1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞**
–û–±—ã—á–Ω–æ –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è:
### ‚úî `OncePerRequestFilter` ‚Äî —Å–∞–º—ã–π —É–¥–æ–±–Ω—ã–π
–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ –∑–∞–ø—Ä–æ—Å.
–ü—Ä–∏–º–µ—Ä: —Å–≤–æ–π JWT —Ñ–∏–ª—å—Ç—Ä üëá
```java
@Component
public class JwtAuthFilter extends OncePerRequestFilter {

    private final JwtService jwtService;
    private final UserDetailsService userDetailsService;

    public JwtAuthFilter(JwtService jwtService, UserDetailsService userDetailsService) {
        this.jwtService = jwtService;
        this.userDetailsService = userDetailsService;
    }

    @Override
    protected void doFilterInternal(
            HttpServletRequest request,
            HttpServletResponse response,
            FilterChain filterChain
    ) throws ServletException, IOException {

        String header = request.getHeader("Authorization");

        if (header != null && header.startsWith("Bearer ")) {
            String token = header.substring(7);

            if (jwtService.isValid(token)) {
                String username = jwtService.extractUsername(token);
                UserDetails user = userDetailsService.loadUserByUsername(username);

                UsernamePasswordAuthenticationToken auth =
                        new UsernamePasswordAuthenticationToken(
                                user, null, user.getAuthorities()
                        );

                SecurityContextHolder.getContext().setAuthentication(auth);
            }
        }

        filterChain.doFilter(request, response);
    }
}
```
# üõ† **2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ –≤ Spring Security —Ü–µ–ø–æ—á–∫—É**
–¶–µ–ø–æ—á–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ —Å—Ç—Ä–æ–≥–æ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–∞.
–ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä:
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {

    private final JwtAuthFilter jwtAuthFilter;

    public SecurityConfig(JwtAuthFilter jwtAuthFilter) {
        this.jwtAuthFilter = jwtAuthFilter;
    }

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {

        http
            .csrf(csrf -> csrf.disable())
            .authorizeHttpRequests(auth -> auth
                .anyRequest().authenticated()
            )
            .addFilterBefore(jwtAuthFilter, UsernamePasswordAuthenticationFilter.class);

        return http.build();
    }
}
```
# üìå **3. –ö—É–¥–∞ –≤—Å—Ç–∞–≤–ª—è—Ç—å —Ñ–∏–ª—å—Ç—Ä? –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –º–µ—Å—Ç–∞ –≤ —Ü–µ–ø–æ—á–∫–µ**

|–ö–æ–≥–¥–∞ –≤—Å—Ç–∞–≤–ª—è—Ç—å|–ú–µ—Ç–æ–¥|–ü—Ä–∏–º–µ—Ä|
|---|---|---|
|–ï—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–∫–µ–Ω/–∑–∞–≥–æ–ª–æ–≤–æ–∫|`addFilterBefore(UsernamePasswordAuthenticationFilter.class)`|JWT / API-key|
|–ï—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä –¥–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å —É–∂–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è|`addFilterAfter(UsernamePasswordAuthenticationFilter.class)`|–∞—É–¥–∏—Ç|
|–ß—Ç–æ–±—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä|`addFilterAt(...)`|—Å–≤–æ–∏ –ª–æ–≥–∏–Ω-—Ñ–∏–ª—å—Ç—Ä—ã|
# üéØ **4. –ü—Ä–∏–º–µ—Ä —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ –ª–æ–≥–∏–Ω-—Ñ–∏–ª—å—Ç—Ä–∞ (FormLogin replacement)**
–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∑–∞–º–µ–Ω–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ª–æ–≥–∏–Ω:
```java
public class JsonUsernamePasswordAuthFilter extends UsernamePasswordAuthenticationFilter {

    @Override
    public Authentication attemptAuthentication(...) {
        LoginRequest req = objectMapper.readValue(request.getInputStream(), LoginRequest.class);
        UsernamePasswordAuthenticationToken auth =
                new UsernamePasswordAuthenticationToken(req.getUsername(), req.getPassword());
        return authenticationManager.authenticate(auth);
    }
}
```
–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:
```java
http.addFilterAt(jsonAuthFilter(), UsernamePasswordAuthenticationFilter.class);
```
# üéØ **5. –ü—Ä–∏–º–µ—Ä API-key —Ñ–∏–ª—å—Ç—Ä–∞**
```java
public class ApiKeyFilter extends OncePerRequestFilter {

    @Override
    protected void doFilterInternal(...) {
        String key = request.getHeader("X-API-KEY");

        if ("secret123".equals(key)) {
            Authentication auth = new UsernamePasswordAuthenticationToken("apiClient", null, List.of());
            SecurityContextHolder.getContext().setAuthentication(auth);
        }

        filterChain.doFilter(request, response);
    }
}
```
# üß© –ò—Ç–æ–≥
### –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –Ω—É–∂–µ–Ω, –∫–æ–≥–¥–∞:
- —Ç—Ä–µ–±—É–µ—Ç—Å—è –∫–∞—Å—Ç–æ–º–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (JWT, API key, MFA);
- —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–æ –∏–ª–∏ –ø–æ—Å–ª–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤;
- –Ω—É–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å Spring Security.
### –ß—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä:
- –Ω–∞—Å–ª–µ–¥—É–µ–º `OncePerRequestFilter`
- –ø–∏—à–µ–º —Å–≤–æ—é –ª–æ–≥–∏–∫—É
- –¥–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–ª—å—Ç—Ä –≤ `SecurityFilterChain`