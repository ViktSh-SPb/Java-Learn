## ‚öôÔ∏è –ß—Ç–æ –º—ã —Ö–æ—Ç–∏–º —Ä–µ—à–∏—Ç—å
`LazyInitializationException` –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –∫–æ–≥–¥–∞ –≤—ã –æ–±—Ä–∞—â–∞–µ—Ç–µ—Å—å –∫ –ª–µ–Ω–∏–≤–æ –∑–∞–≥—Ä—É–∂–∞–µ–º–æ–º—É –ø–æ–ª—é 
(–Ω–∞–ø—Ä–∏–º–µ—Ä, `entity.getOrders()`) **–≤–Ω–µ –∞–∫—Ç–∏–≤–Ω–æ–π Hibernate Session**.
–†–µ—à–∏—Ç—å –º–æ–∂–Ω–æ –¥–≤—É–º—è —Å–ø–æ—Å–æ–±–∞–º–∏:
1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–µ–Ω–∏–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–µ—Å—Å–∏–∏**.
2. **–ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –ª–æ–≥–∏–∫—É –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–∏–º**, —á—Ç–æ–±—ã Hibernate –Ω–µ —Ç—Ä–µ–±–æ–≤–∞–ª –ø–æ–¥–≥—Ä—É–∑–∫–∏ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–µ—Å—Å–∏–∏.
## ‚úÖ –°–ø–æ—Å–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è LazyInitializationException
_(–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è `fetch = LAZY`)_
### üîπ 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `JOIN FETCH` –≤ JPQL-–∑–∞–ø—Ä–æ—Å–µ
–°–∞–º—ã–π **—á–∏—Å—Ç—ã–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π** —Å–ø–æ—Å–æ–±.
#### –ü—Ä–∏–º–µ—Ä:
```java
@Query("""
    SELECT a FROM Author a
    LEFT JOIN FETCH a.books
    WHERE a.id = :id
""")
Optional<Author> findByIdWithBooks(@Param("id") Long id);
```
üëâ Hibernate –≤—ã–ø–æ–ª–Ω–∏—Ç –æ–¥–∏–Ω SQL-–∑–∞–ø—Ä–æ—Å —Å `JOIN`, –ø–æ–¥–≥—Ä—É–∑–∏—Ç `books`,  
–∏ –∫–æ–ª–ª–µ–∫—Ü–∏—è –±—É–¥–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –µ—â—ë **–≤–Ω—É—Ç—Ä–∏ —Å–µ—Å—Å–∏–∏**.
üìà –ü–ª—é—Å—ã:
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–∞—è –ø–æ–¥–≥—Ä—É–∑–∫–∞ ‚Äî —Ç–æ–ª—å–∫–æ –≥–¥–µ –Ω—É–∂–Ω–æ.
- –ù–µ—Ç –ª–∏—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
- –†–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ `fetch = LAZY`.
‚ö†Ô∏è –ú–∏–Ω—É—Å—ã:
- –ù–µ–ª—å–∑—è –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ `JOIN FETCH` –Ω–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (–±—É–¥–µ—Ç Cartesian explosion).
- –ù—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã.
### üîπ 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@EntityGraph`
–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ `JOIN FETCH`, –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –≤ JPA.
#### –ü—Ä–∏–º–µ—Ä:
```java
@EntityGraph(attributePaths = {"books"})
@Query("SELECT a FROM Author a WHERE a.id = :id")
Optional<Author> findByIdWithBooks(@Param("id") Long id);
```
–∏–ª–∏:
```java
@EntityGraph(attributePaths = {"books", "publisher"})
Optional<Author> findById(Long id);
```
üìà –ü–ª—é—Å—ã:
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ `JOIN FETCH`.
- –õ–µ–≥–∫–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Ç–æ–¥–∞—Ö.
- –ú–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å —á–µ—Ä–µ–∑ `Spring Data JPA`.
‚ö†Ô∏è –ú–∏–Ω—É—Å—ã:
- –ú–µ–Ω–µ–µ –≥–∏–±–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å SQL, —á–µ–º `JOIN FETCH`.
- –¢–æ–ª—å–∫–æ –¥–ª—è –∑–∞—Ä–∞–Ω–µ–µ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Å–≤—è–∑–µ–π.
### üîπ 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@Transactional` –≤ —Å–µ—Ä–≤–∏—Å–µ
–î–æ—Å—Ç—É–ø –∫ –ª–µ–Ω–∏–≤—ã–º –∫–æ–ª–ª–µ–∫—Ü–∏—è–º **–≤–Ω—É—Ç—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** –±–µ–∑–æ–ø–∞—Å–µ–Ω.
#### –ü—Ä–∏–º–µ—Ä:
```java
@Transactional
public AuthorDto getAuthor(Long id) {
    Author author = authorRepository.findById(id).orElseThrow();
    // –¥–æ—Å—Ç—É–ø –∫ LAZY-–ø–æ–ª—è–º –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–µ–Ω
    author.getBooks().size(); // ‚úÖ Hibernate Session –∞–∫—Ç–∏–≤–Ω–∞
    return mapper.toDto(author);
}
```
üìà –ü–ª—é—Å—ã:
- –ü—Ä–æ—Å—Ç–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–æ –≤—Å–µ—Ö —Å–ª—É—á–∞—è—Ö.
- –ù–µ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∏–ª–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –∑–∞–≥—Ä—É–∑–∫–∏.
‚ö†Ô∏è –ú–∏–Ω—É—Å—ã:
- –ù—É–∂–Ω–æ —á—ë—Ç–∫–æ –ø–æ–Ω–∏–º–∞—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.
- –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –µ—Å–ª–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –ø–æ–ª—è–º —É–∂–µ –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ `@Transactional`.
### üîπ 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Hibernate.initialize()`
–Ø–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–µ–Ω–∏–≤–æ–≥–æ –ø–æ–ª—è –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
#### –ü—Ä–∏–º–µ—Ä:
```java
@Transactional
public Author getAuthor(Long id) {
    Author author = authorRepository.findById(id).orElseThrow();
    Hibernate.initialize(author.getBooks()); // ‚úÖ –ª–µ–Ω–∏–≤–æ–µ –ø–æ–ª–µ –ø–æ–¥–≥—Ä—É–∂–µ–Ω–æ
    return author;
}
```
üìà –ü–ª—é—Å—ã:
- –ú–æ–∂–Ω–æ –≤—ã–±–æ—Ä–æ—á–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è.
- –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ª—é–±—ã—Ö —Ç–∏–ø–æ–≤ —Å–≤—è–∑–µ–π (`@OneToMany`, `@ManyToOne`, `@OneToOne` –∏ —Ç.–¥.).
‚ö†Ô∏è –ú–∏–Ω—É—Å—ã:
- –ü—Ä–∏–≤—è–∑–∞–Ω–æ –∫ Hibernate (–Ω–µ—á–∏—Å—Ç–∞—è JPA).
- –¢—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ –∏ –∑–Ω–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å—É—â–Ω–æ—Å—Ç–∏.
### üîπ 5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DTO / –ø—Ä–æ–µ–∫—Ü–∏–∏ –≤–º–µ—Å—Ç–æ —Å—É—â–Ω–æ—Å—Ç–µ–π
–°–∞–º—ã–π **—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–± –¥–ª—è REST / API**.
#### –ü—Ä–∏–º–µ—Ä:
```java
@Query("""
    SELECT new com.example.dto.AuthorDto(a.name, b.title)
    FROM Author a
    LEFT JOIN a.books b
    WHERE a.id = :id
""")
AuthorDto findAuthorDto(@Param("id") Long id);
```
üìà –ü–ª—é—Å—ã:
- Hibernate –Ω–µ —Å–æ–∑–¥–∞—ë—Ç –ª–µ–Ω–∏–≤—ã–µ –ø—Ä–æ–∫—Å–∏.
- –ù–µ –±—ã–≤–∞–µ—Ç `LazyInitializationException`.
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π SQL (—Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è).
‚ö†Ô∏è –ú–∏–Ω—É—Å—ã:
- –ù—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å DTO –∏ –º–∞–ø–ø–µ—Ä—ã.
- –ù–µ –≤—Å–µ–≥–¥–∞ —É–¥–æ–±–Ω–æ –ø—Ä–∏ —Å–ª–æ–∂–Ω—ã—Ö –≥—Ä–∞—Ñ–∞—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π.
### üîπ 6. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `OpenSessionInView` (OSIV)
–ü–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ—Ä–∂–∞—Ç—å —Å–µ—Å—Å–∏—é –æ—Ç–∫—Ä—ã—Ç–æ–π **–¥–æ –∫–æ–Ω—Ü–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ HTTP-–∑–∞–ø—Ä–æ—Å–∞**,  
–≤–∫–ª—é—á–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é JSON.
#### –ü—Ä–∏–º–µ—Ä (Spring Boot):
```properties
spring.jpa.open-in-view=true
```
üìà –ü–ª—é—Å—ã:
- –ü—Ä–æ—Å—Ç–æ–µ —Ä–µ—à–µ–Ω–∏–µ: Hibernate Session –∂–∏–≤—ë—Ç –¥–æ –∫–æ–Ω—Ü–∞ –∑–∞–ø—Ä–æ—Å–∞.
- –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞.
‚ö†Ô∏è –ú–∏–Ω—É—Å—ã:
- –ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω ‚ùå: —Å–º–µ—à–∏–≤–∞–µ—Ç —Å–ª–æ–∏ (Web ‚Üî Persistence).
- –û–ø–∞—Å–Ω–æ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ LAZY-—Å–≤—è–∑–µ–π (N+1 –∑–∞–ø—Ä–æ—Å—ã).
- –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ / REST API –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ.
### üîπ 7. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `PersistenceUnitUtil.isLoaded()` + —Ä—É—á–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
–ï—Å–ª–∏ –Ω—É–∂–Ω–æ **–ø—Ä–æ–≤–µ—Ä–∏—Ç—å**, –∑–∞–≥—Ä—É–∂–µ–Ω–æ –ª–∏ –ø–æ–ª–µ, –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å.
#### –ü—Ä–∏–º–µ—Ä:
```java
PersistenceUnitUtil util = entityManager.getEntityManagerFactory().getPersistenceUnitUtil();
if (!util.isLoaded(author.getBooks())) {
    Hibernate.initialize(author.getBooks());
}
```
üìà –ü–ª—é—Å—ã:
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–∏—Å–∞—Ç—å ¬´—É–º–Ω—ã–µ¬ª —Å–µ—Ä–≤–∏—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ–µ.
- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ.
‚ö†Ô∏è –ú–∏–Ω—É—Å—ã:
- –û–ø—è—Ç—å –∂–µ, —á–∞—Å—Ç–∏—á–Ω–æ Hibernate-–∑–∞–≤–∏—Å–∏–º–æ.
- –°–ª–æ–∂–Ω–µ–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å.
## üß† –ò—Ç–æ–≥–æ: —Å–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

|–ú–µ—Ç–æ–¥|–¢—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è fetch?|–ü–ª—é—Å—ã|–ú–∏–Ω—É—Å—ã|–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è|
|---|---|---|---|---|
|`JOIN FETCH`|‚ùå|–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ, –≥–∏–±–∫–æ|–†—É—á–Ω–æ–π SQL|90% —Å–ª—É—á–∞–µ–≤|
|`@EntityGraph`|‚ùå|–ß–∏—Å—Ç–æ, –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ|–ú–µ–Ω–µ–µ –≥–∏–±–∫–æ|Spring Data|
|`@Transactional`|‚ùå|–ü—Ä–æ—Å—Ç–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—å —Å–µ—Å—Å–∏–∏|–ù—É–∂–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞|–°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π|
|`Hibernate.initialize()`|‚ùå|–¢–æ—á–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å|Hibernate-–∑–∞–≤–∏—Å–∏–º–æ|–¢–æ—á–µ—á–Ω—ã–µ —Å–ª—É—á–∞–∏|
|DTO / –ø—Ä–æ–µ–∫—Ü–∏–∏|‚ùå|–°–∞–º–æ–µ —á–∏—Å—Ç–æ–µ API|–¢—Ä–µ–±—É–µ—Ç DTO|REST, API|
|`OpenSessionInView`|‚ùå|–ü—Ä–æ—Å—Ç–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ|–ê–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω|Legacy / –∞–¥–º–∏–Ω–∫–∏|
|`isLoaded()` + init|‚ùå|–ì–∏–±–∫–æ|–ú–Ω–æ–≥–æ –∫–æ–¥–∞|–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã|
## üí¨ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –æ—Ç –ø—Ä–∞–∫—Ç–∏–∫–æ–≤
- üîπ –í **–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ** ‚Äî –¥–µ—Ä–∂–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ LAZY –≤–Ω—É—Ç—Ä–∏ `@Transactional`.
- üîπ –í **API / –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö** ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ DTO, –∞ –Ω–µ —Å—É—â–Ω–æ—Å—Ç–∏.
- üîπ –î–ª—è –≤—ã–±–æ—Ä–æ—á–Ω–æ–π –ø–æ–¥–≥—Ä—É–∑–∫–∏ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `JOIN FETCH` –∏–ª–∏ `@EntityGraph`.
- üîπ –ò–∑–±–µ–≥–∞–π—Ç–µ OSIV –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ.