–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∫—ç—à–µ–º –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π –∏–ª–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å—Ä–µ–¥–µ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∏–ø–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º. –°–∞–º–∞—è –∏–∑–≤–µ—Å—Ç–Ω–∞—è ‚Äî **cache stampede**, –Ω–æ –µ—Å—Ç—å –∏ –¥—Ä—É–≥–∏–µ: –≥–æ–Ω–∫–∏ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏, –¥–≤–æ–π–Ω–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ, —Ä–∞–∑–æ–≥—Ä–µ–≤ –∫—ç—à–∞, –Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ —Ç. –¥.
# üß® –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏ –≤ –∫—ç—à–∞—Ö
## 1Ô∏è‚É£ **Cache stampede (—ç—Ñ—Ñ–µ–∫—Ç —Å—Ç–∞–¥–Ω–æ—Å—Ç–∏)**
–°–∏—Ç—É–∞—Ü–∏—è:
- –ö—ç—à –∏—Å—Ç—ë–∫ –∏–ª–∏ –∫–ª—é—á –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
- –ú–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç —ç—Ç–æ –∏ **–≤—Å–µ –Ω–∞—á–∏–Ω–∞—é—Ç –≤—ã—á–∏—Å–ª—è—Ç—å –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –∑–Ω–∞—á–µ–Ω–∏–µ**, –Ω–∞–≥—Ä—É–∂–∞—è –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É.
### üîß –ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å
#### ‚úî _Mutex / Lock –≤–æ–∫—Ä—É–≥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–∞–ø–∏—Å–∏_
–¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ –≤—ã—á–∏—Å–ª—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∂–¥—É—Ç.
–ü—Ä–∏–º–µ—Ä—ã:
- Redis: `SETNX lock_key`
- Redisson: `RLock`
- Guava: `CacheBuilder.withCacheLoader` (–∑–∞–≥—Ä—É–∑–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è)
#### ‚úî _Dogpile prevention (early recomputation)_
–°—É—Ç—å: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è **–¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è TTL**, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –ø—É—Å—Ç–æ–≥–æ –æ–∫–Ω–∞.
–¢–µ—Ö–Ω–∏–∫–∞:
- TTL = 60 —Å–µ–∫—É–Ω–¥
- Soft TTL = 55 —Å–µ–∫—É–Ω–¥  
    –ï—Å–ª–∏ soft TTL –∏—Å—Ç—ë–∫ ‚Üí –ø–µ—Ä–≤—ã–π –ø–æ—Ç–æ–∫ –Ω–∞—á–∏–Ω–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ —Ñ–æ–Ω–µ, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—É—á–∞—é—Ç —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ, –ø–æ–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è.
#### ‚úî _Stale-while-revalidate_
–í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–∞–∂–µ –ø–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è TTL, –∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–¥—ë—Ç –≤ —Ñ–æ–Ω–µ.
–†–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- HTTP Cache-Control: `stale-while-revalidate`
- Redis + Lua-—Å–∫—Ä–∏–ø—Ç
- Spring Cache —Å—Ç–æ—Ä–æ–Ω–Ω–∏–º–∏ —Ä–µ—à–µ–Ω–∏—è–º–∏
## 2Ô∏è‚É£ **Thundering herd (–ª–∞–≤–∏–Ω–∞ –∑–∞–ø—Ä–æ—Å–æ–≤)**
–ü–æ—Ö–æ–∂ –Ω–∞ stampede, –Ω–æ –º–∞—Å—à—Ç–∞–±–Ω–µ–µ:
- –∏—Å—Ç–µ–∫–∞—é—Ç **–º–Ω–æ–≥–∏–µ –∫–ª—é—á–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ**;
- —Ç—ã—Å—è—á–∏ –ø–æ—Ç–æ–∫–æ–≤/—Å–µ—Ä–≤–µ—Ä–æ–≤ –Ω–∞—á–∏–Ω–∞—é—Ç –º–∞—Å—Å–æ–≤–æ –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫—ç—à.
### üîß –ö–∞–∫ –∏–∑–±–µ–≥–∞—Ç—å
‚úî **–†–∞–Ω–¥–æ–º–∏–∑–∞—Ü–∏—è TTL (jitter)**  
–í–º–µ—Å—Ç–æ TTL=60 —Å–µ–∫—É–Ω–¥ ‚Üí TTL = 60 ¬± 10%
‚úî **–ü—Ä–æ–≥—Ä–µ–≤ (warm-up) –∫—ç—à–∞**  
–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–ª—é—á–∏ –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –∑–∞—Ä–∞–Ω–µ–µ.
‚úî **–ü—É–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (batch refresh)**  
–ù–µ—Å–∫–æ–ª—å–∫–æ –∫–ª—é—á–µ–π –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º.
## 3Ô∏è‚É£ **Race conditions –ø—Ä–∏ –∑–∞–ø–∏—Å–∏**
–°–∏—Ç—É–∞—Ü–∏—è:
- –î–≤–∞ –ø–æ—Ç–æ–∫–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ–±–Ω–æ–≤–ª—è—é—Ç –¥–∞–Ω–Ω—ã–µ.
- –û–¥–∏–Ω –ø–∏—à–µ—Ç –≤ –ë–î, –¥—Ä—É–≥–æ–π ‚Äî –≤ –∫—ç—à.
- –í –∏—Ç–æ–≥–µ –∫—ç—à —Å–æ–¥–µ—Ä–∂–∏—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ.
### üîß –ö–∞–∫ –∏–∑–±–µ–≥–∞—Ç—å
‚úî _Write-through / Write-around / Write-behind_ ‚Äî –º–æ–¥–µ–ª–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏  
‚úî _–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ_ –∫–ª—é—á–µ–π (`user:123:v5`)  
‚úî _CAS –æ–ø–µ—Ä–∞—Ü–∏–∏_ (Compare-and-Set), –Ω–∞–ø—Ä–∏–º–µ—Ä –≤ Redis ‚Äî Lua-—Å–∫—Ä–∏–ø—Ç—ã —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≤–µ—Ä—Å–∏–∏
## 4Ô∏è‚É£ **–ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —É–∑–ª–∞–º–∏ (distributed cache inconsistency)**
–ü—Ä–∏—á–∏–Ω–∞: –ª–æ–∫–∞–ª—å–Ω—ã–µ –∫—ç—à–∏ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –∏–Ω—Å—Ç–∞–Ω—Å–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –¥–∞–Ω–Ω—ã—Ö.
### üîß –ö–∞–∫ –∏–∑–±–µ–≥–∞—Ç—å
‚úî **Pub/Sub –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è** (Kafka, Redis PubSub)  
‚úî **Centralized distributed cache** (Redis, Hazelcast, Ignite)  
‚úî **–ö—ç—à —Ç–æ–ª—å–∫–æ –≤ Redis, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–π –ª–æ–∫–∞–ª—å–Ω—ã–π**
## 5Ô∏è‚É£ **Double computation (–¥–≤–æ–π–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)**
–î–∞–∂–µ —Å –ª–æ–∫–∞–º–∏ –≤–æ–∑–º–æ–∂–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞:
- –ü–æ—Ç–æ–∫ 1 –≤—ã—á–∏—Å–ª—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ 500 –º—Å
- –ü–æ—Ç–æ–∫ 2 –∂–¥—ë—Ç, –Ω–æ TTL –∏—Å—Ç–µ–∫–∞–µ—Ç –≤ –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ –∑–Ω–∞—á–µ–Ω–∏–µ —É–∂–µ –∑–∞–ø–∏—Å–∞–Ω–æ
- –ü–æ—Ç–æ–∫ 2 —Ç–æ–∂–µ –Ω–∞—á–∏–Ω–∞–µ—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ
### üîß –†–µ—à–µ–Ω–∏–µ
‚úî –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å lock + stale-while-revalidate  
‚úî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å soft TTL
## 6Ô∏è‚É£ **‚ÄúHot key‚Äù –ø—Ä–æ–±–ª–µ–º–∞**
–ï—Å–ª–∏ –æ–¥–∏–Ω –∫–ª—é—á –æ—á–µ–Ω—å –ø–æ–ø—É–ª—è—Ä–µ–Ω:
- –Ω–∞ –Ω–µ–≥–æ –∏–¥—ë—Ç –æ–≥—Ä–æ–º–Ω—ã–π –ø–æ—Ç–æ–∫ –∑–∞–ø—Ä–æ—Å–æ–≤;
- –∫—ç—à –∏–ª–∏ —Å–µ—Ä–≤–∏—Å-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ø–µ—Ä–µ–≥—Ä–µ—Ç—å—Å—è.
### üîß –ò–∑–±–µ–∂–∞—Ç—å
‚úî —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–∞  
‚úî —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è (Redis cluster, Hazelcast partitioning)  
‚úî —Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–ø–∏–π –∫–ª—é—á–µ–π  
‚úî –∑–∞—â–∏—Ç–∞ "burst limiting" –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
## 7Ô∏è‚É£ **–°–ª–∏—à–∫–æ–º –¥–æ–ª–≥–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (lock contention)**
–ï—Å–ª–∏ –∫–ª—é—á –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–æ–ª–≥–æ, –¥—Ä—É–≥–∏–µ –ø–æ—Ç–æ–∫–∏ –≤–∏—Å—è—Ç –≤ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ.
### üîß –†–µ—à–µ–Ω–∏–µ
‚úî _Lock with timeout_  
‚úî _Async refresh_  
‚úî _–°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∫—ç—à–∞_ (–∞-–ª—è ConcurrentHashMap)  
‚úî _Bulk-loading_
# üß© –ö–∞–∫–∏–µ —Ç–µ—Ö–Ω–∏–∫–∏ –ª—É—á—à–µ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ?
## –î–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º:
- Redis + mutex lock (SETNX + EXPIRE + Lua)
- Stale-while-revalidate
- Jittered TTL
- Pub/Sub –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è
## –î–ª—è Java/Spring –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π:
- Caffeine (`refreshAfterWrite`, `expireAfterWrite`, async refresh)
- Spring Cache + Redis
- Redisson locks