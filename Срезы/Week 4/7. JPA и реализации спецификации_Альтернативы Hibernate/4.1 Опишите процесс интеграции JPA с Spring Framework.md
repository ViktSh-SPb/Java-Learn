–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è **JPA** —Å **Spring Framework** ‚Äî —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º Spring –±–µ—Ä—ë—Ç –Ω–∞ —Å–µ–±—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º `EntityManager`, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –ø–æ–∑–≤–æ–ª—è—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Å—É—â–Ω–æ—Å—Ç—è–º–∏ —á–µ—Ä–µ–∑ **—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏ —Å–µ—Ä–≤–∏—Å—ã**, –Ω–µ —É–ø—Ä–∞–≤–ª—è—è –≤—Ä—É—á–Ω—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π.
## ‚öôÔ∏è 1. –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
> üéØ –¶–µ–ª—å ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ JPA (—Ä–∞–±–æ—Ç–∞ —Å —Å—É—â–Ω–æ—Å—Ç—è–º–∏, ORM, JPQL –∏ —Ç.–¥.) —á–µ—Ä–µ–∑ —É–¥–æ–±–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã Spring (DI, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏).
Spring:
- —Å–æ–∑–¥–∞—ë—Ç –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç `EntityManagerFactory` (—á–µ—Ä–µ–∑ `LocalContainerEntityManagerFactoryBean`);
- —É–ø—Ä–∞–≤–ª—è–µ—Ç `EntityManager` —á–µ—Ä–µ–∑ `@PersistenceContext`;
- —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ —á–µ—Ä–µ–∑ `@Transactional`;
- –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —É–¥–æ–±–Ω—ã–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ (`JpaRepository`, `CrudRepository`).
## üß© 2. –û—Å–Ω–æ–≤–Ω—ã–µ —à–∞–≥–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
### ‚úÖ –®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
**–ü—Ä–∏–º–µ—Ä –¥–ª—è Gradle:**
```groovy
dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    implementation 'org.postgresql:postgresql' // –ª—é–±–æ–π JDBC-–¥—Ä–∞–π–≤–µ—Ä
}
```
### ‚úÖ –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
**application.yml**
```yaml
spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/demo
    username: postgres
    password: password
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: true
    properties:
      hibernate.format_sql: true
```
### ‚úÖ –®–∞–≥ 3: –°–æ–∑–¥–∞—Ç—å —Å—É—â–Ω–æ—Å—Ç–∏
```java
@Entity
@Table(name = "users")
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private String name;
}
```
### ‚úÖ –®–∞–≥ 4: –°–æ–∑–¥–∞—Ç—å JPA-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
Spring –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é.
```java
@Repository
public interface UserRepository extends JpaRepository<User, Long> {
    List<User> findByName(String name);
}
```
### ‚úÖ –®–∞–≥ 5: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ —Å–µ—Ä–≤–∏—Å–µ
```java
@Service
public class UserService {
    private final UserRepository userRepository;

    @Autowired
    public UserService(UserRepository userRepository) {
        this.userRepository = userRepository;
    }

    @Transactional
    public User createUser(String name) {
        User user = new User();
        user.setName(name);
        return userRepository.save(user);
    }

    public List<User> getAll() {
        return userRepository.findAll();
    }
}
```
### ‚úÖ –®–∞–≥ 6: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ (–µ—Å–ª–∏ —ç—Ç–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
```java
@RestController
@RequestMapping("/users")
public class UserController {
    private final UserService userService;

    @Autowired
    public UserController(UserService userService) {
        this.userService = userService;
    }

    @PostMapping
    public User create(@RequestParam String name) {
        return userService.createUser(name);
    }

    @GetMapping
    public List<User> list() {
        return userService.getAll();
    }
}
```
## üß† 3. –ß—Ç–æ –¥–µ–ª–∞–µ—Ç Spring ¬´–∑–∞ –∫—É–ª–∏—Å–∞–º–∏¬ª

|–ö–æ–º–ø–æ–Ω–µ–Ω—Ç|–†–æ–ª—å|
|---|---|
|**EntityManagerFactory**|–°–æ–∑–¥–∞—ë—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä—ã `EntityManager`|
|**EntityManager**|–£–ø—Ä–∞–≤–ª—è–µ—Ç –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —Å—É—â–Ω–æ—Å—Ç–µ–π|
|**JpaTransactionManager**|–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (commit/rollback)|
|**@PersistenceContext**|–í–Ω–µ–¥—Ä—è–µ—Ç `EntityManager`|
|**@Transactional**|–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ä–∞–º–∫–∞—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏|
|**Spring Data JPA**|–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç CRUD-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏|
## üí° 4. –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ JPA —Å Spring
‚úÖ –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (Spring Boot –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç `EntityManagerFactory` –∏ `DataSource`).  
‚úÖ –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é –ø–∏—Å–∞—Ç—å SQL.  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ (`@Transactional`).  
‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JPQL, Criteria API, QueryDSL, Native Query.  
‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏.  
‚úÖ –ü—Ä–æ—Å—Ç–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–ª–∞–≥–æ–¥–∞—Ä—è `@DataJpaTest`.
## ‚ö†Ô∏è 5. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

|–ü—Ä–æ–±–ª–µ–º–∞|–ü—Ä–∏—á–∏–Ω–∞|
|---|---|
|`LazyInitializationException`|–î–æ—Å—Ç—É–ø –∫ –ª–µ–Ω–∏–≤–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏|
|–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ (`No Persistence provider`)|–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω `persistence.xml` –∏–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω –¥—Ä–∞–π–≤–µ—Ä|
|–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π|–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `@Transactional` –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞|
