# üåê **–ß—Ç–æ —Ç–∞–∫–æ–µ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Spring Cloud?**
–≠—Ç–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π **–≤—Å–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –ª–æ–≥–∏ –≤ –µ–¥–∏–Ω–æ–µ –º–µ—Å—Ç–æ** (Logstash, Elasticsearch, Kafka, Loki, Graylog, Splunk –∏ –¥—Ä.), –≥–¥–µ:
- –ª–æ–≥–∏ –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç—Å—è
- –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è
- –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è
- –ø–æ –Ω–∏–º –º–æ–∂–Ω–æ –∏—Å–∫–∞—Ç—å, —Å—Ç—Ä–æ–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏ –∞–ª–µ—Ä—Ç–∏—Ç—å
# üß± **–¢–∏–ø–∏—á–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ª–æ–≥–æ–≤ –≤ Spring Cloud**
```
–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã ‚Üí Logback ‚Üí Logstash (TCP/HTTP/Kafka) ‚Üí Elasticsearch ‚Üí Kibana
```
–∏–ª–∏
```
–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã ‚Üí Loki ‚Üí Grafana
```
–∏–ª–∏
```
–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã ‚Üí Filebeat ‚Üí Elasticsearch
```
–ù–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç–∞, –ø—Ä–æ—Ü–µ—Å—Å –≤ Spring Cloud –ø–æ—Ö–æ–∂.
# üèóÔ∏è **1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–±–æ—Ä—â–∏–∫ –ª–æ–≥–æ–≤)**
–°–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:
### ‚úî ELK Stack
- Elasticsearch ‚Äì —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ª–æ–≥–æ–≤
- Logstash ‚Äì –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–≥–æ–≤
- Kibana ‚Äì –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
### ‚úî EFK Stack
- Elasticsearch
- Fluentd / Fluent Bit
- Kibana
### ‚úî Loki + Grafana
–õ—ë–≥–∫–∞—è –∏ –¥–µ—à–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤ (–ª–æ–≥ –∞–Ω–∞–ª–æ–≥ Prometheus).
# üìù **2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞—Ö (Spring Boot)**
## **2.1. –í–∫–ª—é—á–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å Logstash Encoder (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º Logstash)**
–í `pom.xml`:
```xml
<dependency>
    <groupId>net.logstash.logback</groupId>
    <artifactId>logstash-logback-encoder</artifactId>
    <version>7.4</version>
</dependency>
```
## **2.2. –î–æ–±–∞–≤–∏—Ç—å Logback-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é**
–í `src/main/resources/logback-spring.xml`:
### –í–∞—Ä–∏–∞–Ω—Ç 1: –õ–æ–≥–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤ Logstash –ø–æ TCP
```xml
<configuration>
    <appender name="LOGSTASH" class="net.logstash.logback.appender.LogstashTcpSocketAppender">
        <destination>logstash-host:5000</destination>

        <encoder class="net.logstash.logback.encoder.LogstashEncoder"/>
    </appender>

    <root level="INFO">
        <appender-ref ref="LOGSTASH"/>
    </root>
</configuration>
```
### –í–∞—Ä–∏–∞–Ω—Ç 2: –õ–æ–≥–∏ –ø–∏—à—É—Ç—Å—è –≤ —Ñ–∞–π–ª, –∞ Filebeat –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –¥–∞–ª—å—à–µ:
```xml
<appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
    <file>/logs/app.log</file>
    <encoder>
        <pattern>%d %-5level %logger - %msg%n</pattern>
    </encoder>
</appender>

<root level="INFO">
    <appender-ref ref="FILE"/>
</root>
```
Filebeat –ø–æ—Ç–æ–º –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç —Ñ–∞–π–ª—ã –≤ Elasticsearch/Logstash.
# üîÑ **3. –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤ (–∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è –ª–æ–≥–æ–≤)**
–ß—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –Ω–∞–π—Ç–∏ –ª–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –≤–æ –≤—Å–µ—Ö –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞—Ö.
Spring Cloud Sleuth (–∏–ª–∏ –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤–µ—Ä—Å–∏—è—Ö ‚Äî Micrometer Tracing):
```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-sleuth</artifactId>
</dependency>
```
–≠—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç –¥–≤–∞ ID –≤ –∫–∞–∂–¥—ã–π –ª–æ–≥:
- traceId
- spanId
–ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞:
```
2025-11-21 10:23 INFO [order-service,traceId=abc123,spanId=ff01] Creating order
```
–¢–µ–ø–µ—Ä—å –≤—Å–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –º–æ–∂–Ω–æ —Å–≤—è–∑–∞—Ç—å –≤ –æ–¥–Ω—É —Ü–µ–ø–æ—á–∫—É –≤ Kibana/Grafana.
# üóÉÔ∏è **4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–±–æ—Ä—â–∏–∫–∞**
–ü—Ä–∏–º–µ—Ä –¥–ª—è **Logstash**:
`/etc/logstash/conf.d/01-spring-pipeline.conf`:
```bash
input {
  tcp {
    port => 5000
    codec => json_lines
  }
}

output {
  elasticsearch {
    hosts => ["http://elasticsearch:9200"]
    index => "spring-logs-%{+YYYY.MM.dd}"
  }
}
```
# üìä **5. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è**
## Kibana
- –°–æ–∑–¥–∞—ë–º index pattern: `spring-logs-*`
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ —É—Ä–æ–≤–Ω—é, —Å–µ—Ä–≤–∏—Å—É, traceId
## Grafana (–µ—Å–ª–∏ Loki)
- –ü–æ–¥–∫–ª—é—á–∞–µ–º Loki –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö
- –ü–∏—à–µ–º –∑–∞–ø—Ä–æ—Å—ã:
```
{app="order-service"} |= "error"
```
# üõ°Ô∏è **6. –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –∏ –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏**
### ‚úî –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ JSON-–ª–æ–≥–∏
ELK –∏ Loki —Ä–∞–±–æ—Ç–∞—é—Ç —Å JSON –∏–¥–µ–∞–ª—å–Ω–æ.  
Logstash Encoder —É–∂–µ –≤—ã–≤–æ–¥–∏—Ç JSON.
### ‚úî –î–æ–±–∞–≤–ª—è–π—Ç–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
–ß–µ—Ä–µ–∑ Logback:
```xml
<provider class="net.logstash.logback.composite.GlobalCustomFieldsJsonProvider">
    <customFields>{"service":"order-service"}</customFields>
</provider>
```
### ‚úî –õ–æ–≥–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å PII –∏ —Å–µ–∫—Ä–µ—Ç—ã
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Logstash —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ custom encoder.
### ‚úî –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ –ª–æ–≥–∏ –≤ Logstash —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
–ü—Ä–∏ TCP-–æ—Ç–≤–∞–ª–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç —Ç–æ—Ä–º–æ–∑–∏—Ç—å ‚Üí –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
- async appenders
- Kafka –∫–∞–∫ –±—É—Ñ–µ—Ä
# üß© **7. –ü–æ–ª–Ω—ã–π –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä**
### –í –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–µ:
- logstash-encoder
- logback-spring.xml —Å JSON-–ª–æ–≥–∞–º–∏
- Sleuth/Micrometer Tracing –¥–ª—è traceId
- –æ—Ç–ø—Ä–∞–≤–∫–∞ –ª–æ–≥–æ–≤ –≤ Logstash
### –í –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ:
- Logstash –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ª–æ–≥–∏
- Elasticsearch —Ö—Ä–∞–Ω–∏—Ç
- Kibana –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç
# üìù –ò—Ç–æ–≥
**–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Spring Cloud —Å–æ—Å—Ç–æ–∏—Ç –∏–∑:**
1. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ JSON —á–µ—Ä–µ–∑ Logback
2. –û—Ç–ø—Ä–∞–≤–∫–∞ –ª–æ–≥–æ–≤ –≤ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –ª–æ–≥-—Å–µ—Ä–≤–∏—Å (Logstash/Loki/Filebeat)
3. –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ Sleuth/Micrometer
4. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –ø—Ä–∏—ë–º–∞ –∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ (Elasticsearch, Loki, Kafka)
5. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫ –≤ Kibana/Grafana