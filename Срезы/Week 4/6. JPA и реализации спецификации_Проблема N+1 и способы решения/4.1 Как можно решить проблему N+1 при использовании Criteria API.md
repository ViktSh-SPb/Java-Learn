## 1Ô∏è‚É£ –ü—Ä–∏—á–∏–Ω–∞ N+1 —Å Criteria API
- –ü—Ä–∏ –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ (`fetch = LAZY`) –¥–ª—è –∫–∞–∂–¥–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π SQL-–∑–∞–ø—Ä–æ—Å –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ –∫–æ–ª–ª–µ–∫—Ü–∏—è–º –∏–ª–∏ —Å–≤—è–∑—è–º.
- –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Criteria API –∏ –ø—Ä–æ—Å—Ç–æ –¥–µ–ª–∞—Ç—å `root.select()`, —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –Ω–µ –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
- –ü—Ä–∏–º–µ—Ä:
```java
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<Author> cq = cb.createQuery(Author.class);
Root<Author> root = cq.from(Author.class);
cq.select(root);

List<Author> authors = em.createQuery(cq).getResultList();
for (Author a : authors) {
    a.getBooks().size(); // N+1 –∑–∞–ø—Ä–æ—Å–æ–≤
}
```
## 2Ô∏è‚É£ –†–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `fetch` –≤ Criteria API
- Criteria API –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ–ª–∞—Ç—å **JOIN FETCH —á–µ—Ä–µ–∑ –º–µ—Ç–æ–¥ `fetch()`**:
```java
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<Author> cq = cb.createQuery(Author.class);
Root<Author> root = cq.from(Author.class);

// –ü–æ–¥–≥—Ä—É–∂–∞–µ–º –∫–æ–ª–ª–µ–∫—Ü–∏—é –∫–Ω–∏–≥ —Å—Ä–∞–∑—É
root.fetch("books", JoinType.LEFT);

cq.select(root).distinct(true);

List<Author> authors = em.createQuery(cq).getResultList();
```
**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- Hibernate —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ–¥–∏–Ω SQL-–∑–∞–ø—Ä–æ—Å —Å LEFT JOIN.
- –í—Å–µ –∫–Ω–∏–≥–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –∞–≤—Ç–æ—Ä–∞–º–∏ ‚Üí N+1 –∏—Å—á–µ–∑–∞–µ—Ç.
### üîπ –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã
1. **`distinct(true)`**
    - –ù—É–∂–Ω–æ, –µ—Å–ª–∏ –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –∞–≤—Ç–æ—Ä–æ–≤ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ.
2. **JoinType.LEFT**
    - –ü–æ–¥–≥—Ä—É–∂–∞–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ –∫–æ–ª–ª–µ–∫—Ü–∏—è –ø—É—Å—Ç–∞—è (LEFT JOIN).
    - –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `INNER JOIN`, –µ—Å–ª–∏ –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä—ã —Å –∫–Ω–∏–≥–∞–º–∏.
3. **–ú–æ–∂–Ω–æ –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–≤—è–∑–µ–π**:
```java
root.fetch("books", JoinType.LEFT);
root.fetch("awards", JoinType.LEFT);
```
## 3Ô∏è‚É£ –†–µ—à–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Batch Fetching –∏ Entity Graph
- **Batch Fetching (`@BatchSize`)**
    - –ü–æ–¥–≥—Ä—É–∂–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–µ–Ω–∏–≤—ã—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º.
    - –†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ Criteria API –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞.
- **Entity Graph**
    - –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ `EntityManager` –∏ Criteria API:
```java
EntityGraph<Author> graph = em.createEntityGraph(Author.class);
graph.addAttributeNodes("books");

TypedQuery<Author> query = em.createQuery(cq);
query.setHint("javax.persistence.fetchgraph", graph);
List<Author> authors = query.getResultList();
```
- Hibernate –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç –∫–Ω–∏–≥–∏ –≤–º–µ—Å—Ç–µ —Å –∞–≤—Ç–æ—Ä–∞–º–∏, N+1 —Ä–µ—à–∞–µ—Ç—Å—è.
## 4Ô∏è‚É£ –†–µ–∑—é–º–µ

|–ü–æ–¥—Ö–æ–¥|–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏ Criteria API|–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ|
|---|---|---|
|`fetch()` –≤ Criteria|JOIN FETCH —á–µ—Ä–µ–∑ root.fetch|–û–¥–∏–Ω SQL-–∑–∞–ø—Ä–æ—Å ‚Üí N+1 –∏—Å—á–µ–∑–∞–µ—Ç|
|`distinct(true)`|–î–ª—è –ø–æ–¥–≥—Ä—É–∑–∫–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π|–£–±–∏—Ä–∞–µ—Ç –¥—É–±–ª–∏ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö|
|Batch Fetching (`@BatchSize`)|–ü–æ–¥–≥—Ä—É–∑–∫–∞ –ø–∞–∫–µ—Ç–æ–≤|–ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è Criteria|
|Entity Graph|–£—Å—Ç–∞–Ω–æ–≤–∫–∞ `fetchgraph`|–î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–≥—Ä—É–∑–∫–∞, —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Criteria|
### ‚úÖ –ò—Ç–æ–≥
- **N+1 –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø—Ä–∏ –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–µ**, –¥–∞–∂–µ –≤ Criteria API.
- **JOIN FETCH —á–µ—Ä–µ–∑ `fetch()`** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–± —Ä–µ—à–∏—Ç—å N+1 –≤ Criteria.
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Batch Fetching** –∏–ª–∏ **Entity Graph**.
- DTO-–ø–æ–¥—Ö–æ–¥ —Å Criteria —Ç–æ–∂–µ –ø–æ–º–æ–≥–∞–µ—Ç –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å SQL –∏ –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–∫—Å–∏.