### Что такое immutable (неизменяемые) коллекции в Java?

**Immutable коллекции** — это коллекции, объекты которых нельзя изменить после их создания. После инициализации все операции, которые могли бы изменить содержимое (добавление, удаление, изменение элементов), запрещены или выбрасывают исключения. Такие коллекции обеспечивают безопасность данных и предотвращают непреднамеренные изменения.

---

### Как можно создать immutable список в Java?

В Java существует несколько способов создать immutable список:

1. **Использование `List.of()` (Java 9+):**
```java
List<String> list = List.of("a", "b", "c");
````

Этот список — неизменяемый, попытки модифицировать вызовут `UnsupportedOperationException`.

1. Использование `Collections.unmodifiableList()`:

```java
List<String> modifiableList = new ArrayList<>();
modifiableList.add("a");
List<String> unmodifiableList = Collections.unmodifiableList(modifiableList);
```

Обратите внимание, что если исходный список изменится после создания `unmodifiableList`, изменения будут видны. Для полной неизменяемости создавайте копию.

1. Использование `Collectors.toUnmodifiableList()` (Java 10+):

```java
List<String> list = stream.collect(Collectors.toUnmodifiableList());
```

### Перечислите преимущества использования immutable коллекций

- Безопасность потоков: Не требуют синхронизации при использовании в многопоточной среде.
- Предотвращение ошибок: Исключают случайные или намеренные изменения данных.
- Упрощение отладки: Объекты не меняются после создания, что облегчает отслеживание состояния.
- Кэширование и оптимизация: Можно безопасно кэшировать и делиться между потоками.
- Легкость понимания кода: Повышают читаемость и надежность.

### Какие основные отличия между `Collections.unmodifiableCollection` и `Collections.immutableCollection` в Java?

На самом деле, в стандартной библиотеке Java:

- `Collections.unmodifiableCollection()` — возвращает обертку над существующей коллекцией, которая запрещает модификации через эту обертку. Однако если исходная коллекция изменяется, эти изменения видны через обертку.
    
- В Java 9+ появился метод `Collection.of()` и `List.of()`, которые создают полностью неизменяемые коллекции без возможности их изменения.
    

Важно: В стандартной библиотеке Java нет метода `Collections.immutableCollection()`. Возможно, вы имели в виду сторонние библиотеки или концепцию.

### Как использовать метод `Collectors.toUnmodifiableList()` при работе со Stream API?

Пример использования:

```java
import java.util.List;
import java.util.stream.Collectors;
import java.util.stream.Stream;

public class Example {
    public static void main(String[] args) {
        List<String> list = Stream.of("a", "b", "c")
            .collect(Collectors.toUnmodifiableList());
        // Этот список — неизменяемый
        // list.add("d"); // вызовет UnsupportedOperationException
    }
}
```

Это удобно для получения неизменяемых списков прямо из потоков данных.

### Каковы особенности работы с immutable коллекциями в многопоточной среде?

- Безопасность потоков: Не требуют синхронизации, так как не могут быть изменены после создания.
- Отсутствие гонок данных: Нет риска одновременных изменений, что предотвращает состояние гонки.
- Производительность: Меньше накладных расходов на блокировки.
- Проблемы при необходимости изменений: Для обновления нужно создавать новые экземпляры коллекций, что может быть менее эффективно по сравнению с мутабельными структурами при частых изменениях.

### Какие нововведения связанные с immutable коллекциями были введены в Java 9?

В Java 9 были добавлены статические фабричные методы для создания неизменяемых коллекций:

- `List.of(E... elements)` — создает неизменяемый список.
- `Set.of(E... elements)` — неизменяемое множество.
- `Map.of(K key, V value, ...)` — неизменяемая карта.

Также появились методы:

- `Collectors.toUnmodifiableList()`
- `Collectors.toUnmodifiableSet()`
- `Collectors.toUnmodifiableMap()`

Эти методы позволяют легко создавать неизменяемые коллекции из потоков данных.

### Как реализовать свою immutable коллекцию в Java?

Общий подход:

1. Создайте класс с приватными финальными полями для хранения данных.
2. Не предоставляйте методы для изменения состояния (нет сеттеров).
3. Обеспечьте возвращение копий или только чтение внутренних структур.
4. В конструкторе инициализируйте все поля один раз.
5. Можно реализовать интерфейсы как `Iterable`, чтобы обеспечить доступ к элементам.

Пример:

```java
public final class ImmutablePoint {
    private final int x;
    private final int y;

    public ImmutablePoint(int x, int y) {
        this.x = x;
        this.y = y;
    }

    public int getX() { return x; }
    public int getY() { return y; }
}
```

Для коллекций можно использовать шаблон "копирование при создании" и не предоставлять методы для изменения.

### Какие есть ограничения и недостатки при использовании immutable коллекций в Java?

- Производительность: Создание новых экземпляров при каждом изменении может быть менее эффективно по сравнению с мутабельными структурами.
- Память: Частое создание новых объектов увеличивает использование памяти.
- Гибкость: Невозможно изменить существующую коллекцию без её полного пересоздания.
- Поддержка сторонних библиотек: Не все сторонние библиотеки поддерживают работу с immutable структурами.
- Сложность обновлений: При необходимости часто менять содержимое приходится создавать новые объекты или копии.