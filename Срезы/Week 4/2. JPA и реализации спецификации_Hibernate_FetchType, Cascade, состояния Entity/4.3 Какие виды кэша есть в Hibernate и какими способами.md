## üß© –ß—Ç–æ —Ç–∞–∫–æ–µ –∫—ç—à –≤ Hibernate
**–ö—ç—à Hibernate** ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∞–Ω–µ–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏, —á—Ç–æ–±—ã:
- —Å–Ω–∏–∑–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –ë–î,
- —É—Å–∫–æ—Ä–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã,
- —É–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤.
## üîπ –í–∏–¥—ã –∫—ç—à–µ–π –≤ Hibernate

| –£—Ä–æ–≤–µ–Ω—å             | –ù–∞–∑–≤–∞–Ω–∏–µ               | –û–ø–∏—Å–∞–Ω–∏–µ                                                  | –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è                                  |
| ------------------- | ---------------------- | --------------------------------------------------------- | --------------------------------------------- |
| **–ü–µ—Ä–≤—ã–π —É—Ä–æ–≤–µ–Ω—å**  | **Session Cache**      | –ö—ç—à –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–¥–Ω–æ–π —Å–µ—Å—Å–∏–∏ (`Session` / `EntityManager`) | –í –ø–∞–º—è—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–µ—Å—Å–∏–∏                    |
| **–í—Ç–æ—Ä–æ–π —É—Ä–æ–≤–µ–Ω—å**  | **Second Level Cache** | –û–±—â–∏–π –∫—ç—à –¥–ª—è –≤—Å–µ—Ö —Å–µ—Å—Å–∏–π                                 | –í–Ω–µ—à–Ω–∏–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä (EHCache, Infinispan –∏ –¥—Ä.) |
| üß† **–ö—ç—à –∑–∞–ø—Ä–æ—Å–æ–≤** | **Query Cache**        | –ö—ç—à–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã HQL/Criteria-–∑–∞–ø—Ä–æ—Å–æ–≤                 | –ù–∞–¥ –≤—Ç–æ—Ä—ã–º —É—Ä–æ–≤–Ω–µ–º                            |
## üß± 1. –ü–µ—Ä–≤—ã–π —É—Ä–æ–≤–µ–Ω—å (Session Cache)
‚úÖ **–í–∫–ª—é—á—ë–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.**  
–•—Ä–∞–Ω–∏—Ç –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã, –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `EntityManager` –∏–ª–∏ `Session`.
```java
Session session = sessionFactory.openSession();
User u1 = session.get(User.class, 1L); // SQL –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
User u2 = session.get(User.class, 1L); // –ò–∑ –∫—ç—à–∞, –±–µ–∑ SQL
```
- –ü—Ä–∏–≤—è–∑–∞–Ω –∫ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
- –ü–æ—Å–ª–µ `session.close()` –∫—ç—à –æ—á–∏—â–∞–µ—Ç—Å—è.
- –£–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è Hibernate –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
## üß± 2. –í—Ç–æ—Ä–æ–π —É—Ä–æ–≤–µ–Ω—å (Second Level Cache)
üí° **–ù–µ –≤–∫–ª—é—á—ë–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** ‚Äî –Ω—É–∂–Ω–æ —è–≤–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å.
–ü–æ–∑–≤–æ–ª—è–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏ REST).
### –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `application.properties`:
```properties
spring.jpa.properties.hibernate.cache.use_second_level_cache=true
spring.jpa.properties.hibernate.cache.region.factory_class=org.hibernate.cache.ehcache.EhCacheRegionFactory
spring.jpa.properties.javax.persistence.sharedCache.mode=ENABLE_SELECTIVE
```
### –ü—Ä–∏–º–µ—Ä –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏:
```java
@Entity
@Cache(usage = CacheConcurrencyStrategy.READ_WRITE)
public class User {
    @Id
    private Long id;
    private String name;
}
```
üß© –í–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (`CacheConcurrencyStrategy`):

|–°—Ç—Ä–∞—Ç–µ–≥–∏—è|–û–ø–∏—Å–∞–Ω–∏–µ|
|---|---|
|`READ_ONLY`|–¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ (–±—ã—Å—Ç—Ä–æ, –Ω–æ –±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π)|
|`NONSTRICT_READ_WRITE`|–û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ–¥–∫–∏, –Ω–µ—Ç —Å—Ç—Ä–æ–≥–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏|
|`READ_WRITE`|–û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏|
|`TRANSACTIONAL`|–î–ª—è JTA, –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫—ç—à|
## üß± 3. –ö—ç—à –∑–∞–ø—Ä–æ—Å–æ–≤ (Query Cache)
–ö—ç—à–∏—Ä—É–µ—Ç **—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã HQL –∏–ª–∏ Criteria-–∑–∞–ø—Ä–æ—Å–æ–≤** (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ø–∏—Å–∫–∏ ID —Å—É—â–Ω–æ—Å—Ç–µ–π).  
–†–∞–±–æ—Ç–∞–µ—Ç **–ø–æ–≤–µ—Ä—Ö –≤—Ç–æ—Ä–æ–≥–æ —É—Ä–æ–≤–Ω—è**, –ø–æ—ç—Ç–æ–º—É —Ç—Ä–µ–±—É–µ—Ç –µ–≥–æ –≤–∫–ª—é—á–µ–Ω–∏—è.
### –í–∫–ª—é—á–µ–Ω–∏–µ:
```properties
spring.jpa.properties.hibernate.cache.use_query_cache=true
```
### –ü—Ä–∏–º–µ—Ä:
```java
List<User> users = session
    .createQuery("FROM User", User.class)
    .setCacheable(true)
    .list();
```
‚ö†Ô∏è –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü–µ Hibernate **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç** —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–∞.
## üß© 4. –ö—ç—à –∫–æ–ª–ª–µ–∫—Ü–∏–π (Collection Cache)
–ï—Å–ª–∏ —Å—É—â–Ω–æ—Å—Ç—å —Å–æ–¥–µ—Ä–∂–∏—Ç `@OneToMany`, —Ç–æ –∫–æ–ª–ª–µ–∫—Ü–∏—é –º–æ–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ:
```java
@OneToMany(mappedBy = "user")
@Cache(usage = CacheConcurrencyStrategy.READ_WRITE)
private List<Order> orders;
```
## üí° –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –∫—ç—à–∞
Hibernate –Ω–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å–∞–º –∫—ç—à –≤—Ç–æ—Ä–æ–≥–æ —É—Ä–æ–≤–Ω—è ‚Äî –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–Ω–µ—à–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:

|–ü—Ä–æ–≤–∞–π–¥–µ—Ä|–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞|
|---|---|
|**Ehcache**|–ü—Ä–æ—Å—Ç–æ–π, –Ω–∞–¥—ë–∂–Ω—ã–π, —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è|
|**Infinispan**|–ö–ª–∞—Å—Ç–µ—Ä–Ω—ã–π, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –∫—ç—à|
|**Hazelcast**|–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã—Ö —Å–∏—Å—Ç–µ–º|
|**Caffeine**|–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π, –±—ã—Å—Ç—Ä—ã–π, Java-only|
## üß† –ò—Ç–æ–≥–æ

|–£—Ä–æ–≤–µ–Ω—å|–û–ø–∏—Å–∞–Ω–∏–µ|–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é|–°—Ä–æ–∫ –∂–∏–∑–Ω–∏|
|---|---|---|---|
|1-–π (Session)|–ö—ç—à –≤ —Ä–∞–º–∫–∞—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏|‚úÖ|–î–æ –∑–∞–∫—Ä—ã—Ç–∏—è `Session`|
|2-–π (Shared)|–ö—ç—à –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏|‚ùå|–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è, —Ö—Ä–∞–Ω–∏—Ç—Å—è –¥–æ–ª—å—à–µ|
|Query Cache|–ö—ç—à HQL-–∑–∞–ø—Ä–æ—Å–æ–≤|‚ùå|–¢—Ä–µ–±—É–µ—Ç –≤—Ç–æ—Ä–æ–≥–æ —É—Ä–æ–≤–Ω—è|
|Collection Cache|–ö—ç—à –∫–æ–ª–ª–µ–∫—Ü–∏–π|‚ùå|–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏–µ–π|
