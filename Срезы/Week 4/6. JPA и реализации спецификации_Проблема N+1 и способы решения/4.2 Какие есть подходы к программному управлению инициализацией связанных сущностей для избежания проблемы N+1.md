## üß© –ß—Ç–æ –∑–Ω–∞—á–∏—Ç ‚Äú–ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π‚Äù?
–≠—Ç–æ –∫–æ–≥–¥–∞ –º—ã **–æ—Å–æ–∑–Ω–∞–Ω–Ω–æ —Ä–µ—à–∞–µ–º**, _–∫–æ–≥–¥–∞ –∏ –∫–∞–∫–∏–µ –ª–µ–Ω–∏–≤—ã–µ —Å–≤—è–∑–∏ (LAZY)_ –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å, ‚Äî **–≤ –∫–æ–¥–µ**, –∞ –Ω–µ —á–µ—Ä–µ–∑ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ (`fetch`, `@EntityGraph` –∏ —Ç. –¥.).
–¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–µ–Ω, –∫–æ–≥–¥–∞:
- –Ω—É–∂–Ω–æ –≥–∏–±–∫–æ –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å —Å–≤—è–∑–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏,
- –∏–ª–∏ –∫–æ–≥–¥–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞—Ä–∞–Ω–µ–µ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω—É–∂–Ω—ã–µ —Å–≤—è–∑–∏.
## üîπ 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `JOIN FETCH` –≤ JPQL/HQL (—Ä—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ SQL)
**–°—É—Ç—å:** –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —è–≤–Ω–æ –ø–æ–¥–≥—Ä—É–∂–∞–µ–º —Å–≤—è–∑–∏ –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ.
```java
List<Author> authors = em.createQuery(
    "SELECT a FROM Author a LEFT JOIN FETCH a.books", Author.class
).getResultList();
```
- –ü–æ–¥–≥—Ä—É–∑–∫–∞ —Å–≤—è–∑–µ–π —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫–æ–¥–µ (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å —É—Å–ª–æ–≤–∏—è, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏ —Ç.–¥.).
- Hibernate –¥–µ–ª–∞–µ—Ç –æ–¥–∏–Ω SQL-–∑–∞–ø—Ä–æ—Å ‚Üí **–ø—Ä–æ–±–ª–µ–º–∞ N+1 —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞**.
‚úÖ _–ü–ª—é—Å:_ –≥–∏–±–∫–æ –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ.  
‚ö†Ô∏è _–ú–∏–Ω—É—Å:_ –∫–∞–∂–¥—ã–π —Å–ª—É—á–∞–π –Ω—É–∂–Ω–æ —è–≤–Ω–æ –ø—Ä–æ–ø–∏—Å—ã–≤–∞—Ç—å.
## üîπ 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `EntityGraph` –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ —á–µ—Ä–µ–∑ `EntityManager`
–ú–æ–∂–Ω–æ **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —É–∫–∞–∑–∞—Ç—å**, –∫–∞–∫–∏–µ —Å–≤—è–∑–∏ –ø–æ–¥–≥—Ä—É–∑–∏—Ç—å:
```java
EntityGraph<Author> graph = em.createEntityGraph(Author.class);
graph.addAttributeNodes("books");

Map<String, Object> hints = new HashMap<>();
hints.put("javax.persistence.fetchgraph", graph);

Author author = em.find(Author.class, 1L, hints);
```
- –†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö `find()` –∏–ª–∏ `Criteria API`.
- –ú–æ–∂–Ω–æ —Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ª–æ–≥–∏–∫–∏.
‚úÖ _–ü–ª—é—Å:_ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ.  
‚ö†Ô∏è _–ú–∏–Ω—É—Å:_ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ JPA 2.1+.
## üîπ 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Hibernate.initialize()`
–ü–æ–∑–≤–æ–ª—è–µ—Ç **—è–≤–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–µ–Ω–∏–≤—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏** –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ—Ç–∫—Ä—ã—Ç–æ–π —Å–µ—Å—Å–∏–∏/—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
```java
@Transactional
public Author getAuthorWithBooks(Long id) {
    Author author = authorRepository.findById(id).orElseThrow();
    Hibernate.initialize(author.getBooks()); // –ø–æ–¥–≥—Ä—É–∂–∞–µ–º –ª–µ–Ω–∏–≤–æ–µ –ø–æ–ª–µ
    return author;
}
```
- –ö–æ–≥–¥–∞ –≤–µ—Ä–Ω—ë—Ç—Å—è –æ–±—ä–µ–∫—Ç ‚Äî –∫–æ–ª–ª–µ–∫—Ü–∏—è —É–∂–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞.
- Hibernate –≤—ã–ø–æ–ª–Ω–∏—Ç _–æ–¥–∏–Ω –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π SQL_, –Ω–æ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω ‚Äî –±–µ–∑ N+1.
‚úÖ _–ü–ª—é—Å:_ –º–æ–∂–Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç—Å—è.  
‚ö†Ô∏è _–ú–∏–Ω—É—Å:_ –Ω–µ —Ä–µ—à–∞–µ—Ç N+1 –ø—Ä–∏ –∫–æ–ª–ª–µ–∫—Ü–∏—è—Ö –º–Ω–æ–≥–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π, –µ—Å–ª–∏ –¥–µ–ª–∞—Ç—å –≤ —Ü–∏–∫–ª–µ.
## üîπ 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Subselect` –∏ `BatchSize` (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–¥–≥—Ä—É–∑–∫–∏)
Hibernate —É–º–µ–µ—Ç **–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ª–µ–Ω–∏–≤—ã–µ –∑–∞–≥—Ä—É–∑–∫–∏** –≤ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å:
```java
@OneToMany(fetch = FetchType.LAZY)
@BatchSize(size = 10)
private List<Book> books;
```
–ò–ª–∏ —á–µ—Ä–µ–∑ `@Fetch(FetchMode.SUBSELECT)`:
```java
@OneToMany(fetch = FetchType.LAZY)
@Fetch(FetchMode.SUBSELECT)
private List<Book> books;
```
- Hibernate –¥–µ–ª–∞–µ—Ç –æ–¥–∏–Ω –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –≤—Å–µ—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π, —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ä–∞–Ω–µ–µ.
‚úÖ _–ü–ª—é—Å:_ –ø—Ä–æ—Å—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞, –Ω–∏—á–µ–≥–æ –Ω–µ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å –≤ –∫–æ–¥–µ.  
‚ö†Ô∏è _–ú–∏–Ω—É—Å:_ –≤—Å—ë —Ä–∞–≤–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π SQL (–Ω–æ –Ω–µ N, –∞ –æ–¥–∏–Ω).
## üîπ 5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Criteria API —Å `.fetch()`
–ü—Ä–∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ Criteria API –º–æ–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–¥–≥—Ä—É–∑–∫–æ–π:
```java
CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<Author> cq = cb.createQuery(Author.class);
Root<Author> root = cq.from(Author.class);

root.fetch("books", JoinType.LEFT);
cq.select(root).distinct(true);

List<Author> authors = em.createQuery(cq).getResultList();
```
- Hibernate –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–¥–∏–Ω SQL —Å JOIN.
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –∏–∑–±–µ–≥–∞–µ–º N+1 –¥–∞–∂–µ –ø—Ä–∏ —Å–ª–æ–∂–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–∞—Ö.
‚úÖ _–ü–ª—é—Å:_ –≥–∏–±–∫–æ, –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤.  
‚ö†Ô∏è _–ú–∏–Ω—É—Å:_ –±–æ–ª–µ–µ –º–Ω–æ–≥–æ—Å–ª–æ–≤–Ω—ã–π API.
## üîπ 6. DTO-–ø–æ–¥—Ö–æ–¥ (–ø—Ä–æ–≥—Ä–∞–º–º–Ω–∞—è –ø—Ä–æ–µ–∫—Ü–∏—è)
–ö–æ–≥–¥–∞ –º—ã —è–≤–Ω–æ –≤—ã–±–∏—Ä–∞–µ–º –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è –≤ JPQL –∏–ª–∏ Criteria –∏ **–Ω–µ —Ä–∞–±–æ—Ç–∞–µ–º —Å —Å—É—â–Ω–æ—Å—Ç—è–º–∏** (–∞ –∑–Ω–∞—á–∏—Ç, –∏ —Å –ª–µ–Ω–∏–≤—ã–º–∏ –ø—Ä–æ–∫—Å–∏ —Ç–æ–∂–µ):
```java
@Query("SELECT new com.example.dto.AuthorDto(a.name, b.title) " +
       "FROM Author a LEFT JOIN a.books b")
List<AuthorDto> findAllAuthorsWithBooks();
```
‚úÖ _–ü–ª—é—Å:_ –Ω–∏–∫–∞–∫–æ–π –ª–µ–Ω–∏–≤–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Üí –Ω–µ—Ç N+1 –≤–æ–æ–±—â–µ.  
‚ö†Ô∏è _–ú–∏–Ω—É—Å:_ —ç—Ç–æ –Ω–µ —Å—É—â–Ω–æ—Å—Ç–∏, –∞ –ø—Ä–æ–µ–∫—Ü–∏–∏ (–Ω–µ–ª—å–∑—è –¥–µ–ª–∞—Ç—å merge/persist).
## üîπ 7. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `PersistenceUnitUtil#isLoaded()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
–ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ **—É—Å–ª–æ–≤–Ω–æ –ø–æ–¥–≥—Ä—É–∑–∏—Ç—å** –∫–æ–ª–ª–µ–∫—Ü–∏—é —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω–∞ –µ—â—ë –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞:
```java
Author author = repository.findById(id).orElseThrow();
if (!em.getEntityManagerFactory().getPersistenceUnitUtil().isLoaded(author.getBooks())) {
    Hibernate.initialize(author.getBooks());
}
```
‚úÖ _–ü–ª—é—Å:_ –≥–∏–±–∫–æ ‚Äî –ø–æ–¥–≥—Ä—É–∂–∞–µ—à—å —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.  
‚ö†Ô∏è _–ú–∏–Ω—É—Å:_ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è.
## ‚úÖ –†–µ–∑—é–º–µ: –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π

|–ü–æ–¥—Ö–æ–¥|–û–ø–∏—Å–∞–Ω–∏–µ|–£—Å—Ç—Ä–∞–Ω—è–µ—Ç N+1?|–ü—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å|
|---|---|---|---|
|**JOIN FETCH (JPQL)**|–û–¥–∏–Ω SQL —Å –ø–æ–¥–≥—Ä—É–∑–∫–æ–π —Å–≤—è–∑–µ–π|‚úÖ –î–∞|–ü—Ä–æ—Å—Ç—ã–µ –∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã|
|**EntityGraph (programmatic)**|–£–∫–∞–∑–∞–Ω–∏–µ –ø–æ–¥–≥—Ä—É–∂–∞–µ–º—ã—Ö —Å–≤—è–∑–µ–π —á–µ—Ä–µ–∑ `EntityManager`|‚úÖ –î–∞|–ì–∏–±–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã|
|**Hibernate.initialize()**|–Ø–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏|‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ|–î–ª—è –µ–¥–∏–Ω–∏—á–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π|
|**BatchSize / SUBSELECT**|–ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –ª–µ–Ω–∏–≤—ã–µ –∑–∞–≥—Ä—É–∑–∫–∏|‚úÖ –î–∞ (—á–∞—Å—Ç–∏—á–Ω–æ)|–ú–∞—Å—Å–æ–≤—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏|
|**Criteria API `.fetch()`**|JOIN —á–µ—Ä–µ–∑ Criteria|‚úÖ –î–∞|–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã|
|**DTO / –ø—Ä–æ–µ–∫—Ü–∏–∏**|–¢–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –±–µ–∑ –ª–µ–Ω–∏–≤—ã—Ö –ø–æ–ª–µ–π|‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é|REST / –æ—Ç—á—ë—Ç—ã|
|**isLoaded() + initialize()**|–£—Å–ª–æ–≤–Ω–∞—è –ø–æ–¥–≥—Ä—É–∑–∫–∞|‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ|–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏|
