## 1Ô∏è‚É£ –ü–æ–¥–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —ç—Ç–∞–ø–µ –∑–∞–ø—Ä–æ—Å–∞
### üîπ 1. `JOIN FETCH`
–ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–¥–≥—Ä—É–∑–∏—Ç—å –ª–µ–Ω–∏–≤—ã–µ —Å–≤—è–∑–∏ **–æ–¥–Ω–∏–º SQL-–∑–∞–ø—Ä–æ—Å–æ–º**, –≤–º–µ—Å—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (N+1 problem).
#### –ü—Ä–∏–º–µ—Ä:
```java
@Query("SELECT a FROM Author a LEFT JOIN FETCH a.books WHERE a.id = :id")
Author findByIdWithBooks(@Param("id") Long id);
```
**–ü–ª—é—Å—ã:**
- –ò–∑–±–µ–≥–∞–µ–º LazyInitializationException.
- –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤.
**–ú–∏–Ω—É—Å—ã:**
- JOIN –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥—É–±–ª–∏, –µ—Å–ª–∏ –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–ª–ª–µ–∫—Ü–∏–π (cartesian product).
- –ù–µ –≤—Å–µ–≥–¥–∞ —É–¥–æ–±–Ω–æ –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π.
### üîπ 2. `@EntityGraph`
–î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º, –∫–∞–∫–∏–µ —Å–≤—è–∑–∏ –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å:
```java
@EntityGraph(attributePaths = {"books"})
Optional<Author> findById(Long id);
```
**–ü–ª—é—Å—ã:**
- –ß–∏—Å—Ç–æ, –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ.
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è REST API –∏ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ —Å–ª–æ—è.
- –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã.
**–ú–∏–Ω—É—Å—ã:**
- –ú–µ–Ω–µ–µ –≥–∏–±–∫–æ, —á–µ–º JOIN FETCH —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π.
- –ú–æ–∂–Ω–æ –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø—É—Ç–∏.
### üîπ 3. Batch Fetching (–ø–∞–∫–µ—Ç–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)
–ï—Å–ª–∏ –µ—Å—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ª–µ–Ω–∏–≤—ã—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π, Hibernate –º–æ–∂–µ—Ç –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å –∏—Ö **–ø–∞–∫–µ—Ç–∞–º–∏**, –∞ –Ω–µ –ø–æ –æ–¥–Ω–æ–º—É.
```java
@OneToMany(fetch = FetchType.LAZY)
@BatchSize(size = 10)
private List<Book> books;
```
- Hibernate –≤—ã–ø–æ–ª–Ω—è–µ—Ç **–æ–¥–∏–Ω SQL –¥–ª—è 10 –∫–æ–ª–ª–µ–∫—Ü–∏–π —Å—Ä–∞–∑—É**, –∞ –Ω–µ N SQL.
- –°–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –±–∞–∑—É –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –±–æ–ª—å—à–∏–º–∏ —Å–ø–∏—Å–∫–∞–º–∏.
## 2Ô∏è‚É£ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ DTO –∏ –ø—Ä–æ–µ–∫—Ü–∏–π
### üîπ 1. Projection DTO
- –í–º–µ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å—É—â–Ω–æ—Å—Ç–µ–π, —Ñ–æ—Ä–º–∏—Ä—É–µ–º DTO —Å –Ω—É–∂–Ω—ã–º–∏ –ø–æ–ª—è–º–∏:
```java
@Query("SELECT new com.example.dto.AuthorDto(a.name, b.title) FROM Author a LEFT JOIN a.books b WHERE a.id = :id")
AuthorDto findAuthorDtoById(@Param("id") Long id);
```
**–ü–ª—é—Å—ã:**
- –ù–µ—Ç –ª–µ–Ω–∏–≤—ã—Ö –ø—Ä–æ–∫—Å–∏ ‚Üí LazyInitializationException –∏—Å–∫–ª—é—á—ë–Ω.
- –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è ‚Üí –º–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã ‚Üí –≤—ã—à–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.
### üîπ 2. Spring Data JPA Interface-based Projection
```java
public interface AuthorSummary {
    String getName();
    List<String> getBookTitles();
}
```
- Hibernate —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç SQL, –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–æ–ª—è.
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –¥–ª—è REST API.
## 3Ô∏è‚É£ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `@Transactional` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–µ–π
- –î–µ—Ä–∂–∏–º **—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –æ—Ç–∫—Ä—ã—Ç–æ–π**, –ø–æ–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ª–µ–Ω–∏–≤—ã–µ –ø–æ–ª—è.
- –ú–æ–∂–Ω–æ —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å `Hibernate.initialize()`:
```java
@Transactional
public Author getAuthor(Long id) {
    Author author = authorRepository.findById(id).orElseThrow();
    Hibernate.initialize(author.getBooks());
    return author;
}
```
**–ú–∏–Ω—É—Å—ã:**
- –î–µ—Ä–∂–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –¥–æ–ª–≥–æ –ø–ª–æ—Ö–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–æ—Å–æ–±–µ–Ω–Ω–æ –≤ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö).
- –õ—É—á—à–µ –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –Ω—É–∂–Ω–æ.
## 4Ô∏è‚É£ Lazy vs Eager ‚Äî –æ—Å–æ–∑–Ω–∞–Ω–Ω—ã–π –≤—ã–±–æ—Ä
- **–ù–µ –º–µ–Ω—è–π—Ç–µ –≤—Å–µ LAZY –Ω–∞ EAGER** ‚Äî —ç—Ç–æ —Å–∏–ª—å–Ω–æ —Å–Ω–∏–∂–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–≤—Å–µ —Å–≤—è–∑–∏ –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è –≤—Å–µ–≥–¥–∞).
- –í—ã–±–∏—Ä–∞–π—Ç–µ **EAGER —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö 1:1 —Å–≤—è–∑–µ–π**, –∫–æ—Ç–æ—Ä—ã–µ –≤—Å–µ–≥–¥–∞ –Ω—É–∂–Ω—ã.
- –î–ª—è –∫–æ–ª–ª–µ–∫—Ü–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **LAZY + JOIN FETCH / DTO**.
## 5Ô∏è‚É£ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
### üîπ 1. 1-–π —É—Ä–æ–≤–µ–Ω—å (Session cache)
- Hibernate –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫—ç—à–∏—Ä—É–µ—Ç —Å—É—â–Ω–æ—Å—Ç–∏ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π —Å–µ—Å—Å–∏–∏ ‚Üí –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –Ω–µ –¥–µ–ª–∞—é—Ç –∑–∞–ø—Ä–æ—Å—ã.
### üîπ 2. 2-–π —É—Ä–æ–≤–µ–Ω—å (Second-level cache)
- –ú–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –∫—ç—à (Ehcache, Redis, Infinispan) –¥–ª—è –∫–æ–ª–ª–µ–∫—Ü–∏–π –∏ —Å—É—â–Ω–æ—Å—Ç–µ–π:
```properties
spring.jpa.properties.hibernate.cache.use_second_level_cache=true
spring.jpa.properties.hibernate.cache.region.factory_class=org.hibernate.cache.jcache.JCacheRegionFactory
```
**–ü–ª—é—Å—ã:**
- –ú–µ–Ω—å—à–µ SQL.
- –ú–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å LAZY-–ø–æ–ª—è–º–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ.
## 6Ô∏è‚É£ Open Session In View (OSIV) ‚Äî –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ
- –î–µ—Ä–∂–∏—Ç —Å–µ—Å—Å–∏—é –æ—Ç–∫—Ä—ã—Ç–æ–π –¥–æ –∫–æ–Ω—Ü–∞ HTTP-–∑–∞–ø—Ä–æ—Å–∞.
- –õ–µ–≥–∫–æ —Ä–µ—à–∞–µ—Ç LazyInitializationException, –Ω–æ **—Å–æ–∑–¥–∞—ë—Ç N+1 –∑–∞–ø—Ä–æ—Å—ã –∏ —Å–º–µ—à–∏–≤–∞–µ—Ç —Å–ª–æ–∏**.
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö MVC-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –∞ –¥–ª—è REST –ª—É—á—à–µ DTO.
## 7Ô∏è‚É£ –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
–î–ª—è REST API –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —á–∞—â–µ –≤—Å–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–æ–º–±–∏–Ω–∞—Ü–∏—é:
1. **LAZY –ø–æ–ª—è –≤ —Å—É—â–Ω–æ—Å—Ç—è—Ö** (–Ω–µ EAGER)
2. **DTO –∏–ª–∏ –ø—Ä–æ–µ–∫—Ü–∏–∏** –¥–ª—è API
3. **JOIN FETCH / @EntityGraph** –¥–ª—è –ø–æ–¥–≥—Ä—É–∑–∫–∏ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. **Batch fetch / second-level cache** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤