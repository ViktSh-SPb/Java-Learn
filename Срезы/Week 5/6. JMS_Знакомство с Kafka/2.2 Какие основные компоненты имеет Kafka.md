## üß© **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Apache Kafka**
### 1Ô∏è‚É£ **Producer (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å)**
- –≠—Ç–æ **–∫–ª–∏–µ–Ω—Ç—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**, –∫–æ—Ç–æ—Ä–æ–µ **–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è (—Å–æ–±—ã—Ç–∏—è)** –≤ Kafka.
- –ü—Ä–æ–¥—é—Å–µ—Ä —Å–∞–º –≤—ã–±–∏—Ä–∞–µ—Ç, –≤ –∫–∞–∫–æ–π **—Ç–æ–ø–∏–∫** –∏ **–ø–∞—Ä—Ç–∏—Ü–∏—é** –ø–æ–º–µ—Å—Ç–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ.
- –ú–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–∫–ª—é—á** (key), —á—Ç–æ–±—ã Kafka –ø–æ–º–µ—â–∞–ª–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –∫–ª—é—á–æ–º –≤ –æ–¥–Ω—É –ø–∞—Ä—Ç–∏—Ü–∏—é (—Å–æ—Ö—Ä–∞–Ω—è—è –ø–æ—Ä—è–¥–æ–∫).
üìò _–ü—Ä–∏–º–µ—Ä:_  
–°–µ—Ä–≤–∏—Å –∑–∞–∫–∞–∑–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ `"OrderCreated"` –≤ —Ç–æ–ø–∏–∫ `orders`.
### 2Ô∏è‚É£ **Topic (—Ç–æ–ø–∏–∫)**
- –û—Å–Ω–æ–≤–Ω–∞—è **–ª–æ–≥–∏—á–µ—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π** ‚Äî –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö, –∫—É–¥–∞ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∏ –æ—Ç–∫—É–¥–∞ —á–∏—Ç–∞—é—Ç—Å—è —Å–æ–±—ã—Ç–∏—è.
- –¢–æ–ø–∏–∫ –º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ "–ø–∞–ø–∫—É", –≤ –∫–æ—Ç–æ—Ä—É—é —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è.
- –ö–∞–∂–¥—ã–π —Ç–æ–ø–∏–∫ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ **–ø–∞—Ä—Ç–∏—Ü–∏–∏** (—Å–º. –Ω–∏–∂–µ).
üìò _–ü—Ä–∏–º–µ—Ä:_  
–¢–æ–ø–∏–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å `orders`, `payments`, `notifications`.
### 3Ô∏è‚É£ **Partition (–ø–∞—Ä—Ç–∏—Ü–∏—è)**
- –≠—Ç–æ **—Ñ–∏–∑–∏—á–µ—Å–∫–∏–π —à–∞—Ä–¥ (—Ä–∞–∑–¥–µ–ª)** —Ç–æ–ø–∏–∫–∞, –∫–æ—Ç–æ—Ä—ã–π —Ö—Ä–∞–Ω–∏—Ç **—É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω—ã–µ, –Ω–µ–∏–∑–º–µ–Ω—è–µ–º—ã–µ** –∑–∞–ø–∏—Å–∏.
- –ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–∞–µ—Ç **offset** ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ø–∞—Ä—Ç–∏—Ü–∏–∏.
- –ü–∞—Ä—Ç–∏—Ü–∏–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç Kafka:
    - –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏;
    - —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è–º–∏.
üìò _–í–∞–∂–Ω–æ:_ –ø–æ—Ä—è–¥–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏**.
### 4Ô∏è‚É£ **Broker (–±—Ä–æ–∫–µ—Ä)**
- –≠—Ç–æ **—Å–µ—Ä–≤–µ—Ä Kafka**, –∫–æ—Ç–æ—Ä—ã–π —Ö—Ä–∞–Ω–∏—Ç –ø–∞—Ä—Ç–∏—Ü–∏–∏ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ–¥—é—Å–µ—Ä–æ–≤ –∏ –∫–æ–Ω—Å—É–º–µ—Ä–æ–≤.
- –û–¥–∏–Ω –±—Ä–æ–∫–µ—Ä –º–æ–∂–µ—Ç –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å **–¥–µ—Å—è—Ç–∫–∏ —Ç—ã—Å—è—á –ø–∞—Ä—Ç–∏—Ü–∏–π**.
- –û–±—ã—á–Ω–æ Kafka ‚Äî —ç—Ç–æ **–∫–ª–∞—Å—Ç–µ—Ä –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –±—Ä–æ–∫–µ—Ä–æ–≤**.
üìò _–ü—Ä–∏–º–µ—Ä:_  
–ö–ª–∞—Å—Ç–µ—Ä –∏–∑ 3 –±—Ä–æ–∫–µ—Ä–æ–≤ —Ö—Ä–∞–Ω–∏—Ç 6 –ø–∞—Ä—Ç–∏—Ü–∏–π —Ç–æ–ø–∏–∫–∞:
- broker1 ‚Üí partitions 0, 1
- broker2 ‚Üí partitions 2, 3
- broker3 ‚Üí partitions 4, 5
### 5Ô∏è‚É£ **Cluster (–∫–ª–∞—Å—Ç–µ—Ä)**
- –ù–∞–±–æ—Ä –±—Ä–æ–∫–µ—Ä–æ–≤, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –∫–∞–∫ **–µ–¥–∏–Ω–∞—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞**.
- Kafka –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ **—Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç** –ø–∞—Ä—Ç–∏—Ü–∏–∏ –º–µ–∂–¥—É –±—Ä–æ–∫–µ—Ä–∞–º–∏ –¥–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏.
- –û–¥–∏–Ω –∏–∑ –±—Ä–æ–∫–µ—Ä–æ–≤ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è **Controller**, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–ø–ª–∏–∫–∞–º–∏ –∏ –ª–∏–¥–µ—Ä—Å—Ç–≤–æ–º –ø–∞—Ä—Ç–∏—Ü–∏–π.
üìò _–ò—Ç–æ–≥:_ –∫–ª–∞—Å—Ç–µ—Ä Kafka = –Ω–µ—Å–∫–æ–ª—å–∫–æ –±—Ä–æ–∫–µ—Ä–æ–≤ + ZooKeeper (–∏–ª–∏ KRaft, –≤ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏—è—Ö).
### 6Ô∏è‚É£ **Consumer (–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å)**
- –≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ **—á–∏—Ç–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è** –∏–∑ Kafka.
- –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤ **Consumer Group (–≥—Ä—É–ø–ø—É)**.
- –ö–∞–∂–¥–∞—è –ø–∞—Ä—Ç–∏—Ü–∏—è —Ç–æ–ø–∏–∫–∞ **–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∏–º –∫–æ–Ω—Å—É–º–µ—Ä–æ–º –≤ –≥—Ä—É–ø–ø–µ** ‚Äî —ç—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É.
üìò _–ü—Ä–∏–º–µ—Ä:_  
3 –∫–æ–Ω—Å—É–º–µ—Ä–∞ –≤ –æ–¥–Ω–æ–π –≥—Ä—É–ø–ø–µ —á–∏—Ç–∞—é—Ç —Ç–æ–ø–∏–∫ —Å 6 –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏ ‚Üí –ø–æ 2 –ø–∞—Ä—Ç–∏—Ü–∏–∏ –∫–∞–∂–¥–æ–º—É.
### 7Ô∏è‚É£ **Offset (—Å–º–µ—â–µ–Ω–∏–µ)**
- –ù–æ–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ø–∞—Ä—Ç–∏—Ü–∏–∏.
- –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å —Ö—Ä–∞–Ω–∏—Ç **offset**, —á—Ç–æ–±—ã –∑–Ω–∞—Ç—å, –≥–¥–µ –æ–Ω –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è.
- Offset –º–æ–∂–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ Kafka (–≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–º —Ç–æ–ø–∏–∫–µ `__consumer_offsets`) –∏–ª–∏ –≤–Ω–µ—à–Ω–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –ë–î).
üìò _–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:_ –º–æ–∂–Ω–æ "–æ—Ç–º–æ—Ç–∞—Ç—å –Ω–∞–∑–∞–¥" –∏ –ø–µ—Ä–µ—á–∏—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è.
### 8Ô∏è‚É£ **Replication (—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è)**
- –ö–∞–∂–¥–∞—è –ø–∞—Ä—Ç–∏—Ü–∏—è –∏–º–µ–µ—Ç **—Ä–µ–ø–ª–∏–∫–∏** –Ω–∞ –¥—Ä—É–≥–∏—Ö –±—Ä–æ–∫–µ—Ä–∞—Ö.
- –ï—Å—Ç—å:
    - **Leader replica** ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –∫–æ–ø–∏—è, –ø—Ä–∏–Ω–∏–º–∞—é—â–∞—è –∑–∞–ø–∏—Å–∏;
    - **Follower replicas** ‚Äî –∫–æ–ø–∏–∏, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ —Å –ª–∏–¥–µ—Ä–æ–º.
- –ï—Å–ª–∏ –ª–∏–¥–µ—Ä –ø–∞–¥–∞–µ—Ç, Kafka –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –Ω–æ–≤–æ–≥–æ –ª–∏–¥–µ—Ä–∞.
üìò _–≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫—É—é –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å._
### 9Ô∏è‚É£ **ZooKeeper / KRaft**
- Kafka —Ä–∞–Ω—å—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ **Apache ZooKeeper** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞ (—Å–æ—Å—Ç–æ—è–Ω–∏—è –±—Ä–æ–∫–µ—Ä–æ–≤, —Ç–æ–ø–∏–∫–æ–≤, –ª–∏–¥–µ—Ä–æ–≤).
- –° –≤–µ—Ä—Å–∏–∏ **Kafka 2.8+** –≤–≤–µ–¥—ë–Ω –Ω–æ–≤—ã–π –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º **KRaft (Kafka Raft Metadata Mode)**, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–º–µ–Ω—è–µ—Ç ZooKeeper.
- KRaft –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **—É–ø—Ä–æ—â—ë–Ω–Ω–æ–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ª—É—á—à—É—é –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**.
## üîÅ –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
1. **Producer ‚Üí Topic ‚Üí Partition (–Ω–∞ Broker)** ‚Äî –∑–∞–ø–∏—Å—å —Å–æ–æ–±—â–µ–Ω–∏–π.
2. **Broker ‚Üí Consumer Group** ‚Äî —á—Ç–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π.
3. **Controller Broker** —Å–ª–µ–¥–∏—Ç –∑–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø–∞—Ä—Ç–∏—Ü–∏–π –∏ –ª–∏–¥–µ—Ä–æ–≤.
4. **Offset** —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç, –≥–¥–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è.
5. **Replication** –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö.
## üß† –í–∏–∑—É–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (—Å—Ö–µ–º–∞—Ç–∏—á–Ω–æ)
```
[ Producer ] 
     ‚Üì
  [ Topic: orders ]
     ‚îú‚îÄ‚îÄ Partition 0 (Broker 1, Leader)
     ‚îú‚îÄ‚îÄ Partition 1 (Broker 2, Leader)
     ‚îî‚îÄ‚îÄ Partition 2 (Broker 3, Leader)
             ‚Üë
         [ Consumer Group ]
         ‚îú‚îÄ‚îÄ Consumer A ‚Üí Partition 0
         ‚îú‚îÄ‚îÄ Consumer B ‚Üí Partition 1
         ‚îî‚îÄ‚îÄ Consumer C ‚Üí Partition 2
```
