## ‚öôÔ∏è –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: —á—Ç–æ —Ç–∞–∫–æ–µ `LazyInitializationException`
`LazyInitializationException` ‚Äî —ç—Ç–æ –æ—à–∏–±–∫–∞, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ–º–∞—è Hibernate, –∫–æ–≥–¥–∞ –æ–Ω **–ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–≥—Ä—É–∑–∏—Ç—å –ª–µ–Ω–∏–≤–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º–æ–µ –ø–æ–ª–µ (`fetch = LAZY`) –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–µ—Å—Å–∏–∏ (Session)**.
–ü—Ä–æ—â–µ –≥–æ–≤–æ—Ä—è:
> –°—É—â–Ω–æ—Å—Ç—å –≤—Å—ë –µ—â—ë –∂–∏–≤–∞ –≤ –∫–æ–¥–µ Java,  
> –Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π (Hibernate Session) —É–∂–µ –∑–∞–∫—Ä—ã—Ç–æ,  
> –∏ Hibernate –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–≥—Ä—É–∑–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
## üß© –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è
### üîπ 1. –î–æ—Å—Ç—É–ø –∫ LAZY-–ø–æ–ª—è–º **–≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ / –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ `Session`**
**–≠—Ç–æ ‚Äî —Å–∞–º–∞—è —á–∞—Å—Ç–∞—è –ø—Ä–∏—á–∏–Ω–∞.**
–ü—Ä–∏–º–µ—Ä:
```java
Author author = authorRepository.findById(1L).orElseThrow();
System.out.println(author.getBooks().size()); // üí• LazyInitializationException
```
–ü–æ—á–µ–º—É:
- `findById()` –æ—Ç–∫—Ä—ã–ª —Å–µ—Å—Å–∏—é, –∑–∞–≥—Ä—É–∑–∏–ª `Author`, –ø–æ—Ç–æ–º —Å–µ—Å—Å–∏—è –∑–∞–∫—Ä—ã–ª–∞—Å—å.
- `books` ‚Äî –ª–µ–Ω–∏–≤–æ –∑–∞–≥—Ä—É–∂–∞–µ–º–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç SQL-–∑–∞–ø—Ä–æ—Å–∞.
- –°–µ—Å—Å–∏—è —É–∂–µ –∑–∞–∫—Ä—ã—Ç–∞ ‚Üí Hibernate –Ω–µ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å ‚Üí Exception.
üìå **–ö–æ—Ä–µ–Ω—å –ø—Ä–æ–±–ª–µ–º—ã:** –¥–æ—Å—Ç—É–ø –∫ LAZY-—Å–≤–æ–π—Å—Ç–≤–∞–º –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
### üîπ 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `fetch = LAZY` –∏ –≤–æ–∑–≤—Ä–∞—Ç —Å—É—â–Ω–æ—Å—Ç–µ–π –∏–∑ —Å–µ—Ä–≤–∏—Å–∞ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
–¢–∏–ø–∏—á–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
```
Controller ‚Üí Service ‚Üí Repository
```
–û—à–∏–±–∫–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è, –∫–æ–≥–¥–∞:
- –º–µ—Ç–æ–¥ –≤ `Service` **—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–π**,
- –Ω–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ `LAZY`-–ø–æ–ª—è–º **—É–∂–µ –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**.
–ü—Ä–∏–º–µ—Ä:
```java
// –°–µ—Ä–≤–∏—Å
@Transactional
public Author getAuthor(Long id) {
    return authorRepository.findById(id).orElseThrow();
}

// –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
@GetMapping("/{id}")
public AuthorDto getAuthor(@PathVariable Long id) {
    Author author = authorService.getAuthor(id);
    return new AuthorDto(author.getName(), author.getBooks().size()); // üí•
}
```
üìå **–ü—Ä–∏—á–∏–Ω–∞:** Hibernate session –∑–∞–∫—Ä—ã—Ç–∞ –∫ –º–æ–º–µ–Ω—Ç—É –≤—ã–∑–æ–≤–∞ `getBooks()`.
### üîπ 3. –í–æ–∑–≤—Ä–∞—Ç –ª–µ–Ω–∏–≤—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ JSON (Jackson)
–ï—Å–ª–∏ –≤—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç–µ —Å—É—â–Ω–æ—Å—Ç—å –Ω–∞–ø—Ä—è–º—É—é –∏–∑ REST-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞:
```java
@GetMapping("/{id}")
public Author getAuthor(@PathVariable Long id) {
    return authorService.getAuthor(id);
}
```
Jackson –ø—Ä–∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `getBooks()`, —á—Ç–æ–±—ã –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç –≤ JSON ‚Üí  
Hibernate –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–≥—Ä—É–∑–∏—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é ‚Üí –Ω–æ —Å–µ—Å—Å–∏—è —É–∂–µ –∑–∞–∫—Ä—ã—Ç–∞ ‚Üí `LazyInitializationException`.
üìå **–ü—Ä–∏—á–∏–Ω–∞:** —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –ª–µ–Ω–∏–≤—ã—Ö –ø—Ä–æ–∫—Å–∏ –≤–Ω–µ —Å–µ—Å—Å–∏–∏.
### üîπ 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Detached` —Å—É—â–Ω–æ—Å—Ç–µ–π
–°—É—â–Ω–æ—Å—Ç—å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è **detached**, –µ—Å–ª–∏:
- –≤—ã –≤—ã—à–ª–∏ –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∏–ª–∏
- —è–≤–Ω–æ –≤—ã–∑–≤–∞–ª–∏ `entityManager.detach()` / `clear()` / `close()`.
–õ—é–±–∞—è –ø–æ–ø—ã—Ç–∫–∞ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ LAZY-–ø–æ–ª—è–º detached-—Å—É—â–Ω–æ—Å—Ç–∏ ‚Üí Exception.
```java
Author author = entityManager.find(Author.class, 1L);
entityManager.detach(author);
author.getBooks().size(); // üí• LazyInitializationException
```
üìå **–ü—Ä–∏—á–∏–Ω–∞:** –æ–±—ä–µ–∫—Ç –æ—Ç—Å–æ–µ–¥–∏–Ω—ë–Ω –æ—Ç persistence context, Hibernate –Ω–µ –∑–Ω–∞–µ—Ç, –∫–∞–∫ –∑–∞–≥—Ä—É–∑–∏—Ç—å –µ–≥–æ —Å–≤—è–∑–∏.
### üîπ 5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `FetchType.LAZY` –≤ —Å–æ—á–µ—Ç–∞–Ω–∏–∏ —Å `cascade = CascadeType.MERGE` / `PERSIST`
–ò–Ω–æ–≥–¥–∞ `LazyInitializationException` –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –Ω–µ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏, –∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏.
–ù–∞–ø—Ä–∏–º–µ—Ä:
```java
Author author = new Author();
author.setBooks(List.of(new Book()));
entityManager.persist(author);
```
–ï—Å–ª–∏ `books` ‚Äî `LAZY`, Hibernate –º–æ–∂–µ—Ç –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –æ—Ç–ª–æ–∂–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –¥–æ flush‚Äô–∞,  
–∏ –ø—Ä–∏ —ç—Ç–æ–º, –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ—á–∏—Å—Ç–∏—Ç—Å—è –∏–ª–∏ —Å–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è ‚Äî –±—É–¥–µ—Ç –≤—ã–±—Ä–æ—à–µ–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ.
üìå **–ü—Ä–∏—á–∏–Ω–∞:** –∫–∞—Å–∫–∞–¥–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ª–µ–Ω–∏–≤–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –≤–Ω–µ –∞–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏.
### üîπ 6. –ù–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —É—Ä–æ–≤–Ω–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ Spring (–Ω–∞–ø—Ä–∏–º–µ—Ä, `@Transactional` –Ω–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –º–µ—Ç–æ–¥–∞—Ö)
–ï—Å–ª–∏ –º–µ—Ç–æ–¥ —Å `@Transactional` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **–≤–Ω—É—Ç—Ä–∏ —Ç–æ–≥–æ –∂–µ –∫–ª–∞—Å—Å–∞**,  
Spring –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –ø—Ä–æ–∫—Å–∏, –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è.
–ü—Ä–∏–º–µ—Ä:
```java
public class AuthorService {

    @Transactional
    public Author getAuthor(Long id) { ... }

    public AuthorDto getAuthorDto(Long id) {
        Author author = getAuthor(id); // ‚ùå —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, self-invocation
        return new AuthorDto(author.getBooks().size());
    }
}
```
üìå **–ü—Ä–∏—á–∏–Ω–∞:** —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞, —Å–µ—Å—Å–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –¥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ `LAZY`-–ø–æ–ª—è–º.
### üîπ 7. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `EntityManager` –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è
–ï—Å–ª–∏ –≤—Ä—É—á–Ω—É—é —É–ø—Ä–∞–≤–ª—è–µ—Ç–µ `EntityManager`, –∏ –≤—ã–∑—ã–≤–∞–µ—Ç–µ `em.close()`,  
–≤—Å–µ —Å—É—â–Ω–æ—Å—Ç–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —ç—Ç–∏–º `EntityManager`, —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è detached.
```java
EntityManager em = emf.createEntityManager();
Author a = em.find(Author.class, 1L);
em.close();
a.getBooks().size(); // üí• LazyInitializationException
```
üìå **–ü—Ä–∏—á–∏–Ω–∞:** —Ä—É—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ `EntityManager` –¥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ª–µ–Ω–∏–≤—ã—Ö —Å–≤—è–∑–µ–π.
## üß† –ò—Ç–æ–≥: –∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

|‚Ññ|–ü—Ä–∏—á–∏–Ω–∞|–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ|
|---|---|---|
|1|–î–æ—Å—Ç—É–ø –∫ LAZY-–ø–æ–ª—é –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏|–°–µ—Å—Å–∏—è –∑–∞–∫—Ä—ã—Ç–∞ ‚Äî Hibernate –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ|
|2|–í–æ–∑–≤—Ä–∞—Ç —Å—É—â–Ω–æ—Å—Ç–∏ –∏–∑ —Å–µ—Ä–≤–∏—Å–∞ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä|–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ `LAZY`-–ø–æ–ª—é —É–∂–µ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏|
|3|–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è JSON (Jackson)|Jackson –≤—ã–∑—ã–≤–∞–µ—Ç `getters`, —á—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –ª–µ–Ω–∏–≤—É—é –∑–∞–≥—Ä—É–∑–∫—É|
|4|Detached —Å—É—â–Ω–æ—Å—Ç—å|–°—É—â–Ω–æ—Å—Ç—å –æ—Ç—Å–æ–µ–¥–∏–Ω–µ–Ω–∞ –æ—Ç `Session` / `EntityManager`|
|5|–õ–µ–Ω–∏–≤—ã–µ –∫–∞—Å–∫–∞–¥—ã|Hibernate –ø—ã—Ç–∞–µ—Ç—Å—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–ª–ª–µ–∫—Ü–∏—é –ø—Ä–∏ `persist` / `merge`|
|6|–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `@Transactional`|–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞ (self-invocation, –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏ —Ç. –¥.)|
|7|–†—É—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ `EntityManager`|–°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ ‚Äî –±–æ–ª—å—à–µ –Ω–µ–ª—å–∑—è –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å –¥–∞–Ω–Ω—ã–µ|
## ‚úÖ –ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å
- –î–µ–ª–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ LAZY-–ø–æ–ª—è–º **—Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ `@Transactional` –º–µ—Ç–æ–¥–∞**.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `JOIN FETCH` –∏–ª–∏ `EntityGraph` –¥–ª—è –Ω—É–∂–Ω—ã—Ö —Å–≤—è–∑–µ–π.
- –ù–µ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å—É—â–Ω–æ—Å—Ç–∏ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ ‚Üí –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **DTO**.
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `@Transactional` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ self-invocation).
- –û—Ç–∫–ª—é—á–∏—Ç—å `spring.jpa.open-in-view=false` —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ DTO.