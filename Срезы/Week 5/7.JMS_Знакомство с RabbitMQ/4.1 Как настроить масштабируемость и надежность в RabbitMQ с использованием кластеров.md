## 1Ô∏è‚É£ –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è RabbitMQ
**–ö–ª–∞—Å—Ç–µ—Ä RabbitMQ** ‚Äî —ç—Ç–æ –≥—Ä—É–ø–ø–∞ –±—Ä–æ–∫–µ—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ –∏ **–æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**.
### üîπ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
- –ù–µ—Å–∫–æ–ª—å–∫–æ –±—Ä–æ–∫–µ—Ä–æ–≤ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤ –æ–¥–∏–Ω –ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–ª–∞—Å—Ç–µ—Ä.
- –í—Å–µ —É–∑–ª—ã **–æ–±–º–µ–Ω–∏–≤–∞—é—Ç—Å—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏** –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö, –æ—á–µ—Ä–µ–¥—è—Ö –∏ bindings.
- –û—á–µ—Ä–µ–¥–∏ –º–æ–≥—É—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–∞ –æ–¥–Ω–æ–º —É–∑–ª–µ –∏–ª–∏ –±—ã—Ç—å **—Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã** –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É–∑–ª–æ–≤.
**–ü—Ä–∏–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É–∑–ª–∞ –≤ –∫–ª–∞—Å—Ç–µ—Ä:**
```bash
rabbitmqctl join_cluster rabbit@node1
rabbitmqctl start_app
```
## 2Ô∏è‚É£ –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –æ—á–µ—Ä–µ–¥–µ–π (Mirrored Queues)
–ß—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å **–æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å**, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **mirrored queues**:
- –û—á–µ—Ä–µ–¥—å —Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É–∑–ª–æ–≤.
- –û–¥–∏–Ω —É–∑–µ–ª –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è **master**, –æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî **mirror**.
- –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –Ω–∞ master –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è –Ω–∞ mirrors.
- –ï—Å–ª–∏ master –ø–∞–¥–∞–µ—Ç ‚Üí –æ–¥–∏–Ω –∏–∑ mirror —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–æ–≤—ã–º master.
**–ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ policy:**
```bash
rabbitmqctl set_policy ha-all ".*" '{"ha-mode":"all"}'
```
- `ha-mode: all` ‚Üí —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –Ω–∞ –≤—Å–µ —É–∑–ª—ã –∫–ª–∞—Å—Ç–µ—Ä–∞.
## 3Ô∏è‚É£ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
### üîπ –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–∑–ª–æ–≤ –≤ –∫–ª–∞—Å—Ç–µ—Ä** ‚Üí —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –æ–±—â—É—é –ø—Ä–æ–ø—É—Å–∫–Ω—É—é —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å.
- –ú–æ–∂–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –æ—á–µ—Ä–µ–¥–∏ –ø–æ —É–∑–ª–∞–º (sharding queues) –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –æ–¥–∏–Ω broker.
### üîπ –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π
- –ù–µ—Å–∫–æ–ª—å–∫–æ consumer‚Äô–æ–≤ –º–æ–≥—É—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —á–∏—Ç–∞—Ç—å –∏–∑ –æ–¥–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏.
- RabbitMQ **—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è round-robin** ‚Üí —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –º–µ–∂–¥—É –≤–æ—Ä–∫–µ—Ä–∞–º–∏.
### üîπ –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—é—Å–µ—Ä–æ–≤
- –ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–¥—é—Å–µ—Ä–æ–≤ –º–æ–≥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –æ–¥–Ω—É –æ—á–µ—Ä–µ–¥—å –∏–ª–∏ exchange.
- –≠—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç throughput –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Å–ª—É–∂–∏–≤–∞—Ç—å –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π.
## 4Ô∏è‚É£ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
### üîπ Persistent messages
- –°–æ–æ–±—â–µ–Ω–∏—è –º–æ–∂–Ω–æ –ø–æ–º–µ—á–∞—Ç—å –∫–∞–∫ **persistent**, —á—Ç–æ–±—ã –æ–Ω–∏ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –Ω–∞ –¥–∏—Å–∫–µ –∏ –Ω–µ –ø–æ—Ç–µ—Ä—è–ª–∏—Å—å –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –±—Ä–æ–∫–µ—Ä–∞.
```java
MessageProperties.PERSISTENT_TEXT_PLAIN
```
### üîπ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π (ack)
- Consumer –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–æ–±—â–µ–Ω–∏—è (`ack`).
- –ï—Å–ª–∏ consumer —É–ø–∞–ª –¥–æ ack ‚Üí RabbitMQ –ø–µ—Ä–µ–æ—Ç–ø—Ä–∞–≤–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –¥—Ä—É–≥–æ–º—É consumer.
### üîπ Dead Letter Exchange (DLX)
- –°–æ–æ–±—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ **–æ—á–µ—Ä–µ–¥—å –º—ë—Ä—Ç–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π** –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.
## 5Ô∏è‚É£ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **RabbitMQ Management Plugin** –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—á–µ—Ä–µ–¥–µ–π, —É–∑–ª–æ–≤ –∏ –∑–∞–≥—Ä—É–∑–∫–∏.
- –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
    - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –æ—á–µ—Ä–µ–¥—è—Ö,
    - —Å–∫–æ—Ä–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏,
    - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–µ—Ä–∫–∞–ª—å–Ω—ã—Ö –æ—á–µ—Ä–µ–¥–µ–π,
    - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ —É–∑–ª–æ–≤.
## 6Ô∏è‚É£ –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã –∫–ª–∞—Å—Ç–µ—Ä–∞ RabbitMQ
```
          +----------+
Producer ‚Üí| Exchange |‚Üí Queue1 (master on Node1, mirror on Node2/Node3)
          +----------+
                    \
                     ‚Üí Queue2 (master on Node2, mirror on Node1/Node3)
Consumers ‚Üí –ø–æ–ª—É—á–∞—é—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å –æ—á–µ—Ä–µ–¥–µ–π (round-robin)
```
- **Master** —Ö—Ä–∞–Ω–∏—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, **mirrors** ‚Äî —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏.
- –ü—Ä–∏ —Å–±–æ–µ master ‚Üí –æ–¥–∏–Ω –∏–∑ mirrors —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–æ–≤—ã–º master.
## üîπ –ò—Ç–æ–≥
–î–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –≤ RabbitMQ:
1. –°–æ–∑–¥–∞–≤–∞—Ç—å **–∫–ª–∞—Å—Ç–µ—Ä –±—Ä–æ–∫–µ—Ä–æ–≤**.
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **mirrored queues** –¥–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏.
3. –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å **–ø—Ä–æ–¥—é—Å–µ—Ä–æ–≤ –∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π**.
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å **persistent messages –∏ ack** –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏.
5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **DLX** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ—É–¥–∞—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π.
6. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ —á–µ—Ä–µ–∑ Management Plugin.