# üß© **–ß—Ç–æ —Ç–∞–∫–æ–µ OAuth2 –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ Spring Security?**
Spring Security –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–º OAuth2-—Å–µ—Ä–≤–µ—Ä–æ–º, –Ω–æ **–æ—Ç–ª–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ OAuth2 Resource Server**, –∫–æ—Ç–æ—Ä—ã–π:
1. **–ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ REST API**
2. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ–¥–∞–ª Bearer Token**
3. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞** –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
    - —á–µ—Ä–µ–∑ JWK/JWT
    - —á–µ—Ä–µ–∑ introspection endpoint
4. –ù–∞ –æ—Å–Ω–æ–≤–µ —Ç–æ–∫–µ–Ω–∞ —Ä–µ—à–∞–µ—Ç—Å—è, –º–æ–∂–Ω–æ –ª–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å.
Spring Boot 3.x –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—à—ë–ª –Ω–∞ **Spring Authorization Server** –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (Keycloak, Auth0, Okta).
# üìå –í–∞—Ä–∏–∞–Ω—Ç—ã –∑–∞—â–∏—Ç—ã API —á–µ—Ä–µ–∑ OAuth2
### ‚úî OAuth2 Resource Server (—Å–∞–º—ã–π —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–π)
API –ø—Ä–∏–Ω–∏–º–∞–µ—Ç JWT –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –µ–≥–æ.
### ‚úî OAuth2 Client
–í–∞—à —Å–µ—Ä–≤–∏—Å ‚Üí –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ —á—É–∂–∏–º API —Å –ø–æ–ª—É—á–µ–Ω–∏–µ–º —Ç–æ–∫–µ–Ω–∞
### ‚úî –ü–æ–ª–Ω—ã–π OAuth2 Authorization Server
–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ **—Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –≤—ã–¥–∞–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã**, –Ω—É–∂–µ–Ω Spring Authorization Server.
# üöÄ **1. –ó–∞—â–∏—Ç–∞ REST API –∫–∞–∫ OAuth2 Resource Server (JWT)**
### –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å:
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-oauth2-resource-server</artifactId>
</dependency>

<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-oauth2-jose</artifactId>
</dependency>
```
# üöÄ **2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Security**
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {

        http
            .csrf(csrf -> csrf.disable())
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/public/**").permitAll()
                .anyRequest().authenticated()
            )
            .oauth2ResourceServer(oauth2 ->
                oauth2.jwt(jwt -> jwt.jwtAuthenticationConverter(jwtConverter()))
            );

        return http.build();
    }

    @Bean
    public JwtAuthenticationConverter jwtConverter() {
        JwtGrantedAuthoritiesConverter converter = new JwtGrantedAuthoritiesConverter();
        converter.setAuthorityPrefix("ROLE_");
        converter.setAuthoritiesClaimName("roles");

        JwtAuthenticationConverter authConverter = new JwtAuthenticationConverter();
        authConverter.setJwtGrantedAuthoritiesConverter(converter);

        return authConverter;
    }
}
```
# üöÄ **3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å issuer –∏ JWK/JWT –≤ application.yml**
–ü—Ä–∏–º–µ—Ä –¥–ª—è Keycloak / Auth0:
```yaml
spring:
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: https://auth.example.com/realms/myrealm
```
Spring —Å–∞–º –ø–æ–¥—Ç—è–Ω–µ—Ç:
```
https://auth.example.com/realms/myrealm/.well-known/openid-configuration
```
–∏ JWK –∫–ª—é—á–∏.
# üöÄ **4. –ö–∞–∫ API –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–∫–µ–Ω**
–ó–∞–ø—Ä–æ—Å:
```
GET /api/users
Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5...
```
Spring Security –≤—ã–ø–æ–ª–Ω—è–µ—Ç:
1. Decoding JWT
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ —á–µ—Ä–µ–∑ JWK
3. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π
4. –°–æ–∑–¥–∞–Ω–∏–µ Authentication
5. –î–æ—Å—Ç—É–ø –∏–ª–∏ –æ—Ç–∫–∞–∑
# üß± –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏
```java
@RestController
@RequestMapping("/api")
public class UserController {

    @GetMapping("/users")
    @PreAuthorize("hasRole('ADMIN')")
    public List<UserDto> findAll() {
        return List.of();
    }
}
```
# üéØ **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ OAuth2 Flows**
### ‚úî Authorization Code (–¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞)
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google/Keycloak.
### ‚úî Client Credentials (machine-to-machine)
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è microservice ‚Üí microservice
–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞:
```
POST /protocol/openid-connect/token
grant_type=client_credentials
client_id=api-service
client_secret=12345
```
### ‚úî Password (—É—Å—Ç–∞—Ä–µ–ª –∏ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
# üß© **–ö–∞–∫ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å Keycloak (–ø—Ä–∏–º–µ—Ä)**
### 1. –ó–∞–ø—É—Å–∫–∞–µ–º Keycloak
### 2. –°–æ–∑–¥–∞—ë–º Realm
### 3. –°–æ–∑–¥–∞—ë–º Client:
- Access Type: **confidential**
- Enabled: On
- Service Accounts Enabled: On
- Roles assigned: `api-user`, `api-admin`
### 4. Spring Boot –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑:
```yaml
spring:
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: http://localhost:8080/realms/myrealm
```
# üåê –î—Ä—É–≥–∏–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã:

|–ü—Ä–æ–≤–∞–π–¥–µ—Ä|–¢–∏–ø —Ç–æ–∫–µ–Ω–æ–≤|–ü–æ–¥–¥–µ—Ä–∂–∫–∞|
|---|---|---|
|Auth0|JWT|–û—Ç–ª–∏—á–Ω–∞—è|
|Keycloak|JWT|–û—Ç–ª–∏—á–Ω–∞—è|
|Okta|JWT|–û—Ç–ª–∏—á–Ω–∞—è|
|Azure AD|JWT|–û—Ç–ª–∏—á–Ω–∞—è|
|AWS Cognito|JWT|–û—Ç–ª–∏—á–Ω–∞—è|
–í—Å–µ —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ: –≤—ã —É–∫–∞–∑—ã–≤–∞–µ—Ç–µ **issuer-uri**, Spring –≤—ã—Ç—è–≥–∏–≤–∞–µ—Ç JWKS –∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω—ã.