# ‚úÖ **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å VisualVM –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ Java-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π**
**VisualVM** ‚Äî —ç—Ç–æ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—Ö–æ–¥–∏—Ç –≤ JDK (–¥–æ JDK 9) –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É Java-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏: CPU, –ø–∞–º—è—Ç—å, —Ç—Ä–µ–¥—ã, GC, heap dump, –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ.
# üîß **1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫ VisualVM**
### ‚úî –°–ø–æ—Å–æ–± 1: –µ—Å–ª–∏ —É –≤–∞—Å JDK ‚â§ 8
VisualVM —É–∂–µ –≤—Å—Ç—Ä–æ–µ–Ω:
```bash
jvisualvm
```
### ‚úî –°–ø–æ—Å–æ–± 2: –µ—Å–ª–∏ JDK > 8
VisualVM –Ω—É–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ:  
[https://visualvm.github.io/](https://visualvm.github.io/)
–ó–∞–ø—É—Å–∫:
```bash
visualvm
```
# üîå **2. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ä–∞–±–æ—Ç–∞—é—â–µ–º—É Java-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é**
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ VisualVM –≤—ã —É–≤–∏–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö JVM-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –≤ –¥–µ—Ä–µ–≤–µ —Å–ª–µ–≤–∞:
üìå _Local_  
‚ÄÉ‚Ä¢ Java-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Ññ1  
‚ÄÉ‚Ä¢ Java-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ‚Ññ2  
‚ÄÉ‚Ä¢ ...
–ß—Ç–æ–±—ã –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è ‚Äî –ø—Ä–æ—Å—Ç–æ –∫–ª–∏–∫–Ω–∏—Ç–µ –ø–æ –ø—Ä–æ—Ü–µ—Å—Å—É –¥–≤–∞–∂–¥—ã.
–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –Ω—É–∂–Ω—ã–º–∏ —Ñ–ª–∞–≥–∞–º–∏, VisualVM –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –±–µ–∑ –ø—Ä–æ–±–ª–µ–º.
–ò–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã JVM:
```bash
-Dcom.sun.management.jmxremote
```
# üìä **3. –û—Å–Ω–æ–≤–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ –≤ VisualVM**
## üîπ **Overview**
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –≤–µ—Ä—Å–∏—é JVM
- –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞
- –ø—É—Ç–∏ –∫ –∫–ª–∞—Å—Å–∞–º
- GC –∏ —Ö–∏–ø
–≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –±—ã—Å—Ç—Ä–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã JVM.
## üîπ **Monitor** ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
–ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Å–ª–µ–¥–∏—Ç—å –∑–∞:
- –∑–∞–≥—Ä—É–∑–∫–æ–π CPU
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º heap –∏ metaspace
- –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ç—Ä–µ–¥–æ–≤
- –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º GC-–ø–∞—É–∑
- –≤—Ä–µ–º–µ–Ω–µ–º —Å–±–æ—Ä–∫–∏ –º—É—Å–æ—Ä–∞
–û—á–µ–Ω—å —É–¥–æ–±–Ω–æ –≤—ã—è–≤–ª—è—Ç—å:
- –Ω–µ–æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º—É—é –ø–∞–º—è—Ç—å
- —É—Ç–µ—á–∫–∏ (leaks)
- ¬´—Ä–æ—Å—Ç¬ª —Ç—Ä–µ–¥–æ–≤ (thread leak)
- –≤—ã—Å–æ–∫—É—é –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ CPU
## üîπ **Threads** ‚Äî –∞–Ω–∞–ª–∏–∑ –ø–æ—Ç–æ–∫–æ–≤
–ü–æ–∑–≤–æ–ª—è–µ—Ç:
- –≤–∏–¥–µ—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ, —Å–ø—è—â–∏–µ, –æ–∂–∏–¥–∞—é—â–∏–µ —Ç—Ä–µ–¥—ã
- —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å deadlock
- –Ω–∞–±–ª—é–¥–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç—Ä–µ–¥–æ–≤ –≤ –¥–∏–Ω–∞–º–∏–∫–µ
–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∞–µ—Ç ‚Äî —ç—Ç–æ –ø–µ—Ä–≤–æ–µ –º–µ—Å—Ç–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.
## üîπ **Sampler** ‚Äî –ª–µ–≥–∫–æ–µ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ CPU / –ø–∞–º—è—Ç–∏
Sampler –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
### CPU
- –∫–∞–∫–∏–µ –º–µ—Ç–æ–¥—ã –∑–∞–Ω–∏–º–∞—é—Ç –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ CPU
- ¬´–≥–æ—Ä—è—á–∏–µ —Ç–æ—á–∫–∏¬ª (hot spots)
### Memory
- –∫–∞–∫–∏–µ –∫–ª–∞—Å—Å—ã —Å–æ–∑–¥–∞—é—Ç –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –æ–±—ä–µ–∫—Ç–æ–≤
- —Å–∫–æ–ª—å–∫–æ –ø–∞–º—è—Ç–∏ –∑–∞–Ω–∏–º–∞—é—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∏–ø—ã
Sampler –±—ã—Å—Ç—Ä—ã–π, –º–∞–ª–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –ø–æ—ç—Ç–æ–º—É –µ–≥–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞ –ø—Ä–æ–¥–µ (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ).
## üîπ **Profiler** ‚Äî —Ç–æ—á–Ω–æ–µ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ (–º–µ–¥–ª–µ–Ω–Ω–µ–µ)
–ü–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ–ª–∞—Ç—å:
- —Ç–æ—á–Ω–æ–µ –∏–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–µ—Ç–æ–¥–æ–≤
- –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–ª–ª–æ–∫–∞—Ü–∏–π –æ–±—ä–µ–∫—Ç–æ–≤
- –∑–∞–ø–∏—Å—å —Å–æ–±—ã—Ç–∏–π
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≥–ª—É–±–æ–∫–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏, –Ω–æ –¥–∞—ë—Ç –Ω–∞–≥—Ä—É–∑–∫—É ‚Üí –æ–±—ã—á–Ω–æ –ø—Ä–∏–º–µ–Ω—è—é—Ç –≤ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ.
# üí• **4. –°–±–æ—Ä Heap Dump –¥–ª—è –ø–æ–∏—Å–∫–∞ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏**
Heap dump –º–æ–∂–Ω–æ —Å–Ω—è—Ç—å:
### ‚úî –∏–∑ VisualVM
**Monitor ‚Üí Heap Dump**
### ‚úî –∏–∑ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
```bash
jmap -dump:live,format=b,file=heap.bin <PID>
```
### –í Heap Dump –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å:
- –∫–∞–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã –∑–∞–Ω–∏–º–∞—é—Ç –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –ø–∞–º—è—Ç–∏
- –∫–∞–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã —É–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –∏ –∫—Ç–æ –∏—Ö —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç
- —Ü–∏–∫–ª—ã, —É—Ç–µ—á–∫–∏, singleton-—É—Ç–µ—á–∫–∏, thread-locals –∏ –¥—Ä.
# üîß **5. –ê–Ω–∞–ª–∏–∑ GC**
–ù–∞ –≤–∫–ª–∞–¥–∫–µ **Monitor** –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:
- —á–∞—Å—Ç–æ—Ç–∞ GC
- –≤—Ä–µ–º—è –ø–∞—É–∑
- —Ä–∞–∑–º–µ—Ä heap –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Å–±–æ—Ä–∫–∏
–ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –ª–µ–≥–∫–æ —É–≤–∏–¥–µ—Ç—å:
- —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–π minor GC
- —Ä–æ—Å—Ç —Å—Ç–∞—Ä—à–µ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è
- –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –ø–æ—Å–ª–µ GC (—É—Ç–µ—á–∫–∏)
# üß™ **6. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —É–¥–∞–ª–µ–Ω–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—É**
–ß–µ—Ä–µ–∑ JMX:
1. –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã JVM:
```bash
-Dcom.sun.management.jmxremote
-Dcom.sun.management.jmxremote.port=9010
-Dcom.sun.management.jmxremote.ssl=false
-Dcom.sun.management.jmxremote.authenticate=false
```
2. –í VisualVM ‚Üí Add Remote Host
3. Add JMX Connection ‚Üí –ø–æ—Ä—Ç 9010
# üéØ –ò—Ç–æ–≥
**VisualVM –ø–æ–∑–≤–æ–ª—è–µ—Ç:**
‚úî –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å CPU –∏ –ø–∞–º—è—Ç—å  
‚úî –Ω–∞–±–ª—é–¥–∞—Ç—å —Ç—Ä–µ–¥—ã –∏ deadlock  
‚úî –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã  
‚úî –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å GC  
‚úî —Å–Ω–∏–º–∞—Ç—å heap dump  
‚úî —Ä–∞–±–æ—Ç–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ –∏ —É–¥–∞–ª—ë–Ω–Ω–æ  
‚úî –Ω–∞—Ö–æ–¥–∏—Ç—å —É–∑–∫–∏–µ –º–µ—Å—Ç–∞ –∏ —É—Ç–µ—á–∫–∏
–≠—Ç–æ –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö —É–¥–æ–±–Ω—ã—Ö –∏ –ø—Ä–æ—Å—Ç—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ Java-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.