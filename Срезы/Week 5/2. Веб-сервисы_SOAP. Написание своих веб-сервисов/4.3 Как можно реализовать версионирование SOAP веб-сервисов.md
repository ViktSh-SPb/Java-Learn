В SOAP веб-сервисах версионирование важно для того, чтобы клиенты могли продолжать работать с старой версией сервиса, пока новые версии внедряются. Существует несколько подходов к реализации версионирования.
## 1. Версионирование через **URL**
Простейший и наиболее распространённый метод — включить версию в URL эндпоинта:
```
http://example.com/service/v1/OrderService
http://example.com/service/v2/OrderService
```
- Клиенты старой версии продолжают обращаться к `/v1/`, новые — к `/v2/`.
- Простая реализация на уровне маршрутизации (Apache, Nginx или веб-сервлетов).
- Не влияет на WSDL, каждая версия может иметь свой WSDL.
## 2. Версионирование через **неймспейсы WSDL**
SOAP использует XML Namespaces, что удобно для различения версий:
```xml
<wsdl:definitions xmlns:tns="http://example.com/orderservice/v1"
                  targetNamespace="http://example.com/orderservice/v1">
```
- Версия указывается в `targetNamespace`.
- Старые клиенты используют старый namespace, новые — новый.
- Позволяет разрабатывать несколько версий в одном коде, если использовать разные пакеты/классы.
## 3. Версионирование через **SOAP Action**
В заголовке `SOAPAction` можно указать версию метода:
```http
POST /service/OrderService HTTP/1.1
SOAPAction: "http://example.com/orderservice/v1/createOrder"
```
- Подходит, когда URL остаётся один, но методы разных версий нужно различать.
- Используется реже, чем namespace или URL.
## 4. Версионирование через **внутренний параметр**
Можно добавить в тело SOAP-запроса поле `version`:
```xml
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"
                  xmlns:ord="http://example.com/orderservice">
   <soapenv:Header/>
   <soapenv:Body>
      <ord:createOrder>
         <ord:version>2.0</ord:version>
         <ord:orderDetails>...</ord:orderDetails>
      </ord:createOrder>
   </soapenv:Body>
</soapenv:Envelope>
```
- Сервер обрабатывает версию логикой приложения.
- Не самый “чистый” способ, т.к. версия смешивается с данными запроса.
## 5. Практические рекомендации
1. **Использовать namespace и URL вместе** — надёжнее всего.
2. **Не ломать старые интерфейсы** — все изменения должны быть обратимо совместимы (backward compatible).
3. **Каждая версия должна иметь отдельный WSDL** — чтобы клиенты могли корректно генерировать прокси.
4. **Документировать версии** — чтобы клиенты знали, какие методы доступны и какие устарели.