## 1Ô∏è‚É£ –°—É—Ç—å –ø—Ä–æ–±–ª–µ–º—ã N+1
**–ü—Ä–æ–±–ª–µ–º–∞ N+1** –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –∫–æ–≥–¥–∞:
1. –¢—ã –∑–∞–≥—Ä—É–∂–∞–µ—à—å **–æ–¥–Ω—É —Å—É—â–Ω–æ—Å—Ç—å** (1 SQL-–∑–∞–ø—Ä–æ—Å),
2. –ê –∑–∞—Ç–µ–º **–ª–µ–Ω–∏–≤—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏–ª–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏** –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ (N SQL-–∑–∞–ø—Ä–æ—Å–æ–≤).
–¢–æ –µ—Å—Ç—å –≤—Å–µ–≥–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **1 + N SQL-–∑–∞–ø—Ä–æ—Å–æ–≤** –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —Å JOIN.
### üîπ –ü—Ä–∏–º–µ—Ä
–ï—Å—Ç—å —Å—É—â–Ω–æ—Å—Ç—å `Author` —Å –ª–µ–Ω–∏–≤–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–µ–π `books`:
```java
@Entity
public class Author {
    @Id
    private Long id;
    private String name;

    @OneToMany(mappedBy = "author", fetch = FetchType.LAZY)
    private List<Book> books;
}
```
#### –ö–æ–¥, –≤—ã–∑—ã–≤–∞—é—â–∏–π N+1:
```java
List<Author> authors = authorRepository.findAll(); // 1 SQL
for (Author a : authors) {
    a.getBooks().size(); // –∫–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π SQL ‚Üí N SQL
}
```
**SQL-–∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã:**
1. `SELECT * FROM authors;` ‚Üí 1 –∑–∞–ø—Ä–æ—Å
2. `SELECT * FROM books WHERE author_id = 1;` ‚Üí 1 –∑–∞–ø—Ä–æ—Å
3. `SELECT * FROM books WHERE author_id = 2;` ‚Üí 1 –∑–∞–ø—Ä–æ—Å
4. ... –¥–æ N –∞–≤—Ç–æ—Ä–æ–≤
–ò—Ç–æ–≥–æ: **1 + N –∑–∞–ø—Ä–æ—Å–æ–≤** –≤–º–µ—Å—Ç–æ **–æ–¥–Ω–æ–≥–æ JOIN**.
## 2Ô∏è‚É£ –ü–æ—á–µ–º—É —ç—Ç–æ –ø–ª–æ—Ö–æ
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞–¥–∞–µ—Ç**, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∑–∞–ø–∏—Å–µ–π.
- –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –±–∞–∑—É –∏ —Å–µ—Ç—å.
- –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ **—Ç–æ—Ä–º–æ–∑–∞–º –∏ OutOfMemory**, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –º–Ω–æ–≥–æ.
## 3Ô∏è‚É£ –ö–∞–∫ —Ä–µ—à–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É N+1
### üîπ 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `JOIN FETCH`
```java
@Query("SELECT a FROM Author a LEFT JOIN FETCH a.books")
List<Author> findAllWithBooks();
```
- Hibernate —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ–¥–∏–Ω SQL-–∑–∞–ø—Ä–æ—Å —Å JOIN.
- –í—Å–µ –∫–Ω–∏–≥–∏ –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è —Å—Ä–∞–∑—É ‚Üí N+1 –∏—Å—á–µ–∑–∞–µ—Ç.
### üîπ 2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@EntityGraph`
```java
@EntityGraph(attributePaths = {"books"})
List<Author> findAll();
```
- –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± JOIN FETCH.
- –£–¥–æ–±–Ω–æ –¥–ª—è Spring Data JPA.
### üîπ 3. Batch Fetching
```java
@OneToMany(fetch = FetchType.LAZY)
@BatchSize(size = 10)
private List<Book> books;
```
- Hibernate –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç –∫–æ–ª–ª–µ–∫—Ü–∏–∏ **–ø–∞–∫–µ—Ç–∞–º–∏ –ø–æ 10** –≤–º–µ—Å—Ç–æ N –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.
- N+1 —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ—à–∞–µ—Ç—Å—è, —É–º–µ–Ω—å—à–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤.
### üîπ 4. DTO / –ø—Ä–æ–µ–∫—Ü–∏–∏
- –í–º–µ—Å—Ç–æ –ø–æ–¥–≥—Ä—É–∑–∫–∏ —Å—É—â–Ω–æ—Å—Ç–µ–π, —Ñ–æ—Ä–º–∏—Ä—É–µ–º DTO —á–µ—Ä–µ–∑ JOIN –≤ –∑–∞–ø—Ä–æ—Å–µ:
```java
@Query("SELECT new com.example.dto.AuthorDto(a.name, b.title) FROM Author a LEFT JOIN a.books b")
List<AuthorDto> findAllAuthorDtos();
```
- –ü–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è, N+1 –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è.
## 4Ô∏è‚É£ –í–∏–∑—É–∞–ª—å–Ω–æ
```
–ë–µ–∑ JOIN FETCH:

SQL1: SELECT * FROM authors;       ‚Üê 1
SQL2: SELECT * FROM books WHERE author_id = 1; ‚Üê N —Ä–∞–∑
SQL3: SELECT * FROM books WHERE author_id = 2;
...
–ò—Ç–æ–≥–æ: 1 + N

–° JOIN FETCH:

SQL: SELECT a.*, b.* FROM authors a
     LEFT JOIN books b ON a.id = b.author_id;
–ò—Ç–æ–≥–æ: 1 –∑–∞–ø—Ä–æ—Å
```
### ‚úÖ –†–µ–∑—é–º–µ

|–ê—Å–ø–µ–∫—Ç|–°—É—Ç—å|
|---|---|
|–ü—Ä–æ–±–ª–µ–º–∞ N+1|–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ –∏ –ª–µ–Ω–∏–≤—ã—Ö —Å–≤—è–∑–µ–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è 1+N –∑–∞–ø—Ä–æ—Å–æ–≤|
|–ü–æ—á–µ–º—É –≤–æ–∑–Ω–∏–∫–∞–µ—Ç|FetchType.LAZY –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –¥–æ—Å—Ç—É–ø –∫ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏|
|–†–µ—à–µ–Ω–∏—è|`JOIN FETCH`, `@EntityGraph`, Batch Fetch, DTO/–ø—Ä–æ–µ–∫—Ü–∏–∏|
|–í–∞–∂–Ω–æ—Å—Ç—å|–ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö|
