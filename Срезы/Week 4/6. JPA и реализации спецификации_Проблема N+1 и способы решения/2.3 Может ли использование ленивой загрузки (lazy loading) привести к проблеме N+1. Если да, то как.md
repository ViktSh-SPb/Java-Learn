–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ **–ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ (lazy loading)** –Ω–∞–ø—Ä—è–º—É—é —Å–≤—è–∑–∞–Ω–æ —Å –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–µ–º **–ø—Ä–æ–±–ª–µ–º—ã N+1** –≤ JPA/Hibernate.
## 1Ô∏è‚É£ –°–≤—è–∑—å –º–µ–∂–¥—É LAZY –∏ N+1
- –ö–æ–≥–¥–∞ —É —Å—É—â–Ω–æ—Å—Ç–∏ –µ—Å—Ç—å **–∫–æ–ª–ª–µ–∫—Ü–∏—è –∏–ª–∏ —Å—Å—ã–ª–∫–∞ —Å `fetch = LAZY`**, Hibernate **–Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å—Ä–∞–∑—É**.
- –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ —Å–æ–∑–¥–∞—ë—Ç—Å—è **–ø—Ä–æ–∫—Å–∏** –∏–ª–∏ **–ª–µ–Ω–∏–≤–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è**, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ **—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏**.
## 2Ô∏è‚É£ –¢–∏–ø–∏—á–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π N+1 —Å –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π
### –ü—Ä–∏–º–µ—Ä —Å—É—â–Ω–æ—Å—Ç–µ–π
```java
@Entity
public class Author {
    @Id
    private Long id;
    private String name;

    @OneToMany(mappedBy = "author", fetch = FetchType.LAZY)
    private List<Book> books; // LAZY
}

@Entity
public class Book {
    @Id
    private Long id;
    private String title;

    @ManyToOne
    private Author author;
}
```
### –ö–æ–¥, –≤—ã–∑—ã–≤–∞—é—â–∏–π N+1
```java
List<Author> authors = authorRepository.findAll(); // 1 –∑–∞–ø—Ä–æ—Å
for (Author a : authors) {
    System.out.println(a.getBooks().size()); // –¥–æ—Å—Ç—É–ø –∫ LAZY-–ø–æ–ª–µ
}
```
**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ SQL:**
1. Hibernate –≤—ã–ø–æ–ª–Ω—è–µ—Ç **1 –∑–∞–ø—Ä–æ—Å**, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –∞–≤—Ç–æ—Ä–æ–≤:
```sql
SELECT * FROM authors;
```
2. –ó–∞—Ç–µ–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–≤—Ç–æ—Ä–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å**, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –µ–≥–æ –∫–Ω–∏–≥–∏:
```sql
SELECT * FROM books WHERE author_id = 1;
SELECT * FROM books WHERE author_id = 2;
SELECT * FROM books WHERE author_id = 3;
...
```
- –ï—Å–ª–∏ –∞–≤—Ç–æ—Ä–æ–≤ N ‚Üí –≤—Å–µ–≥–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **1 + N SQL-–∑–∞–ø—Ä–æ—Å–æ–≤**.
- –≠—Ç–æ –∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º–∞ **N+1**.
## 3Ô∏è‚É£ –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
- LAZY –∑–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ –±–∞–∑–µ **–¥–æ –º–æ–º–µ–Ω—Ç–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏–ª–∏ –ø—Ä–æ–∫—Å–∏**.
- –ï—Å–ª–∏ —Ç–∞–∫–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç **–≤ —Ü–∏–∫–ª–µ –ø–æ –º–Ω–æ–∂–µ—Å—Ç–≤—É —Å—É—â–Ω–æ—Å—Ç–µ–π**, Hibernate —Å–æ–∑–¥–∞—ë—Ç **–º–Ω–æ–∂–µ—Å—Ç–≤–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö SQL-–∑–∞–ø—Ä–æ—Å–æ–≤**.
**–ò—Ç–æ–≥:** –ª–µ–Ω–∏–≤—ã–µ —Å–≤—è–∑–∏ ‚Üí –º–Ω–æ–≥–æ –º–∞–ª–µ–Ω—å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí –ø–∞–¥–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.
## 4Ô∏è‚É£ –ö–∞–∫ —ç—Ç–æ —Ä–µ—à–∞–µ—Ç—Å—è

|–†–µ—à–µ–Ω–∏–µ|–ö–∞–∫ –ø–æ–º–æ–≥–∞–µ—Ç|
|---|---|
|**JOIN FETCH**|–ü–æ–¥–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ —Å–≤—è–∑–∏ —Å—Ä–∞–∑—É –≤ –æ–¥–Ω–æ–º SQL ‚Üí N+1 –∏—Å—á–µ–∑–∞–µ—Ç|
|**@EntityGraph**|–î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç –ª–µ–Ω–∏–≤—ã–µ —Å–≤—è–∑–∏ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º|
|**Batch Fetching**|–ü–æ–¥–≥—Ä—É–∂–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–µ–Ω–∏–≤—ã—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º (—É–º–µ–Ω—å—à–∞–µ—Ç N)|
|**DTO / –ø—Ä–æ–µ–∫—Ü–∏–∏**|–í—ã–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è –∏ —Å–≤—è–∑–∏ ‚Üí –Ω–∏–∫–∞–∫–æ–≥–æ –ª–µ–Ω–∏–≤–æ–≥–æ –ø—Ä–æ–∫—Å–∏ –Ω–µ—Ç|
### üîπ –í–∏–∑—É–∞–ª—å–Ω–æ
```
–ë–µ–∑ JOIN FETCH:

1 SQL: SELECT * FROM authors;
N SQL: SELECT * FROM books WHERE author_id = ?;  (–¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–≤—Ç–æ—Ä–∞)

–° JOIN FETCH:

1 SQL: SELECT a.*, b.* FROM authors a
       LEFT JOIN books b ON a.id = b.author_id;
```
### ‚úÖ –í—ã–≤–æ–¥
- **–î–∞, –ª–µ–Ω–∏–≤—ã–µ —Å–≤—è–∑–∏ –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ N+1**, –µ—Å–ª–∏ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –Ω–∏–º –≤–Ω–µ –∑–∞–ø—Ä–æ—Å–∞ —Å –ø–æ–¥–≥—Ä—É–∑–∫–æ–π.
- **–ü—Ä–∏—á–∏–Ω–∞:** LAZY —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–æ–∫—Å–∏ ‚Üí –¥–æ—Å—Ç—É–ø –∫ –Ω–∏–º –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã.
- **–†–µ—à–µ–Ω–∏–µ:** –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å —Å–≤—è–∑–∏ –∑–∞—Ä–∞–Ω–µ–µ (`JOIN FETCH`, `@EntityGraph`) –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DTO/Batch Fetch.