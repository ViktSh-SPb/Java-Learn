# **Parallel Stream –≤ Java**  

**Parallel Stream** ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º Java Stream API –¥–ª—è **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö**, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ—Ç–æ–∫–∞–º–∏ (—è–¥—Ä–∞–º–∏ CPU) –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π.  

## üîπ **–û—Å–Ω–æ–≤–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**
‚úî **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏–≤–∞–Ω–∏–µ** (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç `ForkJoinPool` –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º).  
‚úî **–£—Å–∫–æ—Ä—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö** (–Ω–æ –º–æ–∂–µ—Ç –∑–∞–º–µ–¥–ª—è—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞ –º–∞–ª—ã—Ö –∫–æ–ª–ª–µ–∫—Ü–∏—è—Ö –∏–∑-–∑–∞ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤).  
‚úî **–ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è** (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏–ª–∏ –∏–∑–º–µ–Ω—è–µ–º—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è).  
‚úî **–ü–æ—Ä—è–¥–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –º–æ–∂–µ—Ç –Ω–∞—Ä—É—à–∞—Ç—å—Å—è** (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `forEachOrdered`).  

---

## üîπ **–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å Parallel Stream?**
–ï—Å—Ç—å –¥–≤–∞ —Å–ø–æ—Å–æ–±–∞:  

### 1. –ò–∑ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ `parallelStream()`
```java
List<String> list = Arrays.asList("a", "b", "c");
Stream<String> parallelStream = list.parallelStream();  // –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫
```

### 2. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –æ–±—ã—á–Ω—ã–π Stream –≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π —á–µ—Ä–µ–∑ `parallel()`
```java
Stream<String> stream = Stream.of("a", "b", "c");
Stream<String> parallelStream = stream.parallel();  // –î–µ–ª–∞–µ–º –ø–æ—Ç–æ–∫ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º
```

---

## üîπ **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Parallel Stream?**
1. **–î–∞–Ω–Ω—ã–µ —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ —á–∞—Å—Ç–∏** (splitting).  
2. **–ö–∞–∂–¥–∞—è —á–∞—Å—Ç—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ** (ForkJoinPool.commonPool()).  
3. **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è** (combining).  

### üî∏ –ü—Ä–∏–º–µ—Ä:
```java
List<Integer> numbers = List.of(1, 2, 3, 4, 5, 6, 7, 8, 9, 10);

// –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ (–æ–±—ã—á–Ω—ã–π Stream)
long seqTime = System.currentTimeMillis();
numbers.stream()
       .map(n -> n * 2)
       .forEach(System.out::println);
System.out.println("Sequential time: " + (System.currentTimeMillis() - seqTime) + " ms");

// –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ (Parallel Stream)
long parTime = System.currentTimeMillis();
numbers.parallelStream()
       .map(n -> n * 2)
       .forEach(System.out::println);
System.out.println("Parallel time: " + (System.currentTimeMillis() - parTime) + " ms");
```
üëâ **–í—ã–≤–æ–¥ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Ä–∞–∑–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ**, —Ç–∞–∫ –∫–∞–∫ –ø–æ—Ç–æ–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.  

---

## üîπ **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Parallel Stream?**
‚úÖ **–ë–æ–ª—å—à–∏–µ –æ–±—ä–µ–º—ã –¥–∞–Ω–Ω—ã—Ö** (–æ—Ç 10_000+ —ç–ª–µ–º–µ–Ω—Ç–æ–≤).  
‚úÖ **–í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ —Å–ª–æ–∂–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∞—Å—á–µ—Ç—ã).  
‚úÖ **–ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** (–Ω–µ—Ç shared mutable state).  

### ‚ùå **–ö–æ–≥–¥–∞ –ù–ï —Å—Ç–æ–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?**
- **–ú–∞–ª–µ–Ω—å–∫–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏** (–Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏–≤–∞–Ω–∏–µ –ø—Ä–µ–≤—ã—Å—è—Ç –≤—ã–≥–æ–¥—É).  
- **–û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏** (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è, IO-–æ–ø–µ—Ä–∞—Ü–∏–∏).  
- **–ö–æ–≥–¥–∞ –≤–∞–∂–µ–Ω –ø–æ—Ä—è–¥–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤** (–µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `forEachOrdered`).  

---

## üîπ **–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**
### 1. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞**
```java
List<Integer> numbers = List.of(1, 2, 3, 4, 5, 6, 7, 8, 9, 10);

List<Integer> evenSquares = numbers.parallelStream()
    .filter(n -> n % 2 == 0)
    .map(n -> n * n)
    .collect(Collectors.toList());

System.out.println(evenSquares);  // [4, 16, 36, 64, 100]
```

### 2. **–°—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ (`reduce` –≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ)**
```java
int sum = numbers.parallelStream()
    .reduce(0, Integer::sum);  // 55
```

### 3. **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ (`groupingByConcurrent` –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤)**
```java
Map<Integer, List<String>> grouped = words.parallelStream()
    .collect(Collectors.groupingByConcurrent(String::length));  // –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∞–Ω–∞–ª–æ–≥ groupingBy
```

---

## üîπ **–ü—Ä–æ–±–ª–µ–º—ã –∏ –ø–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏**
### 1. **–°–æ—Å—Ç–æ—è–Ω–∏–µ –≥–æ–Ω–∫–∏ (Race Condition)**
–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–∑–º–µ–Ω—è–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–Ω–µ—à–Ω—è—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è), –≤–æ–∑–º–æ–∂–Ω—ã –æ—à–∏–±–∫–∏:
```java
List<Integer> list = new ArrayList<>();
IntStream.range(0, 1000).parallel().forEach(list::add);  // –ú–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å ConcurrentModificationException
```
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (`ConcurrentHashMap`, `CopyOnWriteArrayList`) –∏–ª–∏ `collect()`:
```java
List<Integer> safeList = IntStream.range(0, 1000)
    .parallel()
    .boxed()
    .collect(Collectors.toList());
```

### 2. **–ü–æ—Ä—è–¥–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤**
```java
List<Integer> nums = List.of(1, 2, 3, 4, 5);
nums.parallelStream().forEach(System.out::print);  // –ú–æ–∂–µ—Ç –≤—ã–≤–µ—Å—Ç–∏ "3 1 5 2 4"
```
**–ï—Å–ª–∏ –ø–æ—Ä—è–¥–æ–∫ –≤–∞–∂–µ–Ω:**  
```java
nums.parallelStream().forEachOrdered(System.out::print);  // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ—Ä—è–¥–æ–∫: 1 2 3 4 5
```

### 3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ –Ω–µ –≤—Å–µ–≥–¥–∞ –±—ã—Å—Ç—Ä–µ–µ** (–∏–∑-–∑–∞ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤).  
- **–ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —è–¥–µ—Ä CPU** (–Ω–∞ 2-—è–¥–µ—Ä–Ω–æ–º CPU —É—Å–∫–æ—Ä–µ–Ω–∏–µ –±—É–¥–µ—Ç –º–µ–Ω—å—à–µ, —á–µ–º –Ω–∞ 16-—è–¥–µ—Ä–Ω–æ–º).  

---

## üîπ **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Parallel Stream**
### 1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–≤–æ–µ–≥–æ `ForkJoinPool`**
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é Parallel Stream –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `ForkJoinPool.commonPool()`.  
–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞–¥–∞—Ç—å —Å–≤–æ–π –ø—É–ª –ø–æ—Ç–æ–∫–æ–≤:
```java
ForkJoinPool customPool = new ForkJoinPool(4);  // –ü—É–ª –∏–∑ 4 –ø–æ—Ç–æ–∫–æ–≤
customPool.submit(() -> 
    numbers.parallelStream()
        .map(n -> n * 2)
        .forEach(System.out::println)
).get();
```

### 2. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞**
```java
System.setProperty("java.util.concurrent.ForkJoinPool.common.parallelism", "8");  // 8 –ø–æ—Ç–æ–∫–æ–≤
```

---

## üîπ **–í—ã–≤–æ–¥**
- **Parallel Stream** ‚Äî –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ Java.  
- **–õ—É—á—à–µ –≤—Å–µ–≥–æ —Ä–∞–±–æ—Ç–∞–µ—Ç** –Ω–∞ –º–Ω–æ–≥–æ—è–¥–µ—Ä–Ω—ã—Ö CPU –∏ –±–æ–ª—å—à–∏—Ö –Ω–∞–±–æ—Ä–∞—Ö –¥–∞–Ω–Ω—ã—Ö.  
- **–¢—Ä–µ–±—É–µ—Ç –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏** —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏ –ø–æ—Ä—è–¥–∫–æ–º —ç–ª–µ–º–µ–Ω—Ç–æ–≤.  
- **–ù–µ –≤—Å–µ–≥–¥–∞ –±—ã—Å—Ç—Ä–µ–µ** –æ–±—ã—á–Ω–æ–≥–æ Stream (—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö!).  

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Parallel Stream —Ç–∞–º, –≥–¥–µ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –¥–∞–µ—Ç –ø—Ä–∏—Ä–æ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏! üöÄ