–û–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ ‚Äî —ç—Ç–æ –ø–æ–¥—Ö–æ–¥ –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º –∫ –¥–∞–Ω–Ω—ã–º, –∫–æ—Ç–æ—Ä—ã–π **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —è–≤–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏** –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏, –∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã **–ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é**. –û–Ω–∞ –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–∞ –¥–ª—è —Å–∏—Å—Ç–µ–º —Å –≤—ã—Å–æ–∫–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–µ–π –∏ —á–∞—Å—Ç—ã–º —á—Ç–µ–Ω–∏–µ–º, –Ω–æ —Ä–µ–¥–∫–∏–º–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏.
## 1Ô∏è‚É£ –ò–¥–µ—è –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è **—á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫**.
- –ü–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ **–Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –¥—Ä—É–≥–∏–º–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏**.
- –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å, –æ–ø–µ—Ä–∞—Ü–∏—è **–æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∏ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è**.
üìå –ü—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ—Å—Ç—å: **–ø–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞** ‚Äî –¥–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è —Å—Ä–∞–∑—É –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏, —á—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º.
## 2Ô∏è‚É£ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤–µ—Ä—Å–∏–∏ (versioning)
### –®–∞–≥–∏:
1. –î–æ–±–∞–≤–ª—è–µ–º –≤ —Ç–∞–±–ª–∏—Ü—É **—Å—Ç–æ–ª–±–µ—Ü –≤–µ—Ä—Å–∏–∏** –∏–ª–∏ `timestamp`:
```sql
CREATE TABLE accounts (
    id SERIAL PRIMARY KEY,
    balance NUMERIC(10,2),
    version INT DEFAULT 1
);
```
2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤–º–µ—Å—Ç–µ —Å –≤–µ—Ä—Å–∏–µ–π:
```sql
SELECT balance, version FROM accounts WHERE id = 1;
```
3. –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é:
```sql
UPDATE accounts
SET balance = 900, version = version + 1
WHERE id = 1 AND version = 1;
```
- –ï—Å–ª–∏ `WHERE version = 1` –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É–ª–æ —Å—Ç—Ä–æ–∫—É ‚Üí –∑–Ω–∞—á–∏—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π ‚Üí –æ—Ç–∫–∞—Ç –∏–ª–∏ –ø–æ–≤—Ç–æ—Ä.
## 3Ô∏è‚É£ –ü—Ä–∏–º–µ—Ä –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Java + JPA)
```java
@Entity
public class Account {
    @Id
    private Long id;
    
    private BigDecimal balance;

    @Version
    private Long version; // JPA –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫—É—é –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
}
```
- –ü—Ä–∏ `entityManager.merge(account)` Hibernate –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `version`.
- –ï—Å–ª–∏ –≤–µ—Ä—Å–∏—è –∏–∑–º–µ–Ω–∏–ª–∞—Å—å, –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è `OptimisticLockException`, –∏ –º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é.
## 4Ô∏è‚É£ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
- üîπ –í—ã—Å–æ–∫–∏–π –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º ‚Äî –Ω–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –Ω–∞ —á—Ç–µ–Ω–∏–µ.
- üîπ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–∏—Å—Ç–µ–º —Å **–º–Ω–æ–≥–æ —á—Ç–µ–Ω–∏–π –∏ —Ä–µ–¥–∫–∏–º–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏**.
- üîπ –ü—Ä–æ—Å—Ç–æ–π –º–µ—Ö–∞–Ω–∏–∑–º –æ—Ç–∫–∞—Ç–∞ –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ.
## 5Ô∏è‚É£ –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏
- ‚ö† –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –Ω—É–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
- ‚ö† –ï—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —á–∞—Å—Ç–æ, –º–æ–∂–µ—Ç –±—ã—Ç—å –º–Ω–æ–≥–æ **–ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**.
- ‚ö† –ù–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Ñ–∞–Ω—Ç–æ–º–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–∞—Ö –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö ‚Äî –¥–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω—ã –¥—Ä—É–≥–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã.
## 6Ô∏è‚É£ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π

|–ü–∞—Ä–∞–º–µ—Ç—Ä|–û–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞|–ü–µ—Å—Å–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞|
|---|---|---|
|–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏|–ù–µ—Ç –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏|–ï—Å—Ç—å –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏/–∏–∑–º–µ–Ω–µ–Ω–∏–∏|
|–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã|–û–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ –∑–∞–ø–∏—Å–∏|–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—Ç—Å—è –∑–∞—Ä–∞–Ω–µ–µ|
|–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º|–í—ã—Å–æ–∫–∏–π|–ù–∏–∑–∫–∏–π|
|–ù–∞–≥—Ä—É–∑–∫–∞|–ù–∞ –ø–æ–≤—Ç–æ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π|–ù–∞ —É–¥–µ—Ä–∂–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫|
‚úÖ **–ò—Ç–æ–≥:**
–û–ø—Ç–∏–º–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ ‚Äî —ç—Ç–æ **–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º** –≤–º–µ—Å—Ç–æ —É–¥–µ—Ä–∂–∞–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –Ω–∞ —á—Ç–µ–Ω–∏–µ. –û–Ω–∞ –ø–æ–≤—ã—à–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º –∏ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–∏—Å—Ç–µ–º —Å —á–∞—Å—Ç—ã–º–∏ —á—Ç–µ–Ω–∏—è–º–∏ –∏ —Ä–µ–¥–∫–∏–º–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏.