–ù–∞—Å—Ç—Ä–æ–π–∫–∞ **–º–∞—Å—Ç–µ—Ä-—Å–ª–µ–π–≤ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏** (–∏–ª–∏ **primary-replica**) –≤ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö ‚Äî —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –¥–∞–Ω–Ω—ã–µ —Å –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (**–º–∞—Å—Ç–µ—Ä–∞**) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –Ω–∞ –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ **—Å–ª–µ–π–≤–æ–≤** (—Ä–µ–ø–ª–∏–∫).
### üß≠ 1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –º–∞—Å—Ç–µ—Ä–∞ (primary)**
1. **–†–∞–∑—Ä–µ—à–∏—Ç—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**  
    –í —Ñ–∞–π–ª–µ `postgresql.conf`:
    ```conf
    wal_level = replica
    max_wal_senders = 10
    wal_keep_size = 512MB
    archive_mode = on
    archive_command = 'cp %p /var/lib/postgresql/archive/%f'
    ```
    - `wal_level = replica` ‚Äî –≤–∫–ª—é—á–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ—Ç–æ–∫–æ–≤–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏.
    - `max_wal_senders` ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –æ—Ç —Å–ª–µ–π–≤–æ–≤.
    - `wal_keep_size` ‚Äî —É–∫–∞–∑—ã–≤–∞–µ—Ç, —Å–∫–æ–ª—å–∫–æ WAL –ª–æ–≥–æ–≤ —Ö—Ä–∞–Ω–∏—Ç—å, —á—Ç–æ–±—ã —Å–ª–µ–π–≤—ã –º–æ–≥–ª–∏ –∏—Ö –¥–æ–≥–Ω–∞—Ç—å.
2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ—Å—Ç—É–ø –¥–ª—è —Ä–µ–ø–ª–∏–∫**  
    –í —Ñ–∞–π–ª–µ `pg_hba.conf` –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É, —Ä–∞–∑—Ä–µ—à–∞—é—â—É—é –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –æ—Ç —Ä–µ–ø–ª–∏–∫–∏:
    ```
    host replication replicator 192.168.1.10/32 md5
    ```
    –ó–¥–µ—Å—å:
    - `replicator` ‚Äî –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏.
    - `192.168.1.10` ‚Äî IP —Å–ª–µ–π–≤–∞.
3. **–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏**
    ```sql
    CREATE ROLE replicator WITH REPLICATION LOGIN ENCRYPTED PASSWORD 'secret';
    ```
4. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä**
    ```bash
    sudo systemctl restart postgresql
    ```
### üß≠ 2. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–ª–µ–π–≤–∞ (replica)**
1. **–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä —Å–ª–µ–π–≤–∞**
    ```bash
    sudo systemctl stop postgresql
    ```
2. **–°—Ç–µ—Ä–µ—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ —Å–¥–µ–ª–∞—Ç—å base backup**
    ```bash
    rm -rf /var/lib/postgresql/data/*
    pg_basebackup -h 192.168.1.1 -D /var/lib/postgresql/data -U replicator -P -R
    ```
    - `192.168.1.1` ‚Äî IP –º–∞—Å—Ç–µ—Ä–∞.
    - `-R` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç —Ñ–∞–π–ª `standby.signal` –∏ –ø—Ä–æ–ø–∏—à–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏.
3. **–£–±–µ–¥–∏—Ç—å—Å—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö `postgresql.conf`**  
    –û–±—ã—á–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ:
    ```conf
    hot_standby = on
    ```
4. **–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–ª–µ–π–≤**
    ```bash
    sudo systemctl start postgresql
    ```
### üß≠ 3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏**
–ù–∞ –º–∞—Å—Ç–µ—Ä–µ:
```sql
SELECT client_addr, state, sync_state FROM pg_stat_replication;
```
–ï—Å–ª–∏ –≤—Å—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –≤—ã —É–≤–∏–¥–∏—Ç–µ –∞–∫—Ç–∏–≤–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–ø–ª–∏–∫–∏.  
–ù–∞ —Å–ª–µ–π–≤–µ:
```sql
SELECT pg_is_in_recovery();
```
–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `true`, —Ç–∞–∫ –∫–∞–∫ —Ä–µ–ø–ª–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ —Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏—è.
### üß∞ 4. **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –æ–ø—Ü–∏–∏**
- –†–µ–ø–ª–∏–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π** (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∫–æ–º–º–∏—Ç—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏ –Ω–∞ —Å–ª–µ–π–≤) –∏–ª–∏ **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π** (—Ä–µ–ø–ª–∏–∫–∞ –º–æ–∂–µ—Ç –Ω–µ–º–Ω–æ–≥–æ –æ—Ç—Å—Ç–∞–≤–∞—Ç—å).
- –ù–∞ —Å–ª–µ–π–≤–µ –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å **—Ç–æ–ª—å–∫–æ SELECT**, –µ—Å–ª–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Ä–µ–∂–∏–º logical replication.
- –ï—Å–ª–∏ –º–∞—Å—Ç–µ—Ä –ø–∞–¥–∞–µ—Ç ‚Äî —Å–ª–µ–π–≤ –º–æ–∂–Ω–æ **–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—å –≤ —Ä–æ–ª—å –º–∞—Å—Ç–µ—Ä–∞** (promote).
### üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –º–∞—Å—Ç–µ—Ä-—Å–ª–µ–π–≤ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏:
- –ü–æ–≤—ã—à–µ–Ω–∏–µ **–æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏** ‚Äî –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Å–ª–µ–π–≤.
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —á—Ç–µ–Ω–∏–µ** ‚Äî –Ω–∞–≥—Ä—É–∑–∫—É SELECT-–∑–∞–ø—Ä–æ—Å–æ–≤ –º–æ–∂–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å.
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å **—Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è** –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –º–∞—Å—Ç–µ—Ä.