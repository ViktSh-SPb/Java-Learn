# üöÄ 1. –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å **Caffeine Cache** (–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ª–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à)
Caffeine ‚Äî –±—ã—Å—Ç—Ä—ã–π, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫—ç—à –≤ –ø–∞–º—è—Ç–∏. –ò–¥–µ–∞–ª–µ–Ω –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤, –≥–¥–µ –∫—ç—à –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –∏–Ω—Å—Ç–∞–Ω—Å–∞.
## ‚úÖ –®–∞–≥ 1. –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
```xml
<dependency>
    <groupId>com.github.ben-manes.caffeine</groupId>
    <artifactId>caffeine</artifactId>
</dependency>
```
## ‚úÖ –®–∞–≥ 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `application.yml`
Spring Boot –ø–æ–Ω–∏–º–∞–µ—Ç Caffeine ¬´–∏–∑ –∫–æ—Ä–æ–±–∫–∏¬ª:
```yaml
spring:
  cache:
    type: caffeine
    cache-names: products, users
    caffeine:
      spec: maximumSize=500,expireAfterWrite=10m
```
`spec` –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–∞–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `expireAfterWrite=10m` ‚Äî TTL 10 –º–∏–Ω—É—Ç
- `expireAfterAccess=5m`
- `maximumSize=500`
- `initialCapacity=100`
## ‚úÖ –®–∞–≥ 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ @Cacheable
```java
@Cacheable(value = "products", key = "#id")
public Product getProduct(Long id) {
    return repo.findById(id).orElseThrow();
}
```
–ò –≤—Å—ë ‚Äî Caffeine —Ä–∞–±–æ—Ç–∞–µ—Ç.
# üß© –ö–∞—Å—Ç–æ–º–Ω—ã–π CacheManager (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
–ú–æ–∂–Ω–æ –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```java
@Configuration
public class CacheConfig {

    @Bean
    public CaffeineCacheManager caffeineCacheManager() {
        CaffeineCacheManager manager =
                new CaffeineCacheManager("products", "users");

        manager.setCaffeine(Caffeine.newBuilder()
                .expireAfterWrite(10, TimeUnit.MINUTES)
                .maximumSize(1000)
        );
        return manager;
    }
}
```
# üöÄ 2. –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å **Redis Cache** (—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –∫—ç—à –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏)
Redis ‚Äî –∏–¥–µ–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤, –∫–æ–≥–¥–∞ –∫—ç—à –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **–æ–±—â–∏–º** –º–µ–∂–¥—É –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏.
## ‚úÖ –®–∞–≥ 1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>
```
## ‚úÖ –®–∞–≥ 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Redis –≤ `application.yml`
```yaml
spring:
  cache:
    type: redis
    cache-names: products, users

  redis:
    host: localhost
    port: 6379
    password: your_password  # –µ—Å–ª–∏ –µ—Å—Ç—å
```
–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ Spring –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç `RedisCacheManager`.
## ‚öôÔ∏è –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ TTL –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫—ç—à–µ–π
```java
@Configuration
public class RedisCacheConfig {

    @Bean
    public RedisCacheManager cacheManager(RedisConnectionFactory connectionFactory) {

        RedisCacheConfiguration defaultConfig =
                RedisCacheConfiguration.defaultCacheConfig()
                        .entryTtl(Duration.ofMinutes(10));

        Map<String, RedisCacheConfiguration> configs = new HashMap<>();
        configs.put("products", defaultConfig.entryTtl(Duration.ofMinutes(5)));
        configs.put("users", defaultConfig.entryTtl(Duration.ofHours(1)));

        return RedisCacheManager.builder(connectionFactory)
                .cacheDefaults(defaultConfig)
                .withInitialCacheConfigurations(configs)
                .build();
    }
}
```
## üî• –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è JSON –≤ Redis
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è JDK —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è (–Ω–µ—É–¥–æ–±–Ω–æ).  
–õ—É—á—à–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å Jackson:
```java
@Bean
public RedisCacheConfiguration redisCacheConfiguration() {
    return RedisCacheConfiguration.defaultCacheConfig()
        .serializeValuesWith(
            RedisSerializationContext.SerializationPair.fromSerializer(
                new GenericJackson2JsonRedisSerializer()
            )
        );
}
```
## ‚õì –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
```java
@Cacheable(value = "products", key = "#id")
public Product getProduct(Long id) {
    return repo.findById(id).orElseThrow();
}
```
–¢–µ–ø–µ—Ä—å –∫—ç—à —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Redis, –∞ –Ω–µ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
# üìå Redis vs Caffeine: —á—Ç–æ –≤—ã–±—Ä–∞—Ç—å?

|–ö—Ä–∏—Ç–µ—Ä–∏–π|Caffeine|Redis|
|---|---|---|
|–°–∫–æ—Ä–æ—Å—Ç—å|üü¢ –æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è|üü° –≤—ã—Å–æ–∫–∞—è (—Å–µ—Ç–µ–≤–æ–π –≤—ã–∑–æ–≤)|
|–†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç—å|‚ùå –Ω–µ—Ç|‚úî –µ—Å—Ç—å|
|–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å|‚ùå –Ω–µ—Ç|üü° –º–æ–∂–Ω–æ|
|TTL, eviction|‚úî –≥–∏–±–∫–∏–µ|‚úî –≥–∏–±–∫–∏–µ|
|–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞—Ö|üü° –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ|üü¢ –∏–¥–µ–∞–ª—å–Ω–æ|
–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- **–æ–¥–∏–Ω –∏–Ω—Å—Ç–∞–Ω—Å ‚Äî Caffeine**
- **–Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤ / –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã ‚Äî Redis**
- **–∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Äî Redis + Caffeine Hybrid Layer (–¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤—ã–π)**
# üß† –ò—Ç–æ–≥
–ß—Ç–æ–±—ã –ø–æ–¥–∫–ª—é—á–∏—Ç—å –≤–Ω–µ—à–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:
## üîπ Caffeine:
- –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
- —É–∫–∞–∑–∞—Ç—å `spring.cache.type=caffeine`
- –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å `spec` –∏–ª–∏ `CacheManager`
## üîπ Redis:
- –ø–æ–¥–∫–ª—é—á–∏—Ç—å Redis dependency
- —É–∫–∞–∑–∞—Ç—å `spring.cache.type=redis`
- –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π `RedisCacheManager`
- –¥–æ–±–∞–≤–∏—Ç—å JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é