## üß© –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –≤ Kafka
### 1Ô∏è‚É£ **–†–µ–ø–ª–∏–∫–∞—Ü–∏—è –ø–∞—Ä—Ç–∏—Ü–∏–π (Partition Replication)**
- –ö–∞–∂–¥—ã–π **—Ç–æ–ø–∏–∫** –¥–µ–ª–∏—Ç—Å—è –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ **–ø–∞—Ä—Ç–∏—Ü–∏–π (partitions)**.
- –ö–∞–∂–¥–∞—è –ø–∞—Ä—Ç–∏—Ü–∏—è **–∏–º–µ–µ—Ç —Ä–µ–ø–ª–∏–∫–∏** (–∫–æ–ø–∏–∏) –Ω–∞ –¥—Ä—É–≥–∏—Ö –±—Ä–æ–∫–µ—Ä–∞—Ö:
    - **Leader** ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –∫–æ–ø–∏—è, –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–µ—Ç —á—Ç–µ–Ω–∏–µ.
    - **Follower** ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∫–æ–ø–∏–∏, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å —Å –ª–∏–¥–µ—Ä–æ–º.
üìå _–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã_:  
–í—Å–µ –∑–∞–ø–∏—Å–∏ —Å–Ω–∞—á–∞–ª–∞ –ø–∏—à—É—Ç—Å—è –≤ –ª–∏–¥–µ—Ä–∞, –∑–∞—Ç–µ–º —Ä–µ–ø–ª–∏—Ü–∏—Ä—É—é—Ç—Å—è –Ω–∞ —Ñ–æ–ª–ª–æ–≤–µ—Ä–æ–≤. –ï—Å–ª–∏ –ª–∏–¥–µ—Ä –ø–∞–¥–∞–µ—Ç ‚Äî –æ–¥–∏–Ω –∏–∑ —Ñ–æ–ª–ª–æ–≤–µ—Ä–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–æ–≤—ã–º –ª–∏–¥–µ—Ä–æ–º.
### 2Ô∏è‚É£ **Acknowledgements (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏)**
- –ü—Ä–æ–¥—é—Å–µ—Ä –º–æ–∂–µ—Ç –∑–∞–¥–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä `acks` –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –∑–∞–ø–∏—Å–∏:

|acks|–û–ø–∏—Å–∞–Ω–∏–µ|
|---|---|
|`0`|–ü—Ä–æ–¥—é—Å–µ—Ä –Ω–µ –∂–¥—ë—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å, –Ω–æ —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä—å)|
|`1`|–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç –ª–∏–¥–µ—Ä–∞ partition (–Ω–∞–¥–µ–∂–Ω–æ, –ø–æ–∫–∞ –ª–∏–¥–µ—Ä –∂–∏–≤)|
|`all`|–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç –≤—Å–µ—Ö —Ä–µ–ø–ª–∏–∫ (ISR ‚Äî in-sync replicas) ‚Üí —Å–∞–º–∞—è –Ω–∞–¥–µ–∂–Ω–∞—è –æ–ø—Ü–∏—è|

- **ISR (in-sync replicas)** ‚Äî —Å–ø–∏—Å–æ–∫ —Ä–µ–ø–ª–∏–∫, –∫–æ—Ç–æ—Ä—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å –ª–∏–¥–µ—Ä–æ–º. –¢–æ–ª—å–∫–æ —ç—Ç–∏ —Ä–µ–ø–ª–∏–∫–∏ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –¥–ª—è `acks=all`.
### 3Ô∏è‚É£ **–•—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ –¥–∏—Å–∫–µ (Durable Storage)**
- Kafka —Ö—Ä–∞–Ω–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏—è **–Ω–∞ –¥–∏—Å–∫–µ**, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –≤ –ø–∞–º—è—Ç–∏.
- –õ–æ–≥–∏ partition‚Äô–æ–≤ **append-only**, —á—Ç–æ:
    - –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö;
    - —É—Å–∫–æ—Ä—è–µ—Ç –∑–∞–ø–∏—Å—å –∏ —á—Ç–µ–Ω–∏–µ.
- –°–æ–æ–±—â–µ–Ω–∏—è –º–æ–≥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –ø–æ **–≤—Ä–µ–º–µ–Ω–∏ (retention.ms)** –∏–ª–∏ –ø–æ **—Ä–∞–∑–º–µ—Ä—É (retention.bytes)**.
### 4Ô∏è‚É£ **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –±—Ä–æ–∫–µ—Ä–æ–≤ (Broker Failover)**
- Kafka –∫–ª–∞—Å—Ç–µ—Ä —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –±—Ä–æ–∫–µ—Ä–æ–≤.
- –ï—Å–ª–∏ –æ–¥–∏–Ω –±—Ä–æ–∫–µ—Ä –ø–∞–¥–∞–µ—Ç:
    - —Ä–µ–ø–ª–∏–∫–∏ –¥—Ä—É–≥–∏—Ö –±—Ä–æ–∫–µ—Ä–æ–≤ –±–µ—Ä—É—Ç –Ω–∞ —Å–µ–±—è –ª–∏–¥–µ—Ä—à–∏–ø —É–ø–∞–≤—à–∏—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π;
    - –∫–ª–∏–µ–Ω—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ –Ω–æ–≤—ã–π –ª–∏–¥–µ—Ä–∞.
üìå –ë–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–º—É **–∫–ª–∞—Å—Ç–µ—Ä –æ—Å—Ç–∞—ë—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º –¥–∞–∂–µ –ø—Ä–∏ —Å–±–æ–µ –æ–¥–Ω–æ–≥–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É–∑–ª–æ–≤**.
### 5Ô∏è‚É£ **Consumer offset –∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ —á—Ç–µ–Ω–∏–µ**
- –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ —Ö—Ä–∞–Ω—è—Ç **offset** ‚Äî –ø–æ–∑–∏—Ü–∏—é, –¥–æ –∫–æ—Ç–æ—Ä–æ–π –æ–Ω–∏ –ø—Ä–æ—á–∏—Ç–∞–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è.
- –ï—Å–ª–∏ –∫–æ–Ω—Å—É–º–µ—Ä —É–ø–∞–ª:
    - –æ–Ω –º–æ–∂–µ—Ç –≤–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å —á—Ç–µ–Ω–∏–µ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ offset;
    - —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è –∏ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–Ω—ã.
### 6Ô∏è‚É£ **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ Exactly-Once Semantics**
- Kafka –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–æ–¥—é—Å–µ—Ä—ã** –∏ **exactly-once processing**:
    - –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π –≤ —Ä–∞–∑–Ω—ã—Ö —Ç–æ–ø–∏–∫–∞—Ö –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –∫–∞–∫ –µ–¥–∏–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è;
    - –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –±—É–¥—É—Ç –ø–æ—Ç–µ—Ä—è–Ω—ã –∏ –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è, –¥–∞–∂–µ –ø—Ä–∏ —Å–±–æ—è—Ö.
### 7Ô∏è‚É£ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ ISR –∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏**
- Kafka –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Ä–µ–ø–ª–∏–∫–∏:
    - —Ä–µ–ø–ª–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å –ª–∏–¥–µ—Ä–æ–º, –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è –∏–∑ ISR;
    - —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –Ω–æ–≤–æ–≥–æ –ª–∏–¥–µ—Ä–∞ –∏–∑ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö —Ä–µ–ø–ª–∏–∫.
–≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Ç–µ—Ä—é –¥–∞–Ω–Ω—ã—Ö –¥–∞–∂–µ –ø—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö –∏–ª–∏ —Å–±–æ—è—Ö —É–∑–ª–æ–≤.
## ‚ö° –°—Ö–µ–º–∞—Ç–∏—á–Ω–æ: –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å
```
Partition 0
  ‚îú‚îÄ‚îÄ Leader (Broker 1) ‚Üí –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø–∏—Å–∏
  ‚îú‚îÄ‚îÄ Follower (Broker 2) ‚Üí —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å –ª–∏–¥–µ—Ä–æ–º
  ‚îî‚îÄ‚îÄ Follower (Broker 3) ‚Üí —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å –ª–∏–¥–µ—Ä–æ–º

–ï—Å–ª–∏ Broker 1 –ø–∞–¥–∞–µ—Ç ‚Üí Broker 2 —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–æ–≤—ã–º –ª–∏–¥–µ—Ä–æ–º
```
- –í—Å–µ –ø—Ä–æ–¥—é—Å–µ—Ä—ã –∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ –Ω–æ–≤—ã–π –ª–∏–¥–µ—Ä.
- –ü–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç, –µ—Å–ª–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ (`acks=all`).
## üß† –ò—Ç–æ–≥
Kafka –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –±–ª–∞–≥–æ–¥–∞—Ä—è –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏:
1. **–†–µ–ø–ª–∏–∫–∞—Ü–∏–∏ –ø–∞—Ä—Ç–∏—Ü–∏–π –∏ ISR**
2. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –∑–∞–ø–∏—Å–∏ (acks)**
3. **–•—Ä–∞–Ω–µ–Ω–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –¥–∏—Å–∫–µ (durable storage)**
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º—É –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é –ª–∏–¥–µ—Ä–æ–≤ –ø—Ä–∏ —Å–±–æ—è—Ö**
5. **–ö–æ–Ω—Ç—Ä–æ–ª—é offset‚Äô–æ–≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è**
6. **–ü–æ–¥–¥–µ—Ä–∂–∫–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏ exactly-once semantics**
> –ë–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–∏–º –º–µ—Ö–∞–Ω–∏–∑–º–∞–º Kafka —Å–ø–æ—Å–æ–±–Ω–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å **–º–∏–ª–ª–∏–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É** –∏ –ø—Ä–∏ —ç—Ç–æ–º –±—ã—Ç—å –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ–π –∏ –Ω–∞–¥—ë–∂–Ω–æ–π.