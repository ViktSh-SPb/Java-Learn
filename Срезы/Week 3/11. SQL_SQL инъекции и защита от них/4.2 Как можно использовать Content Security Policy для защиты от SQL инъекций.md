Короткий ответ: **практически никак** — CSP не защищает сам сервер от SQL-инъекций.  
Но — важно — CSP может **снизить последствия** атак при определённых сценариях (например, помешать эксплуатации через браузер или утечке данных), поэтому это полезная часть _defence-in-depth_. 
## 1) Что умеет CSP и что — нет
- **Умеет:** ограничивать, какие скрипты/ресурсы может выполнять и загружать браузер; блокировать inline-скрипты, сторонние домены, сетевые соединения из JS; собирать отчёты о нарушениях. Помогает предотвратить или усложнить XSS и браузерную эксфильтрацию данных.
- **Не умеет:** защищать серверную логику или базу данных от вредоносного SQL-кода, отправленного с любого клиента. CSP — это политика браузера клиента, она **не влияет** на то, как сервер строит и выполняет SQL.
## 2) Когда CSP может уменьшить вред от SQLi (когда полезна косвенно)
- **Если** SQL-инъекция используется вместе с XSS/DOM-вектором для вывода данных на страницу и их автоматической отправки на внешние домены, то CSP может блокировать исполнение вредоносного JS или отправку данных (`connect-src`) — это мешает _эксфильтрации_.
- **Если** компрометация аккаунта через XSS использовалась для триггеринга опасных действий (например, через AJAX к уязвимому API, который воспринимает опасные параметры и формирует SQL), то запрет выполнения стороннего JS уменьшит вектор злоумышленника.
- CSP-отчёты (`report-to`/`report-uri`) помогают **обнаружить** попытки внедрения скриптов — индикатор атак (включая попытки XSS, которые иногда сочетают с SQLi).
Но: если атакующий напрямую посылает вредоносные SQL-параметры на сервер (через curl, API, curl-like бот), CSP никак не помешает — браузер тут не участвует.
## 3) Пример полезной CSP-политики (для уменьшения XSS/эксфильтрации)
```http
Content-Security-Policy:
  default-src 'self';
  script-src 'self' 'nonce-<RANDOM>' ;
  object-src 'none';
  base-uri 'self';
  frame-ancestors 'none';
  connect-src 'self';
  form-action 'self';
  report-uri https://csp-reports.example.com/report;
```
Коротко:
- `script-src 'self' 'nonce-...'` — запрещает inline-скрипты и сторонние скрипты, разрешая только заранее «подписанные» через nonce (уменьшает XSS).
- `connect-src 'self'` — блокирует отправку AJAX/WebSocket/Fetch данных на чужие домены (мешает эксфильтрации).
- `object-src 'none'`, `frame-ancestors 'none'` — блокируют risky embedding/plugins.
- `report-uri`/`report-to` — получать уведомления о нарушениях.
❗ Используйте `nonce` или `hash` (не `'unsafe-inline'`), иначе CSP теряет смысл.
## 4) Ограничения и моменты реализации
- CSP защищает только **клиентов** (браузеры), не сервера. Атаки через API, мобильные клиенты, curl, сервер-серверные вызовы при этом не блокируются.
- Неправильно сконфигурированная политика (слишком много разрешённых внешних доменов или `unsafe-*`) даёт ложное чувство безопасности.
- Некоторые обходы возможны, если сайт подключает доверенные, но скомпрометированные внешние скрипты (supply-chain).
- CSP требует тестирования: строгая политика может ломать легитимные функции.
## 5) Что делать на практике (рекомендации — Defence in Depth)
1. **Основная защита от SQL-инъекций** (обязательная):
    - Параметризованные запросы / PreparedStatements.
    - ORM с безопасной параметризацией.
    - Белые списки для динамических идентификаторов (таблицы/колонки/ORDER BY).
    - Минимальные привилегии у DB-пользователя.
    - Отключение возможности выполнения нескольких SQL-запросов в одном выражении, если не нужно.
2. **Дополнительно для уменьшения последствий через браузер:**
    - Внедрить строгую CSP (как выше) — чтобы блокировать XSS и эксфильтрацию.
    - Включить `X-Content-Type-Options: nosniff`, `X-Frame-Options`/`frame-ancestors`, HSTS.
    - Логи и CSP-отчёты для мониторинга.
3. **Сетевые и инфраструктурные меры:**
    - WAF (правила против SQLi).
    - Ограничение доступа к DB (IP-фильтрация, VPN).
    - Мониторинг аномалий SQL-запросов и лимитирование частоты.
4. **Процессы:**
    - Ревью кода на предмет прямых конкатенаций SQL.
    - SAST/DAST тестирование и периодические pentest’ы.
    - План реагирования: отключение функций, смена ключей, анализ логов.
## 6) Короткий итог (одно предложение)
**CSP — полезный инструмент для предотвращения XSS и затруднения клиентской эксфильтрации данных, но оно не заменяет серверных методов защиты от SQL-инъекций; используйте его как часть многоуровневой защиты вместе с параметризацией запросов, валидацией и правами доступа.**