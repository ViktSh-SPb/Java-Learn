## 1Ô∏è‚É£ **–ß—Ç–æ —Ç–∞–∫–æ–µ Redlock**
**Redlock** ‚Äî –∞–ª–≥–æ—Ä–∏—Ç–º, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–π –°–∞–ª—å–≤–∞—Ç–æ—Ä–µ –°–∞–Ω—Ñ–∏–ª–∏–ø–ø–æ (—Å–æ–∑–¥–∞—Ç–µ–ª–µ–º Redis), –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.
–ü—Ä–∏–Ω—Ü–∏–ø:
1. –†–∞–∑–¥–µ–ª—è–µ–º Redis –Ω–∞ **–Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö —É–∑–ª–æ–≤** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è ‚â•5).
2. –ö–ª–∏–µ–Ω—Ç –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞—Ö–≤–∞—Ç–∏—Ç—å **–æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —É–∑–ª–æ–≤** —Å TTL.
3. –ï—Å–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞—Ö–≤–∞—á–µ–Ω–∞ **–Ω–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —É–∑–ª–æ–≤** ‚Üí —Å—á–∏—Ç–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ–π.
4. –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏ –ø–æ–≤—Ç–æ—Ä—è–µ–º –ø–æ–ø—ã—Ç–∫—É —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à–æ–π –∏–Ω—Ç–µ—Ä–≤–∞–ª.
> –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å ‚Äî **–∏–∑–±–µ–∂–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –≥–æ–Ω–∫–∏ –∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏** –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ.
## 2Ô∏è‚É£ **–ü—Ä–æ—Å—Ç–æ–π –ø–æ–¥—Ö–æ–¥ —á–µ—Ä–µ–∑ –æ–¥–∏–Ω Redis**
–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–æ–¥–∏–Ω Redis**, –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã `SET` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ `NX` –∏ `PX`:
```java
String lockKey = "lock:user:1";
String lockValue = UUID.randomUUID().toString();
long expireTime = 5000; // 5 —Å–µ–∫—É–Ω–¥ TTL

Boolean acquired = redisTemplate.opsForValue().setIfAbsent(lockKey, lockValue, expireTime, TimeUnit.MILLISECONDS);

if (Boolean.TRUE.equals(acquired)) {
    try {
        // –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–µ–∫—Ü–∏—è
    } finally {
        // —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–æ–ª–∂–µ–Ω —É–¥–∞–ª—è—Ç—å –∫–ª—é—á
        String value = redisTemplate.opsForValue().get(lockKey);
        if (lockValue.equals(value)) {
            redisTemplate.delete(lockKey);
        }
    }
}
```
- `NX` ‚Üí —Å–æ–∑–¥–∞—Ç—å –∫–ª—é—á, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç.
- `PX` ‚Üí TTL –∫–ª—é—á–∞, —á—Ç–æ–±—ã –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–µ –∑–∞–≤–∏—Å–ª–∞.
## 3Ô∏è‚É£ **Redisson ‚Äî –≥–æ—Ç–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Redlock –¥–ª—è Java**
**Redisson** ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è Redis, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∞—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.
### üîπ Maven –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
```xml
<dependency>
    <groupId>org.redisson</groupId>
    <artifactId>redisson</artifactId>
    <version>3.20.0</version>
</dependency>
```
### üîπ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
```java
import org.redisson.Redisson;
import org.redisson.api.RLock;
import org.redisson.api.RedissonClient;
import org.redisson.config.Config;

import java.util.concurrent.TimeUnit;

public class DistributedLockExample {
    public static void main(String[] args) throws InterruptedException {
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Redis
        Config config = new Config();
        config.useSingleServer().setAddress("redis://127.0.0.1:6379");
        RedissonClient redisson = Redisson.create(config);

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
        RLock lock = redisson.getLock("user:1:lock");

        // –ü–æ–ø—ã—Ç–∫–∞ –∑–∞—Ö–≤–∞—Ç–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –Ω–∞ 10 —Å–µ–∫—É–Ω–¥, —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º 5 —Å–µ–∫—É–Ω–¥
        if (lock.tryLock(5, 10, TimeUnit.SECONDS)) {
            try {
                // –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–µ–∫—Ü–∏—è
                System.out.println("Lock acquired, processing...");
                Thread.sleep(2000); // –∏–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã
            } finally {
                lock.unlock();
                System.out.println("Lock released");
            }
        } else {
            System.out.println("Could not acquire lock");
        }

        redisson.shutdown();
    }
}
```
**–ü–ª—é—Å—ã Redisson:**
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **Redlock** –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö Redis-—É–∑–ª–æ–≤.
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞–≤–∞—Ç—å **TTL, –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏**.
- –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ.
## 4Ô∏è‚É£ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **TTL –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏**, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∑–∞–≤–∏—Å–∞–Ω–∏—è.
2. –ü—Ä–æ–≤–µ—Ä—è—Ç—å **—É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏** –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º (—á—Ç–æ–±—ã –¥—Ä—É–≥–æ–π –ø–æ—Ç–æ–∫ —Å–ª—É—á–∞–π–Ω–æ –Ω–µ —Å–Ω—è–ª –±–ª–æ–∫–∏—Ä–æ–≤–∫—É).
3. –î–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Redlock –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É–∑–ª–∞—Ö Redis**.
4. –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø—Ä–æ—Å—Ç–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ –æ–¥–∏–Ω —É–∑–µ–ª Redis ‚Üí `SET NX PX` –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ.
