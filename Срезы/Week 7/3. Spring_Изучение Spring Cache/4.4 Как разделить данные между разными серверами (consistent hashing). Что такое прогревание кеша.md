# üß© 1. –ö–∞–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏? (Consistent hashing)
**Consistent hashing (—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ)** ‚Äî —ç—Ç–æ –∞–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–ª—é—á–µ–π –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏ —Ç–∞–∫, —á—Ç–æ–±—ã –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞ **–ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–ª–æ—Å—å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö**.
–≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞ –¥–ª—è:  
‚úî —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –∫—ç—à–µ–π (Redis Cluster, Memcached)  
‚úî —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è –ë–î  
‚úî CDN  
‚úî —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Ö—Ä–∞–Ω–∏–ª–∏—â (Cassandra, Dynamo)
## üß† –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç consistent hashing
### 1. –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∫–æ–ª—å—Ü–∞
–°–æ–∑–¥–∞–µ—Ç—Å—è **—Ö–µ—à-–∫–æ–ª—å—Ü–æ** 0 ‚Ä¶ 2¬≥¬≤‚àí1.  
–ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–µ—Ä S·µ¢ —Ö–µ—à–∏—Ä—É–µ—Ç—Å—è ‚Üí –ø–æ–ø–∞–¥–∞–µ—Ç –Ω–∞ –∫–æ–ª—å—Ü–æ.
### 2. –†–∞–∑–º–µ—â–µ–Ω–∏–µ –∫–ª—é—á–µ–π
–ö–∞–∂–¥—ã–π –∫–ª—é—á K —Ö–µ—à–∏—Ä—É–µ—Ç—Å—è **—Ç–µ–º –∂–µ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º** ‚Üí –ø–æ–ø–∞–¥–∞–µ—Ç –≤ —Ç–æ—á–∫—É –Ω–∞ –∫–æ–ª—å—Ü–µ.  
–ö–ª—é—á –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è **–ø–µ—Ä–≤–æ–º—É —Å–µ—Ä–≤–µ—Ä—É –ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ**.
### 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞
–ù–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –∫–æ–ª—å—Ü–æ ‚Üí **—Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å –∫–ª—é—á–µ–π –º–µ–∂–¥—É –Ω–∏–º –∏ —Å–ª–µ–¥—É—é—â–∏–º —Å–µ—Ä–≤–µ—Ä–æ–º** –ø–µ—Ä–µ–ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è.
### 4. –£–¥–∞–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞
–¢–æ–ª—å–∫–æ –∫–ª—é—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –ª–µ–∂–∞–ª–∏ –º–µ–∂–¥—É –ø—Ä–µ–¥—ã–¥—É—â–∏–º –∏ —Å–ª–µ–¥—É—é—â–∏–º —É–∑–ª–æ–º, –ø–µ—Ä–µ–µ–∑–∂–∞—é—Ç.
## üõ† –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —É–∑–ª—ã
–î–ª—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–∞–∂–¥—ã–π —Å–µ—Ä–≤–µ—Ä —Ä–∞–∑–º–µ—â–∞–µ—Ç—Å—è –Ω–∞ –∫–æ–ª—å—Ü–µ **–º–Ω–æ–≥–æ —Ä–∞–∑**: S1#1, S1#2, ‚Ä¶
–≠—Ç–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É, –∫–æ–≥–¥–∞ –æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∫–ª—é—á–µ–π.
## üß™ –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä
–î–æ–ø—É—Å—Ç–∏–º, –µ—Å—Ç—å –∫–ª—é—á "user:123".  
–•—ç—à–∏—Ä—É–µ–º ‚Üí –ø–æ–ø–∞–ª–∏ –≤ –ø–æ–∑–∏—Ü–∏—é 52000.  
–°–ª–µ–¥—É—é—â–∏–π —Å–µ—Ä–≤–µ—Ä –ø–æ –∫–æ–ª—å—Ü—É ‚Äî Node3 ‚Üí –∫–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–∞–º.
–ï—Å–ª–∏ Node3 —É–ø–∞–¥—ë—Ç ‚Üí –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–µ–∑–∂–∞—é—Ç –Ω–∞ Node4, –∞ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ —Å–≤–æ–∏—Ö –º–µ—Å—Ç–∞—Ö.
## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ consistent hashing
- üîπ –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —á–∏—Å–ª–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤ –º–µ–Ω—è–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ ~1/n –¥–∞–Ω–Ω—ã—Ö**
- üîπ –•–æ—Ä–æ—à–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏
- üîπ –í—ã—Å–æ–∫–∞—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å
- üîπ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
# üî• 2. –ß—Ç–æ —Ç–∞–∫–æ–µ ¬´–ø—Ä–æ–≥—Ä–µ–≤–∞–Ω–∏–µ –∫–µ—à–∞¬ª (Cache Warm-up / Prewarming)
**–ü—Ä–æ–≥—Ä–µ–≤–∞–Ω–∏–µ –∫—ç—à–∞** ‚Äî —ç—Ç–æ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∫—ç—à–∞ –¥–∞–Ω–Ω—ã–º–∏ **–¥–æ —Ç–æ–≥–æ**, –∫–∞–∫ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–∞—á–Ω—É—Ç –∏—Ö –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å.
–≠—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å:
- Cold start (—Ö–æ–ª–æ–¥–Ω–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞)
- Cache stampede
- –ù–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞
## üìå –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø—Ä–æ–≥—Ä–µ–≤–∞–Ω–∏–µ –∫—ç—à–∞?
‚úî –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –∏–ª–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–∞  
‚úî –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —É–∑–ª–∞ (—á—Ç–æ–±—ã –æ–Ω –Ω–µ –±—ã–ª ‚Äúempty cold node‚Äù)  
‚úî –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –∫—ç—à–µ–π/—à–∞—Ä–¥–æ–≤  
‚úî –ü—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ TTL –¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö –∫–ª—é—á–µ–π
## üìå –ö–∞–∫–∏–µ –±—ã–≤–∞—é—Ç —Ç–µ—Ö–Ω–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ–≤–∞–Ω–∏—è?
### 1. **Load-on-startup**
–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–∏—Å–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –∫ –ë–î/–≤–Ω–µ—à–Ω–µ–º—É —Å–µ—Ä–≤–∏—Å—É ‚Üí –∫—ç—à –Ω–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è.
### 2. **Off-peak warm-up**
–ü—Ä–æ–≥—Ä–µ–≤ –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è –∑–∞—Ä–∞–Ω–µ–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä –Ω–æ—á—å—é, –∫–æ–≥–¥–∞ —Ç—Ä–∞—Ñ–∏–∫ –Ω–∏–∑–∫–∏–π.
### 3. **–°–ø–∏—Å–æ–∫ ‚Äú–≥–æ—Ä—è—á–∏—Ö‚Äù –∫–ª—é—á–µ–π**
–ù–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, top-N –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤) –∑–∞—Ä–∞–Ω–µ–µ –≥—Ä—É–∑—è—Ç—Å—è –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–ª—é—á–∏.
### 4. **Distributed warm-up**
–í –∫–ª–∞—Å—Ç–µ—Ä–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö —É–∑–ª—ã –¥–æ–≥–æ–≤–∞—Ä–∏–≤–∞—é—Ç—Å—è, –∫—Ç–æ –ø—Ä–æ–≥—Ä–µ–≤–∞–µ—Ç –∫–∞–∫—É—é —á–∞—Å—Ç—å –∫—ç—à–∞.
### 5. **Lazy warm-up (–ª–µ–Ω–∏–≤—ã–π)**
–ö—ç—à –ø—Ä–æ–≥—Ä–µ–≤–∞–µ—Ç—Å—è ¬´–ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é¬ª, –Ω–æ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç stampede:
- stale-while-revalidate
- soft TTL
- mutex lock –ø—Ä–∏ miss
## üßä –ß–µ–º –æ–ø–∞—Å–µ–Ω ¬´cold cache¬ª?
–ï—Å–ª–∏ –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ –Ω–µ—Ç –ø—Ä–æ–≥—Ä–µ–≤–∞:
- –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç –Ω–µ –≤ –∫—ç—à, –∞ –≤ –ë–î ‚Üí –≤–Ω–µ–∑–∞–ø–Ω—ã–π —Å–∫–∞—á–æ–∫ –Ω–∞–≥—Ä—É–∑–∫–∏
- –ª–∞–≤–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–∞—è –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è (SLA –ø–∞–¥–∞–µ—Ç)
- —Ä–∏—Å–∫ –ø–µ—Ä–µ–≥—Ä—É–∑–∏—Ç—å –ë–î –¥–æ –æ—Ç–∫–∞–∑–∞
–ü–æ—ç—Ç–æ–º—É **–≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –ø—Ä–æ–≥—Ä–µ–≤ ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –¥–ª—è –≥–æ—Ä—è—á–∏—Ö –¥–∞–Ω–Ω—ã—Ö**.