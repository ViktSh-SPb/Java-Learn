–ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –≤ **Apache Tomcat** –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±–µ—Å–ø–µ—á–∏—Ç—å **–≤—ã—Å–æ–∫—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å (High Availability)** –∏ **–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é —Å–µ—Å—Å–∏–π –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —É–∑–ª–∞–º–∏.
## **1. –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è Tomcat Clustering**
- **–ö–ª–∞—Å—Ç–µ—Ä** ‚Äî –≥—Ä—É–ø–ø–∞ Tomcat-—É–∑–ª–æ–≤ (node), —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö —Å–æ–≤–º–µ—Å—Ç–Ω–æ.
- **–°–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** –º–æ–≥—É—Ç —Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞—Ç—å—Å—è –º–µ–∂–¥—É —É–∑–ª–∞–º–∏.
- **–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–≥—Ä—É–∑–∫–∏ (Load Balancer)** —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –º–µ–∂–¥—É —É–∑–ª–∞–º–∏.
### üîπ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
1. **Nodes** ‚Äî —ç–∫–∑–µ–º–ø–ª—è—Ä—ã Tomcat.
2. **Cluster** ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ `server.xml`, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é.
3. **Manager** ‚Äî —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–µ—Å—Å–∏–∏ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏.
4. **Balancer** ‚Äî –æ–±—ã—á–Ω–æ Apache HTTP Server —Å `mod_jk` –∏–ª–∏ `mod_proxy_balancer` –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–µ LB (NGINX, HAProxy).
## **2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞ –≤ Tomcat**
### üîπ –®–∞–≥ 1: –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `server.xml`
–î–æ–±–∞–≤—å—Ç–µ –≤–Ω—É—Ç—Ä–∏ `<Engine>` —Å–µ–∫—Ü–∏—é `<Cluster>`:
```xml
<Engine name="Catalina" defaultHost="localhost">
    ...
    <Cluster className="org.apache.catalina.ha.tcp.SimpleTcpCluster">
        
        <!-- –°–µ—Ç–µ–≤–æ–π –∫–∞–Ω–∞–ª –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ -->
        <Channel className="org.apache.catalina.tribes.group.GroupChannel">
            <Membership className="org.apache.catalina.tribes.membership.McastService"
                        address="228.0.0.4"
                        port="45564"
                        frequency="500"
                        dropTime="3000"/>
            <Receiver className="org.apache.catalina.tribes.transport.nio.NioReceiver"
                      address="auto"
                      port="4000"
                      autoBind="100"
                      selectorTimeout="5000"
                      maxThreads="6"/>
            <Sender className="org.apache.catalina.tribes.transport.ReplicationTransmitter">
                <Transport className="org.apache.catalina.tribes.transport.nio.PooledParallelSender"/>
            </Sender>
        </Channel>

        <!-- –†–µ–ø–ª–∏–∫–∞—Ü–∏—è —Å–µ—Å—Å–∏–π -->
        <Manager className="org.apache.catalina.ha.session.DeltaManager"
                 expireSessionsOnShutdown="false"
                 notifyListenersOnReplication="true"/>
    </Cluster>
</Engine>
```
**–ü–æ—è—Å–Ω–µ–Ω–∏—è:**

|–≠–ª–µ–º–µ–Ω—Ç|–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ|
|---|---|
|`SimpleTcpCluster`|–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–ª–∞—Å—Ç–µ—Ä–∞ TCP|
|`Channel`|–°–µ—Ç–µ–≤–æ–π –∫–∞–Ω–∞–ª –¥–ª—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π|
|`Membership`|–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º—É–ª—å—Ç–∏–∫–∞—Å—Ç-–∞–¥—Ä–µ—Å–∞ –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —É–∑–ª–æ–≤|
|`Receiver`|–ü—Ä–∏—ë–º–Ω–∏–∫ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–π —Å–µ—Å—Å–∏–π|
|`Sender`|–û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–π –¥—Ä—É–≥–∏–º —É–∑–ª–∞–º|
|`DeltaManager`|–ú–µ–Ω–µ–¥–∂–µ—Ä —Å–µ—Å—Å–∏–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π|
### üîπ –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `engineName` –∏ `jvmRoute`
- –í `<Engine>` –¥–æ–±–∞–≤—å—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π `jvmRoute` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–∑–ª–∞:
```xml
<Engine name="Catalina" defaultHost="localhost" jvmRoute="node1">
```
- `jvmRoute` –Ω—É–∂–µ–Ω –¥–ª—è sticky sessions –Ω–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–µ –Ω–∞–≥—Ä—É–∑–∫–∏.
### üîπ –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏
**–ü—Ä–∏–º–µ—Ä —Å Apache HTTP Server + mod_jk:**
1. –í `workers.properties`:
```
worker.list=tomcat-cluster
worker.tomcat1.port=8009
worker.tomcat1.host=192.168.1.101
worker.tomcat1.type=ajp
worker.tomcat1.lbfactor=1

worker.tomcat2.port=8009
worker.tomcat2.host=192.168.1.102
worker.tomcat2.type=ajp
worker.tomcat2.lbfactor=1

worker.tomcat-cluster.balance_workers=tomcat1,tomcat2
```
2. –í `httpd.conf`:
```apache
LoadModule jk_module modules/mod_jk.so
JkWorkersFile conf/workers.properties
JkMount /myapp/* tomcat-cluster
```
- –ó–∞–ø—Ä–æ—Å—ã `/myapp/*` –±—É–¥—É—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å—Å—è –º–µ–∂–¥—É —É–∑–ª–∞–º–∏ Tomcat.
## **3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞**
1. –†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –≤—Å–µ—Ö —É–∑–ª–∞—Ö.
2. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –∑–∞–π–¥–∏—Ç–µ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ LB.
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
    - **Sticky sessions** ‚Äî —Å–µ—Å—Å–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏.
    - **Failover** ‚Äî –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ –æ–¥–Ω–æ–≥–æ —É–∑–ª–∞ —Å–µ—Å—Å–∏–∏ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –¥—Ä—É–≥–∏—Ö.
4. –ú–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å **–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
    ```
    logs/catalina.out
    ```
## **4. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏ Best Practices**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **DeltaManager**, –µ—Å–ª–∏ —Ç—Ä–∞—Ñ–∏–∫ –≤—ã—Å–æ–∫–∏–π ‚Äî —Ä–µ–ø–ª–∏—Ü–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–π.
- –î–ª—è –±–æ–ª—å—à–∏—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **BackupManager** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–π.
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º—É–ª—å—Ç–∏–∫–∞—Å—Ç-—Å–µ—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **static membership** (—Å–ø–∏—Å–æ–∫ —É–∑–ª–æ–≤ –≤—Ä—É—á–Ω—É—é).
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ **–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –Ω–∞–≥—Ä—É–∑–∫–∏ —Å sticky session**, —á—Ç–æ–±—ã –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ—Å—ã–ª–∫—É —Å–µ—Å—Å–∏–π.
- –°–µ—Å—Å–∏–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã —Ö—Ä–∞–Ω–∏—Ç—å –±–æ–ª—å—à–∏–µ –æ–±—ä—ë–º—ã –¥–∞–Ω–Ω—ã—Ö ‚Äî —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –∑–∞–º–µ–¥–ª—è–µ—Ç —Ä–∞–±–æ—Ç—É.