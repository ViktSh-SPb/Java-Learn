## ðŸ”¹ Ð§Ñ‚Ð¾ Ñ‚Ð°ÐºÐ¾Ðµ CAS (Compare-And-Swap / Compare-And-Set)
**CAS** â€” ÑÑ‚Ð¾ Ð°Ñ‚Ð¾Ð¼Ð°Ñ€Ð½Ð°Ñ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ñ Ð½Ð¸Ð·ÐºÐ¾Ð³Ð¾ ÑƒÑ€Ð¾Ð²Ð½Ñ, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼Ð°Ñ Ð² Ð¼Ð½Ð¾Ð³Ð¾Ð¿Ð¾Ñ‚Ð¾Ñ‡Ð½Ð¾Ð¼ Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ð¸ Ð´Ð»Ñ **Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð¹ Ð±ÐµÐ· Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð¾Ðº**.
- **Ð˜Ð´ÐµÑ:** Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð¹ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐµÑÐ»Ð¸ Ð¾Ð½Ð¾ **Ð½Ðµ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ð»Ð¾ÑÑŒ Ñ Ð¼Ð¾Ð¼ÐµÐ½Ñ‚Ð° Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ¹ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸**.
- Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð² **Ð°Ñ‚Ð¾Ð¼Ð°Ñ€Ð½Ñ‹Ñ… ÐºÐ»Ð°ÑÑÐ°Ñ…** (`AtomicInteger`, `AtomicReference`), Ð½ÐµÐ±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÑŽÑ‰Ð¸Ñ… ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð°Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸ **lock-free Ð°Ð»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼Ð°Ñ…**.
## ðŸ”¹ ÐšÐ°Ðº Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ CAS
CAS Ð¸Ð¼ÐµÐµÑ‚ Ñ‚Ñ€Ð¸ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð°:
1. **memory location** â€” Ð°Ð´Ñ€ÐµÑ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð¹, ÐºÐ¾Ñ‚Ð¾Ñ€ÑƒÑŽ Ñ…Ð¾Ñ‚Ð¸Ð¼ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ.
2. **expected value** â€” Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ, ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ðµ Ð¼Ñ‹ Ð¾Ð¶Ð¸Ð´Ð°ÐµÐ¼ ÑƒÐ²Ð¸Ð´ÐµÑ‚ÑŒ.
3. **new value** â€” Ð½Ð¾Ð²Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ, ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ðµ Ñ…Ð¾Ñ‚Ð¸Ð¼ Ð·Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ.
ÐÐ»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼:

```
ÐµÑÐ»Ð¸ (Ñ‚ÐµÐºÑƒÑ‰ÐµÐµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ == expected value) {
    ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð½Ð¾Ð²Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ
    Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ true
} Ð¸Ð½Ð°Ñ‡Ðµ {
    Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ false
}
```
- Ð•ÑÐ»Ð¸ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ð»Ð°ÑÑŒ Ð´Ñ€ÑƒÐ³Ð¸Ð¼ Ð¿Ð¾Ñ‚Ð¾ÐºÐ¾Ð¼, CAS **Ð½Ðµ Ð¸Ð·Ð¼ÐµÐ½ÑÐµÑ‚ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð¸ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ false**.
- ÐŸÐ¾Ñ‚Ð¾Ðº Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€ÑÐµÑ‚ Ð¿Ð¾Ð¿Ñ‹Ñ‚ÐºÑƒ (loop) Ð´Ð¾ ÑƒÑÐ¿ÐµÑ…Ð° â€” ÑÑ‚Ð¾ Ð½Ð°Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ **spin loop**.
## ðŸ”¹ ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Ð² Java
```java
import java.util.concurrent.atomic.AtomicInteger;

public class CasExample {
    private static AtomicInteger counter = new AtomicInteger(0);

    public static void main(String[] args) {
        Runnable task = () -> {
            for (int i = 0; i < 1000; i++) {
                int oldValue;
                int newValue;
                do {
                    oldValue = counter.get();
                    newValue = oldValue + 1;
                } while (!counter.compareAndSet(oldValue, newValue));
            }
        };

        Thread t1 = new Thread(task);
        Thread t2 = new Thread(task);
        t1.start();
        t2.start();
        try {
            t1.join();
            t2.join();
        } catch (InterruptedException e) { }

        System.out.println("Final count: " + counter.get());
    }
}
```
- `compareAndSet(oldValue, newValue)` â€” CAS Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ñ.
- **Ð‘ÐµÐ· Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð¾Ðº**, Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ Ð´Ð»Ñ Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ñ… Ð¿Ð¾Ñ‚Ð¾ÐºÐ¾Ð².
## ðŸ”¹ ÐŸÑ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð° CAS
1. **Ð‘ÐµÐ· Ð±Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð¾Ðº (Lock-free)** â†’ ÑƒÐ¼ÐµÐ½ÑŒÑˆÐ°ÐµÑ‚ Ð²ÐµÑ€Ð¾ÑÑ‚Ð½Ð¾ÑÑ‚ÑŒ deadlock.
2. **Ð‘Ñ‹ÑÑ‚Ñ€Ð¾Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ** â†’ Ð½ÐµÑ‚ Ð·Ð°Ñ‚Ñ€Ð°Ñ‚ Ð½Ð° ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸ÑŽ Ð¿Ð¾Ñ‚Ð¾ÐºÐ¾Ð² Ñ‡ÐµÑ€ÐµÐ· `synchronized` Ð¸Ð»Ð¸ `Lock`.
3. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð² **Ð°Ñ‚Ð¾Ð¼Ð°Ñ€Ð½Ñ‹Ñ… ÐºÐ»Ð°ÑÑÐ°Ñ… Ð¸ Ð½ÐµÐ±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÑŽÑ‰Ð¸Ñ… ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð°Ñ…** (ConcurrentLinkedQueue, ConcurrentHashMap).
## ðŸ”¹ ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚ÐºÐ¸ CAS
1. **Spin-loop** â†’ Ð²Ñ‹ÑÐ¾ÐºÐ¾Ðµ Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð»ÐµÐ½Ð¸Ðµ CPU Ð¿Ñ€Ð¸ Ð²Ñ‹ÑÐ¾ÐºÐ¾Ð¹ ÐºÐ¾Ð½ÐºÑƒÑ€ÐµÐ½Ñ†Ð¸Ð¸.
2. **ABA-Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð°**: Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ð»Ð°ÑÑŒ Ñ Aâ†’Bâ†’A, CAS ÑÑ‡Ð¸Ñ‚Ð°ÐµÑ‚, Ñ‡Ñ‚Ð¾ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ Ð½Ðµ Ð±Ñ‹Ð»Ð¾.
    - Ð ÐµÑˆÐ°ÐµÑ‚ÑÑ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ `AtomicStampedReference` Ð¸Ð»Ð¸ `AtomicMarkableReference`.
## ðŸ”¹ Ð˜Ñ‚Ð¾Ð³
- **CAS** â€” ÑÑ‚Ð¾ Ð°Ñ‚Ð¾Ð¼Ð°Ñ€Ð½Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ.
- ÐŸÐ¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ñ‚ÑŒ **lock-free Ð¼Ð½Ð¾Ð³Ð¾Ð¿Ð¾Ñ‚Ð¾Ñ‡Ð½Ñ‹Ðµ Ð°Ð»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼Ñ‹**.
- Ð¨Ð¸Ñ€Ð¾ÐºÐ¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð² **Concurrent ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð°Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸ Ð°Ñ‚Ð¾Ð¼Ð°Ñ€Ð½Ñ‹Ñ… Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…**.