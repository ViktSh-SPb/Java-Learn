
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ **DTO-–ø—Ä–æ–µ–∫—Ü–∏–π (Data Transfer Object)** ‚Äî —ç—Ç–æ –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö –Ω–∞–¥—ë–∂–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤ **—É—Å—Ç—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É N+1**, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø—Ä–∏ –ø—Ä–æ–µ–∫—Ü–∏—è—Ö **Hibernate –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –≤–æ–æ–±—â–µ**.  
## üöß –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: —á—Ç–æ —Ç–∞–∫–æ–µ –ø—Ä–æ–±–ª–µ–º–∞ N+1
–ü—Ä–æ–±–ª–µ–º–∞ N+1 –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –∫–æ–≥–¥–∞:
1. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å** –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ N —Å—É—â–Ω–æ—Å—Ç–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `SELECT * FROM authors`),
2. –ó–∞—Ç–µ–º Hibernate **–æ—Ç–¥–µ–ª—å–Ω–æ –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç** –¥–ª—è –∫–∞–∂–¥–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `books`) ‚Äî —Ç–æ –µ—Å—Ç—å **–µ—â—ë N –∑–∞–ø—Ä–æ—Å–æ–≤**.
üí• –í –∏—Ç–æ–≥–µ: **1 (–æ—Å–Ω–æ–≤–Ω–æ–π) + N (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö) = N+1 –∑–∞–ø—Ä–æ—Å**  
–≠—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–∞—Ö –¥–∞–Ω–Ω—ã—Ö.
## üß© –ü–æ—á–µ–º—É DTO-–ø—Ä–æ–µ–∫—Ü–∏–∏ —Ä–µ—à–∞—é—Ç —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É
–ö–æ–≥–¥–∞ —Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –ø—Ä–æ–µ–∫—Ü–∏—é (DTO), Hibernate **–Ω–µ —Å–æ–∑–¥–∞—ë—Ç —Å—É—â–Ω–æ—Å—Ç–∏** (–Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç—ã, –Ω–∞—Ö–æ–¥—è—â–∏–µ—Å—è –ø–æ–¥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏).  
–í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –æ–Ω **–≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–¥–∏–Ω SQL-–∑–∞–ø—Ä–æ—Å**, –∫–æ—Ç–æ—Ä—ã–π:
- –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç (`JOIN`) –≤—Å–µ –Ω—É–∂–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã,
- –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø–æ–ª—è,
- –∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç –∏–º–∏ DTO-–æ–±—ä–µ–∫—Ç.
üëâ Hibernate –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ª–µ–Ω–∏–≤—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏ –Ω–µ –¥–µ–ª–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Äî –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–µ—á–µ–≥–æ "–¥–æ–∑–∞–≥—Ä—É–∂–∞—Ç—å": –¥–∞–Ω–Ω—ã–µ —É–∂–µ —Å–æ–±—Ä–∞–Ω—ã –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ.
## ‚úÖ –ü—Ä–∏–º–µ—Ä —Ä–µ—à–µ–Ω–∏—è N+1 —á–µ—Ä–µ–∑ DTO-–ø—Ä–æ–µ–∫—Ü–∏—é
### ‚ùå –î–æ (N+1 –ø—Ä–æ–±–ª–µ–º–∞)
```java
List<Author> authors = em.createQuery("SELECT a FROM Author a", Author.class)
    .getResultList();

for (Author author : authors) {
    System.out.println(author.getBooks().size()); // <-- –∫–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ –¥–µ–ª–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π SQL!
}
```
üìä –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è:
- 1 –∑–∞–ø—Ä–æ—Å –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É –∞–≤—Ç–æ—Ä–æ–≤,
- N –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É –∏—Ö –∫–Ω–∏–≥.
### ‚úÖ –ü–æ—Å–ª–µ (DTO-–ø—Ä–æ–µ–∫—Ü–∏—è)
```java
@Query("""
    SELECT new com.example.dto.AuthorWithBooksDto(a.id, a.name, b.title)
    FROM Author a
    LEFT JOIN a.books b
""")
List<AuthorWithBooksDto> findAllAuthorsWithBooks();
```
```java
public record AuthorWithBooksDto(Long authorId, String authorName, String bookTitle) {}
```
üìä –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è:
- **–û–¥–∏–Ω SQL-–∑–∞–ø—Ä–æ—Å** —Å JOIN.
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç —Å—Ä–∞–∑—É –≤ –≤–∏–¥–µ DTO, –±–µ–∑ –ª–µ–Ω–∏–≤–æ–π –ø–æ–¥–≥—Ä—É–∑–∫–∏.
## üí° –í–∞—Ä–∏–∞–Ω—Ç—ã DTO-–ø—Ä–æ–µ–∫—Ü–∏–π

|–¢–∏–ø –ø—Ä–æ–µ–∫—Ü–∏–∏|–ü—Ä–∏–º–µ—Ä|–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏|
|---|---|---|
|**–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–Ω–∞—è (DTO Projection)**|`SELECT new com.dto.AuthorDto(a.id, a.name)`|–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∏ —á–∏—Å—Ç—ã–π –ø–æ–¥—Ö–æ–¥|
|**–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω–∞—è (Interface Projection)**|`interface AuthorView { String getName(); }`|–†–∞–±–æ—Ç–∞–µ—Ç –≤ Spring Data JPA|
|**Native SQL + @SqlResultSetMapping**|`@NamedNativeQuery`|–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–∏–±–∫–æ—Å—Ç—å|
|**Record (Java 16+)**|`new AuthorDto(a.id, a.name)`|–ö–æ—Ä–æ—Ç–∫–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ|
## ‚öôÔ∏è –ö–∞–∫ —ç—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è Hibernate

|–ü–æ–≤–µ–¥–µ–Ω–∏–µ|–û–±—ã—á–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏|DTO-–ø—Ä–æ–µ–∫—Ü–∏–∏|
|---|---|---|
|–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏|–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è|‚ùå –ù–µ—Ç|
|–õ–µ–Ω–∏–≤–∞—è –ø–æ–¥–≥—Ä—É–∑–∫–∞|–î–∞ (—á–µ—Ä–µ–∑ proxy)|‚ùå –ù–µ—Ç|
|–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å N+1|–î–∞|‚ùå –ù–µ—Ç|
|–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ SQL|1 + N|1|
|–°–∫–æ—Ä–æ—Å—Ç—å|–°—Ä–µ–¥–Ω—è—è|–í—ã—Å–æ–∫–∞—è|
|–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–Ω–æ—Å—Ç–µ–π|‚úÖ –î–∞|‚ùå –ù–µ—Ç (read-only)|
## ‚ö†Ô∏è –ú–∏–Ω—É—Å—ã DTO-–ø—Ä–æ–µ–∫—Ü–∏–π

|–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫|–ü–æ—è—Å–Ω–µ–Ω–∏–µ|
|---|---|
|‚ùå –ù–µ–ª—å–∑—è –≤—ã–∑—ã–≤–∞—Ç—å `save()` / `merge()`|DTO –Ω–µ —è–≤–ª—è—é—Ç—Å—è —É–ø—Ä–∞–≤–ª—è–µ–º—ã–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏|
|‚ùå –ü–æ—Ç–µ—Ä—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –ª–µ–Ω–∏–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π|–í—Å—ë –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É|
|‚ùå –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏ —Å–ª–æ–∂–Ω—ã—Ö –≥—Ä–∞—Ñ–∞—Ö|–ü—Ä–∏–¥—ë—Ç—Å—è –ø–∏—Å–∞—Ç—å –±–æ–ª—å—à–µ JOIN-–æ–≤|
|‚ùå –ò–Ω–æ–≥–¥–∞ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è —Å—Ç—Ä–æ–∫–∏|–ü—Ä–∏ `OneToMany` ‚Äî –ª—É—á—à–µ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—Ä—É—á–Ω—É—é|
## üí° –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
1. üî∏ –ò—Å–ø–æ–ª—å–∑—É–π DTO-–ø—Ä–æ–µ–∫—Ü–∏–∏ –≤ **read-only –∑–∞–ø—Ä–æ—Å–∞—Ö**, –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è REST API.
2. üî∏ –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –≤—ã–±–æ—Ä–æ–∫ ‚Äî –¥–µ–ª–∞–π **JOIN** —Å—Ä–∞–∑—É –≤—Å–µ—Ö –Ω—É–∂–Ω—ã—Ö —Å–≤—è–∑–µ–π.
3. üî∏ –î–ª—è –±–æ–ª—å—à–∏—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π ‚Äî –¥–æ–±–∞–≤–ª—è–π `DISTINCT` –∏–ª–∏ –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Map<Long, AuthorDto>`).
4. üî∏ –ù–µ –º–µ—à–∞–π DTO –∏ Entity –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Äî Hibernate –Ω–µ –±—É–¥–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å DTO.
5. üî∏ –í Spring Data JPA –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω—ã–µ –ø—Ä–æ–µ–∫—Ü–∏–∏ –±–µ–∑ —è–≤–Ω–æ–≥–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞:
    ```java
    interface AuthorProjection {
        String getName();
        List<BookProjection> getBooks();
    }
    ```
## üß≠ –ò—Ç–æ–≥–æ

|–ö—Ä–∏—Ç–µ—Ä–∏–π|JPA Entity|DTO-–ø—Ä–æ–µ–∫—Ü–∏—è|
|---|---|---|
|–£–ø—Ä–∞–≤–ª—è–µ–º—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏|‚úÖ –î–∞|‚ùå –ù–µ—Ç|
|Lazy loading|‚úÖ –ï—Å—Ç—å|‚ùå –ù–µ—Ç|
|–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å N+1|‚úÖ –ï—Å—Ç—å|‚ùå –ù–µ—Ç|
|–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å|–°—Ä–µ–¥–Ω—è—è|–í—ã—Å–æ–∫–∞—è|
|–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ|CRUD, –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞|API, –æ—Ç—á—ë—Ç—ã, –≤—ã–±–æ—Ä–∫–∏|
