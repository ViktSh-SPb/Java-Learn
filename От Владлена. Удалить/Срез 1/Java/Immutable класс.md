### Что такое immutable класс в Java?

- **Immutable класс** — это класс, объекты которого после создания не могут быть изменены. Все поля объекта являются финальными и не предоставляют методов для их изменения.

---

### Какие преимущества предоставляют неизменяемые классы в Java?

- Простота в использовании и тестировании.
- Потокобезопасность без необходимости синхронизации.
- Надежность и предсказуемость поведения.
- Возможность безопасного использования в многопоточной среде.
- Улучшенная безопасность данных.

---

### Какие основные правила необходимо соблюдать при создании immutable класса в Java?

1. Сделать все поля `private` и `final`.
2. Не предоставлять методы для изменения состояния (нет сеттеров).
3. Инициализировать все поля через конструктор.
4. Не возвращать прямые ссылки на изменяемые внутренние объекты (например, коллекции или массивы) — возвращать их копии.
5. Обеспечить, чтобы подклассы не могли переопределять поведение, нарушающее неизменяемость (например, объявлять класс `final`).

---

### Как можно создать immutable класс, если в нем есть ссылочные поля, которые сами по себе могут быть изменяемыми?

- Делать глубокое копирование ссылочных объектов при присвоении в конструкторе и при возвращении через геттеры:
  - В конструкторе — создавать новые копии переданных объектов.
  - В геттерах — возвращать копии внутренних объектов.
- Использовать неизменяемые типы данных (например, `String`, `Integer`, `Collections.unmodifiableList()`).

---

### Какова роль ключевого слова `final` в создании immutable классов в Java?

- `final` для класса запрещает наследование, что предотвращает изменение поведения подклассами.
- `final` для полей гарантирует, что они могут быть присвоены только один раз (обычно в конструкторе), что обеспечивает неизменность состояния объекта.

---

### Почему важно предоставлять только методы для чтения (getter methods), не предоставляя методов для изменения состояния (setter methods), в immutable классах?

- Это обеспечивает невозможность изменить состояние объекта после его создания, что является основой неизменяемости и потокобезопасности.
- Исключает случайные или намеренные модификации данных, повышая надежность и безопасность.

---

### Как реализовать immutable класс с использованием паттерна Builder в Java?

```java
public final class Person {
    private final String name;
    private final int age;

    private Person(Builder builder) {
        this.name = builder.name;
        this.age = builder.age;
    }

    public String getName() { return name; }
    public int getAge() { return age; }

    public static class Builder {
        private String name;
        private int age;

        public Builder setName(String name) {
            this.name = name;
            return this;
        }

        public Builder setAge(int age) {
            this.age = age;
            return this;
        }

        public Person build() {
            return new Person(this);
        }
    }
}
````

### Можно ли сделать класс immutable, если он содержит массивы, и как это можно сделать?

- Да. Нужно:
    - В конструкторе делать копию массива (`Arrays.copyOf()`).
    - В геттерах возвращать копию массива.

```java
public final class DataContainer {
    private final int[] data;

    public DataContainer(int[] data) {
        this.data = Arrays.copyOf(data, data.length);
    }

    public int[] getData() {
        return Arrays.copyOf(data, data.length);
    }
}
```

### Как обеспечить идемпотентность методов в immutable классах и почему это важно?

- Методы в immutable классах по определению не изменяют состояние объекта; они только возвращают данные или создают новые объекты.
- Это важно для предсказуемости поведения, потокобезопасности и предотвращения побочных эффектов при использовании объектов.