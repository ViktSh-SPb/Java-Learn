## üß© –û–±—â–∞—è –∏–¥–µ—è
Kafka ‚Äî —ç—Ç–æ **—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ (event streaming platform)**, –≥–¥–µ:
- **Producers** –ø—É–±–ª–∏–∫—É—é—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ **—Ç–æ–ø–∏–∫–∏** (topics),
- **Consumers** —á–∏—Ç–∞—é—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ —ç—Ç–∏—Ö —Ç–æ–ø–∏–∫–æ–≤,
- –∞ **–±—Ä–æ–∫–µ—Ä—ã** (Kafka servers) —Ö—Ä–∞–Ω—è—Ç –∏ –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.
## üì® 1Ô∏è‚É£ Producer ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏–π
**Producer** ‚Äî —ç—Ç–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (–∏–ª–∏ —Å–µ—Ä–≤–∏—Å), –∫–æ—Ç–æ—Ä—ã–π **—Å–æ–∑–¥–∞—ë—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Kafka**.
–ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
- –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ **—Ç–æ–ø–∏–∫** (–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∫–∞–Ω–∞–ª),
- –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–º–µ—â–µ–Ω–æ –≤ **–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π —Ä–∞–∑–¥–µ–ª (partition)** —Ç–æ–ø–∏–∫–∞.
### üîπ –ö–∞–∫ Producer –≤—ã–±–∏—Ä–∞–µ—Ç, –≤ –∫–∞–∫–æ–π partition –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å?
Kafka **—Ä–∞–∑–¥–µ–ª—è–µ—Ç** —Ç–æ–ø–∏–∫ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ **partition‚Äô–æ–≤** ‚Äî —ç—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** –∏ **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å**.  
Producer —Ä–µ—à–∞–µ—Ç, –∫—É–¥–∞ –∑–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ, –ø–æ –æ–¥–Ω–æ–º—É –∏–∑ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤:

|–ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–æ—Ä–∞ partition|–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã|
|---|---|
|**Round Robin**|—Å–æ–æ–±—â–µ–Ω–∏—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ partition‚Äô–∞–º|
|**Key-based**|–≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º `key` –ø–æ–ø–∞–¥–∞—é—Ç –≤ –æ–¥–∏–Ω partition|
|**Manual**|—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∞–º —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–æ–º–µ—Ä partition|
üìå _–ü—Ä–∏–º–µ—Ä:_
```java
producer.send(new ProducerRecord<>("orders", "user123", "OrderCreated"));
```
–í—Å–µ —Å–æ–±—ã—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `user123` –±—É–¥—É—Ç –≤ –æ–¥–Ω–æ–º partition ‚Äî –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è.
### üîπ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (acknowledgements)
Kafka –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç **–Ω–∞–¥—ë–∂–Ω—É—é –¥–æ—Å—Ç–∞–≤–∫—É** —Å –ø–æ–º–æ—â—å—é –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `acks`:

|–ü–∞—Ä–∞–º–µ—Ç—Ä|–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç|
|---|---|
|`acks=0`|–Ω–µ –∂–¥–∞—Ç—å –æ—Ç–≤–µ—Ç–∞ –æ—Ç –±—Ä–æ–∫–µ—Ä–∞ (—Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π, –Ω–æ —Ä–∏—Å–∫ –ø–æ—Ç–µ—Ä—å)|
|`acks=1`|–±—Ä–æ–∫–µ—Ä –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å (–±–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç—å/–Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å)|
|`acks=all`|–∂–¥—ë–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç –≤—Å–µ—Ö —Ä–µ–ø–ª–∏–∫ (–Ω–∞–¥–µ–∂–Ω–æ, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ)|
## üì¶ 2Ô∏è‚É£ Broker ‚Äî —Å–µ—Ä–≤–µ—Ä Kafka
–ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ **–ª–æ–≥-—Ñ–∞–π–ª–µ partition‚Äô–∞** –Ω–∞ –¥–∏—Å–∫–µ.  
Kafka ‚Äî —ç—Ç–æ **append-only storage**:
- –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞;
- —Å—Ç–∞—Ä—ã–µ —É–¥–∞–ª—è—é—Ç—Å—è –∏–ª–∏ —Å–∂–∏–º–∞—é—Ç—Å—è –ø–æ –ø–æ–ª–∏—Ç–∏–∫–µ —Ö—Ä–∞–Ω–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, ‚Äú—É–¥–µ—Ä–∂–∏–≤–∞—Ç—å 7 –¥–Ω–µ–π‚Äù).
–ë—Ä–æ–∫–µ—Ä—ã —Ç–∞–∫–∂–µ **—Ä–µ–ø–ª–∏—Ü–∏—Ä—É—é—Ç** –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É —Å–æ–±–æ–π –¥–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏.  
–û–¥–∏–Ω –±—Ä–æ–∫–µ—Ä ‚Äî **–ª–∏–¥–µ—Ä** partition, –¥—Ä—É–≥–∏–µ ‚Äî **—Ä–µ–ø–ª–∏–∫–∏**.
## üì≠ 3Ô∏è‚É£ Consumer ‚Äî –ø–æ–ª—É—á–∞—Ç–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏–π
**Consumer** ‚Äî —ç—Ç–æ –∫–ª–∏–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π **—á–∏—Ç–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è** –∏–∑ –æ–¥–Ω–æ–≥–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–æ–ø–∏–∫–æ–≤.  
–ö–∞–∂–¥—ã–π consumer –∑–Ω–∞–µ—Ç, **—Å –∫–∞–∫–æ–π –ø–æ–∑–∏—Ü–∏–∏ (offset)** –æ–Ω —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ.
### üîπ Offset ‚Äî –ø–æ–∑–∏—Ü–∏—è —á—Ç–µ–Ω–∏—è
–ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ partition –∏–º–µ–µ—Ç **—Å–º–µ—â–µ–Ω–∏–µ (offset)** ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä.  
Consumer —Ö—Ä–∞–Ω–∏—Ç —Å–≤–æ–π **offset**, —á—Ç–æ–±—ã –∑–Ω–∞—Ç—å, –≥–¥–µ –æ–Ω –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è.
üìå _–ü—Ä–∏–º–µ—Ä:_  
–ï—Å–ª–∏ offset = 5, —Ç–æ —Å–ª–µ–¥—É—é—â–∏–π –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–π –±—É–¥–µ—Ç offset = 6.
Kafka –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- **—Å–æ—Ö—Ä–∞–Ω—è—Ç—å offset –≤ Kafka** (–≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º —Ç–æ–ø–∏–∫–µ `__consumer_offsets`);
- **–ø–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∏–≥—Ä–∞—Ç—å —Å–æ–±—ã—Ç–∏—è).
### üîπ Consumer groups
–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –≤ **–≥—Ä—É–ø–ø—ã (consumer groups)** –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è.

|–°—Ü–µ–Ω–∞—Ä–∏–π|–ü–æ–≤–µ–¥–µ–Ω–∏–µ|
|---|---|
|1 consumer group —Å 1 consumer|—á–∏—Ç–∞–µ—Ç –≤—Å–µ partition‚Äô—ã|
|1 consumer group —Å N consumers|partition‚Äô—ã –¥–µ–ª—è—Ç—Å—è –º–µ–∂–¥—É consumers|
|–†–∞–∑–Ω—ã–µ –≥—Ä—É–ø–ø—ã|–∫–∞–∂–¥–∞—è –ø–æ–ª—É—á–∞–µ—Ç **–∫–æ–ø–∏—é –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π**|

üìå _–ü—Ä–∏–º–µ—Ä:_
- –ì—Ä—É–ø–ø–∞ `analytics` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –¥–ª—è –º–µ—Ç—Ä–∏–∫,
- –ì—Ä—É–ø–ø–∞ `notifications` ‚Äî –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.  
    –û–±–µ —á–∏—Ç–∞—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ç–æ–ø–∏–∫ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ.
## üîÑ 4Ô∏è‚É£ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –≤ –¥–µ–π—Å—Ç–≤–∏–∏
```
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ             Kafka Cluster           ‚îÇ
          ‚îÇ                                     ‚îÇ
Producer ‚îÄ‚ñ∫ Topic ‚îÄ‚ñ∫ Partition ‚îÄ‚ñ∫ Partition ... ‚îÇ ‚îÄ‚ñ∫ Consumer Group
          ‚îÇ                                     ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```
1. **Producer** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ `Topic`.
2. **Broker** —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ `Partition`.
3. **Consumer** —Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ, –¥–≤–∏–≥–∞–µ—Ç `offset`.
4. Kafka —Ö—Ä–∞–Ω–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–∞–∂–µ –ø–æ—Å–ª–µ —á—Ç–µ–Ω–∏—è (–º–æ–∂–Ω–æ –ø–µ—Ä–µ—á–∏—Ç—ã–≤–∞—Ç—å).
## ‚öôÔ∏è –ì–∞—Ä–∞–Ω—Ç–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
Kafka –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç—Ä–∏ –º–æ–¥–µ–ª–∏:

|–†–µ–∂–∏–º|–û–ø–∏—Å–∞–Ω–∏–µ|
|---|---|
|**At most once**|—Å–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç –ø–æ—Ç–µ—Ä—è—Ç—å—Å—è, –Ω–æ –Ω–µ –±—É–¥–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è|
|**At least once**|—Å–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ|
|**Exactly once**|–≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è —Ä–æ–≤–Ω–æ –æ–¥–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ (—Å Kafka Streams –∏–ª–∏ transactional producer)|
## üîÅ –ü—Ä–∏–º–µ—Ä –Ω–∞ Java
```java
// Producer
ProducerRecord<String, String> record = new ProducerRecord<>("orders", "user1", "OrderCreated");
producer.send(record);

// Consumer
consumer.subscribe(Collections.singletonList("orders"));
while (true) {
    ConsumerRecords<String, String> records = consumer.poll(Duration.ofMillis(100));
    for (ConsumerRecord<String, String> r : records) {
        System.out.println("Received: " + r.value());
    }
}
```
## üß† –ò—Ç–æ–≥–æ

|–ö–æ–º–ø–æ–Ω–µ–Ω—Ç|–†–æ–ª—å|
|---|---|
|**Producer**|–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ç–æ–ø–∏–∫–∏|
|**Broker**|–•—Ä–∞–Ω–∏—Ç –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è|
|**Consumer**|–ß–∏—Ç–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ —Ç–æ–ø–∏–∫–æ–≤|
|**Offset**|–£–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é —á—Ç–µ–Ω–∏—è|
|**Consumer Group**|–ü–æ–∑–≤–æ–ª—è–µ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π|
