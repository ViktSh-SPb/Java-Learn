### 1. Что такое план запроса в контексте SQL?

План запроса — это внутреннее представление, которое показывает, как СУБД собирается выполнить SQL-запрос. Он включает последовательность операций (сканирование таблиц, соединения, сортировки и т.д.), выбранных оптимизатором для достижения результата с минимальной стоимостью.

---

### 2. Как можно просмотреть план запроса в SQL?

Это зависит от системы управления базами данных (СУБД):

- PostgreSQL:


```sql
EXPLAIN [ANALYZE] SELECT ...;
```

`ANALYZE` выполняет запрос и показывает фактические затраты и время.

- MySQL:


```sql
EXPLAIN SELECT ...;
```

- Oracle:


```sql
EXPLAIN PLAN FOR SELECT ...;
SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
```

- SQL Server:  
    Использует `SET SHOWPLAN_ALL ON` или инструменты графического интерфейса.

---

### 3. Почему важно понимать план запроса при оптимизации запросов?

Понимание плана помогает выявить узкие места:

- Какие операции занимают больше всего времени.
- Используются ли индексы или происходит полное сканирование.
- Есть ли нежелательные соединения или сортировки. Это позволяет принимать меры по улучшению производительности.

---

### 4. Какие типы операций можно найти в плане запроса?

Основные операции:

- Seq Scan (последовательное сканирование) — чтение всей таблицы.
- Index Scan / Index Seek — использование индекса для поиска.
- Bitmap Index Scan — создание битовой карты для быстрого фильтра.
- Join Operations: Nested Loop, Hash Join, Merge Join.
- Sort — сортировка данных.
- Aggregate — группировка и агрегатные функции.
- Filter — фильтрация строк по условию.

---

### 5. Как индексы влияют на план запроса?

Индексы могут:

- Перевести полное сканирование таблицы в индексный поиск, значительно ускоряя выполнение.
- Влиять на выбор типа соединения (например, использование хеш-соединения при наличии индекса).
- Уменьшить количество читаемых страниц и снизить затраты.

Однако неправильное или избыточное использование индексов может привести к ухудшению производительности при вставках/обновлениях.

---

### 6. Какие факторы могут влиять на выбор оптимизатора при составлении плана запроса?

Факторы включают:

- Статистику о данных (количество строк, распределение значений).
- Наличие и типы индексов.
- Размер таблиц и их распределение.
- Конфигурацию системы (память, параллелизм).
- Конкретные параметры оптимизатора (например, cost-based или rule-based).

---

### 7. Какие существуют методы оценки стоимости выполнения запроса?

Общепринятые методы:

- Использование метрик стоимости (`cost`) внутри плана.
- Анализ количества прочитанных страниц (`rows`, `pages`).
- Время выполнения на практике (`EXPLAIN ANALYZE` в PostgreSQL).
- Оценка затрат на CPU и дисковое I/O.

---

### 8. Как можно влиять на выбор плана запроса без изменения самого запроса?

Методы:

- Настройка параметров оптимизатора (например, отключение определённых методов соединения).
- Создание или удаление индексов.
- Обновление статистики (`ANALYZE`).
- Использование подсказок (hints), если поддерживаются системой (например, `OPTION (FORCE ORDER)` в SQL Server).
- Изменение конфигурации памяти и других системных настроек.

---

### 9. Как производится оптимизация запросов на основе плана запроса?

Процесс включает:

1. Анализ плана: выявление дорогих операций.
2. Внесение изменений: добавление индексов, переписывание запросов, изменение условий соединений.
3. Повторный просмотр плана: проверка улучшений.
4. Тестирование производительности: сравнение времени выполнения до и после изменений.

Цель — выбрать наиболее эффективный план с минимальной стоимостью выполнения.