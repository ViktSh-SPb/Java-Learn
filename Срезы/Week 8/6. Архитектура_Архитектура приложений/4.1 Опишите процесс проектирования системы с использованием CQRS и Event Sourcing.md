# ‚≠ê **–û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è**
- **CQRS (Command Query Responsibility Segregation)** ‚Äî —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ **–∫–æ–º–∞–Ω–¥—ã** (–∏–∑–º–µ–Ω–µ–Ω–∏—è) –∏ **–∑–∞–ø—Ä–æ—Å—ã** (—á—Ç–µ–Ω–∏–µ).
- **Event Sourcing** ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã **–Ω–µ –Ω–∞–ø—Ä—è–º—É—é**, –∞ –≤ –≤–∏–¥–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ **—Å–æ–±—ã—Ç–∏–π**, –∫–æ—Ç–æ—Ä—ã–µ –∏–∑–º–µ–Ω—è—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
–ö–æ–º–±–∏–Ω–∞—Ü–∏—è —ç—Ç–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –æ—Å–æ–±–µ–Ω–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞ –¥–ª—è —Å–∏—Å—Ç–µ–º —Å –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π –∏ —Å–ª–æ–∂–Ω–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π.
# üîπ **–®–∞–≥ 1. –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–æ–º–µ–Ω –∏ –≥—Ä–∞–Ω–∏—Ü—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤**
- –†–∞–∑–¥–µ–ª—è–µ–º —Å–∏—Å—Ç–µ–º—É –Ω–∞ **bounded contexts** (DDD).
- –ö–∞–∂–¥–æ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç—É —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π –∞–≥—Ä–µ–≥–∞—Ç –∏ —Å–æ–±—ã—Ç–∏—è.
**–ü—Ä–∏–º–µ—Ä:**  
–°–∏—Å—Ç–µ–º–∞ –±–∞–Ω–∫–∞:
- **AccountContext** ‚Äî –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ —Å—á–µ—Ç–∞–º–∏
- **OrderContext** ‚Äî –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
- **PaymentContext** ‚Äî –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π
# üîπ **–®–∞–≥ 2. –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–º–∞–Ω–¥—ã –∏ —Å–æ–±—ã—Ç–∏—è**
- **Command** ‚Äî –¥–µ–π—Å—Ç–≤–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –∏–∑–º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
- **Event** ‚Äî —Ñ–∞–∫—Ç, –ø—Ä–æ–∏–∑–æ—à–µ–¥—à–∏–π –≤ —Å–∏—Å—Ç–µ–º–µ.
**–ü—Ä–∏–º–µ—Ä:**
- Command: `CreateAccount`, `DepositMoney`
- Event: `AccountCreated`, `MoneyDeposited`
# üîπ **–®–∞–≥ 3. –ü—Ä–æ–µ–∫—Ç–∏—Ä—É–µ–º –º–æ–¥–µ–ª—å –∫–æ–º–∞–Ω–¥ (Write Model)**
- **Write Model** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥—ã.
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∏ —Å–æ–∑–¥–∞—ë—Ç —Å–æ–±—ã—Ç–∏—è.
- –ù–µ —Ö—Ä–∞–Ω–∏—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞–ø—Ä—è–º—É—é (–æ–Ω–æ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∏–∑ —Å–æ–±—ã—Ç–∏–π).
**–ü—Ä–∏–º–µ—Ä –Ω–∞ –ø—Å–µ–≤–¥–æ–∫–æ–¥–µ:**
```kotlin
fun handle(command: DepositMoney): List<Event> {
    if (command.amount <= 0) throw InvalidAmountException()
    return listOf(MoneyDeposited(command.accountId, command.amount))
}
```
# üîπ **–®–∞–≥ 4. –•—Ä–∞–Ω–∏–º —Å–æ–±—ã—Ç–∏—è (Event Store)**
- –í—Å–µ —Å–æ–±—ã—Ç–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ **Event Store** –≤ –ø–æ—Ä—è–¥–∫–µ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è.
- Event Store –º–æ–∂–µ—Ç –±—ã—Ç—å:
    - Kafka
    - PostgreSQL / Event Table
    - —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è (EventStoreDB)
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ö–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ –Ω–µ–∏–∑–º–µ–Ω—è–µ–º–æ
- –°–æ–±—ã—Ç–∏—è –ø–æ–∑–≤–æ–ª—è—é—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≥—Ä–µ–≥–∞—Ç–∞ (replay)
# üîπ **–®–∞–≥ 5. –ü—Ä–æ–µ–∫—Ç–∏—Ä—É–µ–º –º–æ–¥–µ–ª—å —á—Ç–µ–Ω–∏—è (Read Model)**
- **Read Model** —Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–±—ã—Ç–∏–π.
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è **–±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö**, –∞–≥—Ä–µ–≥–∞—Ü–∏–π –∏ –ø—Ä–æ–µ–∫—Ü–∏–π.
- –ú–æ–∂–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –±–∞–∑–µ, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –¥–ª—è —á—Ç–µ–Ω–∏—è (NoSQL, Redis, ElasticSearch).
**–ü—Ä–∏–º–µ—Ä:**
- –°–æ–±—ã—Ç–∏–µ `MoneyDeposited` ‚Üí —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å –≤ Read Model.
- –ó–∞–ø—Ä–æ—Å `GetAccountBalance` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å.
# üîπ **–®–∞–≥ 6. –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –∏ –ø—Ä–æ–µ–∫—Ü–∏–∏**
- Read Model –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è –∏–∑ Event Store –∏ —Å—Ç—Ä–æ–∏—Ç **–ø—Ä–æ–µ–∫—Ü–∏–∏**.
- Event-driven –ø–æ–¥—Ö–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è**.
**–ü—Ä–∏–º–µ—Ä:**
```
EventStore --> EventBus --> ReadModelProjection
```
# üîπ **–®–∞–≥ 7. –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞**
- –í—Å–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ Write Model (Command Handler).
- Read Model **—Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ**, –±–µ–∑ –ª–æ–≥–∏–∫–∏.
# üîπ **–®–∞–≥ 8. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è**
- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–≥—Ä–µ–≥–∞—Ç, Replay –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π –≤ Event Store —Å–æ–∑–¥–∞—ë—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∫ –ª—é–±–æ–º—É –º–æ–º–µ–Ω—Ç—É –≤—Ä–µ–º–µ–Ω–∏ (audit, debug).
# üîπ **–®–∞–≥ 9. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã**
- **Write Model:** Spring Boot, Micronaut, Axon Framework, Kotlin/Java
- **Event Store:** Kafka, EventStoreDB, PostgreSQL —Å —Ç–∞–±–ª–∏—Ü–µ–π —Å–æ–±—ã—Ç–∏–π
- **Read Model:** Redis, MongoDB, ElasticSearch
- **–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è:** Event Bus, Kafka Topics, RabbitMQ
- **CQRS Frameworks:** Axon Framework, Eventuate
# ‚≠ê **–ü–ª—é—Å—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CQRS + Event Sourcing**
1. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å: Read Model –∏ Write Model –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã
2. –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π: audit trail –∏ replay
3. –ì–∏–±–∫–æ—Å—Ç—å: —Ä–∞–∑–Ω—ã–µ –±–∞–∑—ã –¥–ª—è —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏
4. –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å: –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–∑ —Å–æ–±—ã—Ç–∏–π
5. –õ–µ–≥—á–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å—ã –∏ Saga
# ‚≠ê **–ú–∏–Ω—É—Å—ã**
- –°–ª–æ–∂–Ω–µ–µ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
- –°–ª–æ–∂–Ω–æ—Å—Ç—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö (eventual consistency)
- –¢—Ä–µ–±—É–µ—Ç—Å—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è Event Store –∏ Event Bus
- –°–ª–æ–∂–Ω–µ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –¥–µ–±–∞–∂–∏—Ç—å