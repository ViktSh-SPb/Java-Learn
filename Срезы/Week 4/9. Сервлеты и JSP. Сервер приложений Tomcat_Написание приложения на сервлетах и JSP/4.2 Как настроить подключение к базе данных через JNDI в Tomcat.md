Настройка **JNDI-подключения к базе данных** в Tomcat позволяет **централизованно управлять DataSource** и использовать его в веб-приложениях без жесткого кодирования параметров подключения.
## **1. Подготовка JDBC-драйвера**
1. Скачайте JDBC-драйвер для вашей БД (PostgreSQL, MySQL и др.).
2. Поместите JAR-драйвер в папку:
```
<TOMCAT_HOME>\lib
```
> Tomcat будет использовать его для всех приложений.
## **2. Настройка ресурса в Tomcat**
### Шаг 1: Измените `context.xml` глобально или для конкретного приложения
**Глобально**: `<TOMCAT_HOME>\conf\context.xml`  
**Для конкретного приложения**: `<TOMCAT_HOME>\webapps\myapp\META-INF\context.xml`
Пример ресурса для MySQL:
```xml
<Context>
    <Resource name="jdbc/MyDB"
              auth="Container"
              type="javax.sql.DataSource"
              driverClassName="com.mysql.cj.jdbc.Driver"
              url="jdbc:mysql://localhost:3306/mydatabase"
              username="dbuser"
              password="dbpassword"
              maxTotal="20"
              maxIdle="10"
              maxWaitMillis="10000"/>
</Context>
```
**Пояснения параметров:**

|Параметр|Описание|
|---|---|
|`name`|JNDI-имя, через которое приложение обращается к DataSource|
|`auth`|`Container` — Tomcat управляет подключениями|
|`type`|Тип ресурса (для JDBC — `javax.sql.DataSource`)|
|`driverClassName`|Полное имя JDBC-драйвера|
|`url`|URL базы данных|
|`username` / `password`|Данные для подключения|
|`maxTotal`|Максимальное число соединений|
|`maxIdle`|Максимум простаивающих соединений|
|`maxWaitMillis`|Время ожидания соединения из пула|
### Шаг 2: Альтернатива через `server.xml` (необязательно)
```xml
<GlobalNamingResources>
    <Resource name="jdbc/MyDB" auth="Container" type="javax.sql.DataSource"
              driverClassName="com.mysql.cj.jdbc.Driver"
              url="jdbc:mysql://localhost:3306/mydatabase"
              username="dbuser" password="dbpassword"
              maxTotal="20" maxIdle="10" maxWaitMillis="10000"/>
</GlobalNamingResources>
```
- В `context.xml` приложения добавляется ссылка на глобальный ресурс:
```xml
<ResourceLink name="jdbc/MyDB" global="jdbc/MyDB" type="javax.sql.DataSource"/>
```
## **3. Настройка веб-приложения**
В коде Java/Spring приложение получает DataSource через JNDI.
### Пример через стандартный JNDI
```java
Context ctx = new InitialContext();
DataSource ds = (DataSource) ctx.lookup("java:comp/env/jdbc/MyDB");
Connection conn = ds.getConnection();
```
### Spring Boot / Spring Framework
```java
@Bean
public DataSource dataSource() throws NamingException {
    JndiDataSourceLookup dataSourceLookup = new JndiDataSourceLookup();
    return dataSourceLookup.getDataSource("java:comp/env/jdbc/MyDB");
}
```
## **4. Проверка**
1. Перезапустите Tomcat.
2. Убедитесь, что приложение запускается без ошибок.
3. В логах Tomcat (`catalina.out`) можно увидеть успешное создание пула соединений.
4. Попробуйте выполнить простой запрос через приложение.
## **5. Рекомендации**
- Используйте **пул соединений**, чтобы оптимизировать работу с БД.
- Не храните пароль в коде приложения — используйте JNDI.
- Убедитесь, что драйвер JDBC находится в папке `lib`, а не внутри WAR-файла.
- Для разных приложений можно использовать **разные ресурсы** с разными JNDI-именами.