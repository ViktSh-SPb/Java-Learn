В **Java** память разделена на несколько областей, каждая из которых выполняет свою роль в работе приложения.
## Основные области памяти JVM:
### 1. Heap (куча)
**Хранит:**
- Объекты
- Экземпляры классов
- Массивы

**Особенности:**
- Динамически расширяется (можно задать -Xms и -Xmx).
- Делится на *молодое (Young)* и *старое (Old)* поколения (для сборщика мусора).
- *String Pool (пул строк)* хранится в Heap (c Java 7).

**Пример:**
```java
Object obj = new Object(); // объект создается в куче
```
### 2. Stack (стек)
**Хранит:**
- Примитивы
- Ссылки на объекты
- Локальные переменные и фреймы методов

**Особенности:**
- Работает по принципу *LIFO (last in, first out)*
- Каждый поток имеет свой стек
- Быстрый доступ, но ограниченный размер (-Xss).

**Пример:**
```java
int x = 10; // примитив хранится в стеке
String s = "hello"; // ссылка "s" - в стеке, сам объект - в куче
```
### 3. Metaspace (c Java 8, заменил PermGen)
**Хранит:**
- Метаданные классов
- Статические поля
- Константы

**Особенности:**
- Ранее был *PermGen* (до Java 7), но *Metaspace* динамически расширяется в нативной памяти
- Управляется *JVM* автоматически

**Пример:**
```java
static String NAME = "Java"; // статическое поле хранится в Metaspace
```
### 4. Native Memory (Off-Heap)
**Хранит:**
- Память вне управления *JVM* (например, *DirectByteBuffer* в *NIO*)

**Особенности:**
- Используется для работы с файлами, сетью через *JNI*
- Не очищается *GC*, требует ручного управления

**Пример:**
```java
ByteBuffer buffer = ByteBuffer.allocatedDirect(1024); // выделение off-heap памяти
```
### 5. Code Cache (JIT-код)
**Хранит:**
- Скомпилированный машинный код (JIT-оптимизация)

**Особенности:**
- Ускоряет выполнение "горячих" методов
- Размер можно настраивать (-XX: ReservedCodeCacheSize)
### 6. PC Register (Program Counter)
**Хранит:**
- Адрес текущей выполняемой инструкции для каждого потока

**Особенности:**
- Есть у каждого потока
- Недоступен для управления из Java-кода
## Где хранятся примитивы в Java?
### 1. Примитивы как поля объекта (instance variables)
Хранятся внутри объекта в **куче**. Каждый объект в Java размещается в куче и его примитивные поля занимают память прямо внутри структуры этого объекта.
#### Почему примитивы объекта лежат в куче?
- Объекты всегда создаются в куче, а их поля (включая примитивы) являются частью памяти объекта
- Стек используется только для вызова методов и их локальных переменных
### 2. Локальные примитивные переменные (local variables)
Хранятся в **стеке**, если они объявлены внутри метода. Удаляются при завершении метода
### 3. Статические примитивы (static variables)
Хранятся в области памяти **Metaspace**, которая является частью кучи. Существуют на протяжении всей работы программы.