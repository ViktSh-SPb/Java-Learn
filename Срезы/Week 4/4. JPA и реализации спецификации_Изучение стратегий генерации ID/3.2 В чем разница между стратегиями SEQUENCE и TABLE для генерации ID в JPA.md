## ‚öôÔ∏è –û–±—â–∞—è —Ü–µ–ª—å
–û–±–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ ‚Äî **–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç—É (`IDENTITY`)**, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã **Hibernate –∑–Ω–∞–ª –∑–Ω–∞—á–µ–Ω–∏–µ ID –¥–æ `INSERT`**.  
–≠—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è:
- batch-–≤—Å—Ç–∞–≤–æ–∫ (`INSERT ...; INSERT ...;`);
- –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∫—ç—à–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤;
- —Ä–∞–±–æ—Ç—ã —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ `PERSIST` (–¥–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –≤—Å—Ç–∞–≤–∫–∏ –≤ –ë–î).
## üßÆ 1. `GenerationType.SEQUENCE`
### üîπ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç **–º–µ—Ö–∞–Ω–∏–∑–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π (sequence)**, –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.
```java
@Id
@GeneratedValue(strategy = GenerationType.SEQUENCE, generator = "author_seq")
@SequenceGenerator(name = "author_seq", sequenceName = "author_sequence", allocationSize = 1)
private Long id;
```
- Hibernate –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ID **—á–µ—Ä–µ–∑ SQL-–∫–æ–º–∞–Ω–¥—É:**
    ```sql
    select nextval('author_sequence');
    ```
- –ü–æ–ª—É—á–∞–µ—Ç ID, –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç –µ–≥–æ –æ–±—ä–µ–∫—Ç—É.
- –ü–æ—Ç–æ–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç `INSERT` —É–∂–µ —Å –≥–æ—Ç–æ–≤—ã–º ID.
### üîπ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö **–¥–æ–ª–∂–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å** `SEQUENCE` (PostgreSQL, Oracle, H2 –∏ –¥—Ä.).
- –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å `allocationSize` (—Ä–∞–∑–º–µ—Ä –ø—É–ª–∞ ID, –∫—ç—à–∏—Ä—É–µ–º–æ–≥–æ Hibernate –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏).
### üîπ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
‚úÖ –ë—ã—Å—Ç—Ä–æ (–æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ID).  
‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç batch insert (Hibernate –∑–Ω–∞–µ—Ç ID –∑–∞—Ä–∞–Ω–µ–µ).  
‚úÖ –ú–æ–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º ID (`allocationSize`).
### üîπ –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏
‚ö†Ô∏è –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ MySQL –∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å—Ç–∞—Ä—ã—Ö –ë–î.  
‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏—è sequence-–æ–±—ä–µ–∫—Ç–∞ –≤ –ë–î.
## üì¶ 2. `GenerationType.TABLE`
### üîπ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
–≠–º—É–ª–∏—Ä—É–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ **–æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É**,  
–≤ –∫–æ—Ç–æ—Ä–æ–π —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–µ–∫—É—â–∏–π –Ω–æ–º–µ—Ä ID –¥–ª—è –∫–∞–∂–¥–æ–π —Å—É—â–Ω–æ—Å—Ç–∏.
```java
@Id
@GeneratedValue(strategy = GenerationType.TABLE, generator = "table_gen")
@TableGenerator(
    name = "table_gen",
    table = "id_generator",
    pkColumnName = "entity",
    valueColumnName = "next_id",
    pkColumnValue = "Author",
    allocationSize = 1
)
private Long id;
```
**–ü—Ä–∏–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã:**
```sql
create table id_generator (
  entity varchar(50) not null,
  next_id bigint,
  primary key (entity)
);
```
**–ü—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ Hibernate –¥–µ–ª–∞–µ—Ç:**
1. `select next_id from id_generator where entity = 'Author' for update;`
2. `update id_generator set next_id = next_id + 1 where entity = 'Author';`
3. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è `INSERT`.
### üîπ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç **–Ω–∞ –≤—Å–µ—Ö –±–∞–∑–∞—Ö –¥–∞–Ω–Ω—ã—Ö**, –¥–∞–∂–µ –±–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ `SEQUENCE`.  
‚úÖ –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π ID.
### üîπ –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏
‚ö†Ô∏è **–ú–µ–¥–ª–µ–Ω–Ω–µ–µ**, —á–µ–º `SEQUENCE`, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç—Ä–µ–±—É–µ—Ç **–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã**.  
‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º** (lock contention).  
‚ö†Ô∏è –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Ç–∞–±–ª–∏—Ü—É `id_generator`.
## ‚öñÔ∏è –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: `SEQUENCE` vs `TABLE`

|–ö—Ä–∏—Ç–µ—Ä–∏–π|`SEQUENCE`|`TABLE`|
|---|---|---|
|–ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Å—á—ë—Ç—á–∏–∫|–í —Å–∏—Å—Ç–µ–º–Ω–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ë–î|–í –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Ç–∞–±–ª–∏—Ü–µ|
|–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ–º–∏ –ë–î|‚ùå –ù–µ—Ç (—Ç–æ–ª—å–∫–æ –≥–¥–µ –µ—Å—Ç—å SEQUENCE)|‚úÖ –î–∞|
|–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å|üöÄ –í—ã—Å–æ–∫–∞—è|üê¢ –ù–∏–∑–∫–∞—è|
|–ó–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ ID|1|2 (select + update)|
|–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å|–û—Ç–ª–∏—á–Ω–∞—è (–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ sequence)|–ú–æ–∂–µ—Ç —Å—Ç—Ä–∞–¥–∞—Ç—å –æ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫|
|–ü–æ–¥–¥–µ—Ä–∂–∫–∞ batch insert|‚úÖ –î–∞|‚úÖ –î–∞ (–Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ)|
|–ù–∞—Å—Ç—Ä–æ–π–∫–∞|–ß–µ—Ä–µ–∑ `@SequenceGenerator`|–ß–µ—Ä–µ–∑ `@TableGenerator`|
|–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å|PostgreSQL, Oracle, H2|–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è / —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å MySQL|
## üß† –ö—Ä–∞—Ç–∫–æ:
- **`SEQUENCE`** ‚Äî –±—ã—Å—Ç—Ä—ã–π, ‚Äú—Ä–æ–¥–Ω–æ–π‚Äù —Å–ø–æ—Å–æ–± –¥–ª—è –ë–î, –∫–æ—Ç–æ—Ä—ã–µ –µ–≥–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç.
- **`TABLE`** ‚Äî –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç, –∫–æ–≥–¥–∞ –ë–î –Ω–µ —É–º–µ–µ—Ç `SEQUENCE`, –Ω–æ –Ω—É–∂–Ω–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ ‚ÄúID –¥–æ –≤—Å—Ç–∞–≤–∫–∏‚Äù.
### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:
- –ò—Å–ø–æ–ª—å–∑—É–π **`SEQUENCE`**, –µ—Å–ª–∏ –ë–î –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, PostgreSQL, Oracle).
- –ü—Ä–∏–º–µ–Ω—è–π **`TABLE`** **—Ç–æ–ª—å–∫–æ** –¥–ª—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –∏ –Ω–∞ MySQL, –∏ –Ω–∞ PostgreSQL –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ).