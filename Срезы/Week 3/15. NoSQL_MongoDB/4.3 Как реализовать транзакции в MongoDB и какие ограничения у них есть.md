## 1Ô∏è‚É£ **–ß—Ç–æ —Ç–∞–∫–æ–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤ MongoDB**
–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å **–Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∫ –µ–¥–∏–Ω–æ–µ –∞—Ç–æ–º–∞—Ä–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ**.
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–∏–±–æ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é, –ª–∏–±–æ **–æ—Ç–∫–∞—Ç—ã–≤–∞—é—Ç—Å—è (rollback)**.
- –í MongoDB —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ—è–≤–∏–ª–∏—Å—å –Ω–∞—á–∏–Ω–∞—è —Å –≤–µ—Ä—Å–∏–∏ **4.0** –¥–ª—è **Replica Set**, –∞ —Å **4.2** –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ **–º–µ–∂–¥—É —à–∞—Ä–¥–∞–º–∏** (sharded cluster).
üìå –î–æ MongoDB 4.0 –æ–ø–µ—Ä–∞—Ü–∏–∏ –±—ã–ª–∏ –∞—Ç–æ–º–∞—Ä–Ω—ã–º–∏ **—Ç–æ–ª—å–∫–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞**.
## 2Ô∏è‚É£ **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ MongoDB**
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ ACID**: –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å, —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å, –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å, –¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å.
- –ú–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏: `insert`, `update`, `delete`, `findAndModify`.
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å:
    - **–û–¥–Ω–æ–¥–æ–∫—É–º–µ–Ω—Ç–Ω—ã–µ** ‚Äî –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –±–µ–∑ —è–≤–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
    - **–ú–Ω–æ–≥–æ–¥–æ–∫—É–º–µ–Ω—Ç–Ω—ã–µ** ‚Äî —Ç—Ä–µ–±—É—é—Ç —è–≤–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
## 3Ô∏è‚É£ **–ü—Ä–∏–º–µ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å MongoDB Java Driver**
```java
import com.mongodb.client.MongoClient;
import com.mongodb.client.MongoClients;
import com.mongodb.client.MongoCollection;
import com.mongodb.client.MongoDatabase;
import com.mongodb.client.ClientSession;
import org.bson.Document;

public class MongoTransactionExample {
    public static void main(String[] args) {
        try (MongoClient mongoClient = MongoClients.create("mongodb://localhost:27017")) {
            MongoDatabase database = mongoClient.getDatabase("mydatabase");
            MongoCollection<Document> users = database.getCollection("users");
            MongoCollection<Document> accounts = database.getCollection("accounts");

            try (ClientSession session = mongoClient.startSession()) {
                session.startTransaction();

                try {
                    users.insertOne(session, new Document("name", "Alice"));
                    accounts.insertOne(session, new Document("user", "Alice").append("balance", 1000));

                    session.commitTransaction(); // –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
                    System.out.println("–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!");
                } catch (Exception e) {
                    session.abortTransaction(); // –æ—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
                    System.out.println("–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–∫–∞—Ç–∞–Ω–∞: " + e.getMessage());
                }
            }
        }
    }
}
```
‚úÖ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- `startSession()` —Å–æ–∑–¥–∞—ë—Ç —Å–µ—Å—Å–∏—é –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
- `startTransaction()` –Ω–∞—á–∏–Ω–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.
- `commitTransaction()` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è.
- `abortTransaction()` –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
## 4Ô∏è‚É£ **–ü—Ä–∏–º–µ—Ä —Å Spring Data MongoDB**
```java
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.mongodb.MongoTransactionManager;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

@Service
public class UserService {

    @Autowired
    private UserRepository userRepository;

    @Transactional // —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è Spring Data MongoDB
    public void createUserWithAccount(User user, Account account) {
        userRepository.save(user);
        accountRepository.save(account); // –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫ ‚Äî –æ—Ç–∫–∞—Ç–∏—Ç—Å—è
    }
}
```
- Spring –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ —á–µ—Ä–µ–∑ `MongoTransactionManager`.
- –¢—Ä–µ–±—É–µ—Ç **Replica Set** –∏–ª–∏ **Sharded Cluster**.
## 5Ô∏è‚É£ **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ MongoDB**

|–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ|–û–ø–∏—Å–∞–Ω–∏–µ|
|---|---|
|–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ Replica Set –∏–ª–∏ Sharded Cluster|–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ standalone —Å–µ—Ä–≤–µ—Ä–∞—Ö|
|–í—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏|–ú–∞–∫—Å–∏–º—É–º ~60 —Å–µ–∫—É–Ω–¥ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é|
|–†–∞–∑–º–µ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏|–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏: –¥–æ 16 –ú–ë –Ω–∞ –æ–¥–∏–Ω –¥–æ–∫—É–º–µ–Ω—Ç; –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–∞–º—è—Ç—å|
|–ó–∞–¥–µ—Ä–∂–∫–∞ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å|–ú–Ω–æ–≥–æ–¥–æ–∫—É–º–µ–Ω—Ç–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –º–µ–¥–ª–µ–Ω–Ω–µ–µ –æ–¥–Ω–æ–¥–æ–∫—É–º–µ–Ω—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π|
|–û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏|–ü–æ–≤—ã—à–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ lock-—É—Ä–æ–≤–µ–Ω—å –∫–æ–ª–ª–µ–∫—Ü–∏–π|

üìå **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –æ–¥–Ω–∏–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è **–Ω–µ –Ω—É–∂–Ω–∞**, MongoDB —É–∂–µ –∞—Ç–æ–º–∞—Ä–µ–Ω –Ω–∞ —É—Ä–æ–≤–Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞.
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è **–Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏–ª–∏ –∫–æ–ª–ª–µ–∫—Ü–∏–π**.
## 6Ô∏è‚É£ **–ò—Ç–æ–≥**
1. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ MongoDB –ø–æ–∑–≤–æ–ª—è—é—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–π **–∞—Ç–æ–º–∞—Ä–Ω–æ**.
2. –¢—Ä–µ–±—É—é—Ç **Replica Set** –∏–ª–∏ **Sharded Cluster**.
3. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç ACID.
4. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —á–µ—Ä–µ–∑ **ClientSession + startTransaction()** –∏–ª–∏ Spring `@Transactional`.
5. –ò–º–µ—é—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏, –ø–∞–º—è—Ç–∏ –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è.