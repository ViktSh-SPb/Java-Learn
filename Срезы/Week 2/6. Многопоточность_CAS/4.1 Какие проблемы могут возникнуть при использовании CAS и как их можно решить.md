## üîπ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã CAS
### 1Ô∏è‚É£ **ABA-–ø—Ä–æ–±–ª–µ–º–∞**
- **–°—É—Ç—å:** –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –∏–∑ A ‚Üí B ‚Üí A. CAS –¥—É–º–∞–µ—Ç, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å, –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –µ–≥–æ, —Ö–æ—Ç—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π —É–∂–µ –ø—Ä–æ–∏–∑–æ—à–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è.
- **–ü—Ä–∏–º–µ—Ä:**
    1. –ü–æ—Ç–æ–∫ T1 —á–∏—Ç–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `A`.
    2. –ü–æ—Ç–æ–∫ T2 –º–µ–Ω—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ `B`, –ø–æ—Ç–æ–º –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ `A`.
    3. T1 –≤—ã–ø–æ–ª–Ω—è–µ—Ç CAS, –¥—É–º–∞—è, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –≤—Å—ë –µ—â—ë `A` ‚Üí —É—Å–ø–µ—Ö, —Ö–æ—Ç—è –ª–æ–≥–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–µ–Ω–∏–µ —É–∂–µ –º–µ–Ω—è–ª–æ—Å—å.
- **–†–µ—à–µ–Ω–∏–µ:**
    - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **`AtomicStampedReference`**, –≥–¥–µ –≤–º–µ—Å—Ç–µ —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤–µ—Ä—Å–∏—è (stamp).
    - CAS –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ –∑–Ω–∞—á–µ–Ω–∏–µ, –∏ –≤–µ—Ä—Å–∏—é ‚Üí –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç ABA.
```java
AtomicStampedReference<Integer> ref = new AtomicStampedReference<>(0, 0);
```
### 2Ô∏è‚É£ **–í—ã—Å–æ–∫–∞—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏—è –∏ spin-loop**
- **–°—É—Ç—å:** CAS –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ø–æ–ø—ã—Ç–∫—É –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ (spin-loop).
- –ü—Ä–∏ –≤—ã—Å–æ–∫–æ–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ CPU –º–æ–∂–µ—Ç —Ç—Ä–∞—Ç–∏—Ç—å –º–Ω–æ–≥–æ —Ä–µ—Å—É—Ä—Å–æ–≤ –Ω–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.
- **–†–µ—à–µ–Ω–∏–µ:**
    - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **backoff —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏** (–Ω–∞–ø—Ä–∏–º–µ—Ä, Thread.yield(), exponential backoff).
    - –†–∞–∑–¥–µ–ª—è—Ç—å —Ä–∞–±–æ—Ç—É –ø–æ—Ç–æ–∫–æ–≤ –Ω–∞ –º–µ–Ω—å—à–∏–µ –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.
    - –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **Lock** –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏.
### 3Ô∏è‚É£ **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ —Å–ª–æ–∂–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**
- **–°—É—Ç—å:** CAS —Ä–∞–±–æ—Ç–∞–µ—Ç **—Ç–æ–ª—å–∫–æ –Ω–∞ –æ–¥–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –∏–ª–∏ –∞—Ç–æ–º–∞—Ä–Ω–æ–π —Å—Å—ã–ª–∫–µ**.
- –°–ª–æ–∂–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–µ–∫—Ü–∏–∏ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö) —Å–ª–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ CAS.
- **–†–µ—à–µ–Ω–∏–µ:**
    - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–∫–æ–º–±–∏–Ω–∞—Ü–∏—é –∞—Ç–æ–º–∞—Ä–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö**.
    - –î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–µ–∫—Ü–∏–π –≤—Å—ë –∂–µ –ø—Ä–∏–º–µ–Ω—è—Ç—å **ReentrantLock** –∏–ª–∏ `synchronized`
### 4Ô∏è‚É£ **–ü—Ä–æ–±–ª–µ–º—ã —Å —á–∏—Ç–∞–µ–º–æ—Å—Ç—å—é –∏ –æ—Ç–ª–∞–¥–∫–æ–π**
- Lock-free –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Å CAS —á–∞—Å—Ç–æ **—Ç—Ä—É–¥–Ω–µ–µ —á–∏—Ç–∞—Ç—å –∏ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å**, —á–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∏.
- **–†–µ—à–µ–Ω–∏–µ:** —Ö–æ—Ä–æ—à–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Atomic –∫–ª–∞—Å—Å—ã, –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ, –≤–º–µ—Å—Ç–æ —Ä—É—á–Ω–æ–≥–æ CAS.
## üîπ –ò—Ç–æ–≥

|–ü—Ä–æ–±–ª–µ–º–∞|–ü—Ä–∏—á–∏–Ω–∞|–†–µ—à–µ–Ω–∏–µ|
|---|---|---|
|ABA-–ø—Ä–æ–±–ª–µ–º–∞|–ó–Ω–∞—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –∏ –≤–µ—Ä–Ω—É–ª–æ—Å—å –Ω–∞–∑–∞–¥|`AtomicStampedReference` –∏–ª–∏ –≤–µ—Ä—Å–∏–∏ (stamp)|
|Spin-loop –≤—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞|–ú–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–æ–≤ –∫–æ–Ω–∫—É—Ä–∏—Ä—É—é—Ç –∑–∞ CAS|Backoff, yield, —É–º–µ–Ω—å—à–µ–Ω–∏–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏|
|–°–ª–æ–∂–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–µ–∫—Ü–∏–∏|CAS —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –æ–¥–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π|–ö–æ–º–±–∏–Ω–∞—Ü–∏—è –∞—Ç–æ–º–∞—Ä–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–ª–∏ Lock|
|–¢—Ä—É–¥–Ω–æ—Å—Ç—å –æ—Ç–ª–∞–¥–∫–∏|Lock-free –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Å–ª–æ–∂–Ω–æ —á–∏—Ç–∞—Ç—å|–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤—ã—Ö Atomic –∫–ª–∞—Å—Å–æ–≤|
## üîπ Backoff —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏
**Backoff (–æ—Ç—Å—Ç—É–ø–ª–µ–Ω–∏–µ)** ‚Äî —ç—Ç–æ –º–µ—Ç–æ–¥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏ –ø–æ—Ç–æ–∫–æ–≤ –ø—Ä–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏ –∑–∞ —Ä–µ—Å—É—Ä—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ CAS), —á—Ç–æ–±—ã **—É–º–µ–Ω—å—à–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ CPU** –∏ –∏–∑–±–µ–∂–∞—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.
### –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è
1. –ü–æ—Ç–æ–∫ –ø—ã—Ç–∞–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, CAS).
2. –ï—Å–ª–∏ –Ω–µ—É–¥–∞—á–Ω–æ ‚Äî **–Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç —Å—Ä–∞–∑—É**, –∞ –∂–¥—ë—Ç –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è.
3. –ü–æ—Å–ª–µ –ø–∞—É–∑—ã –ø—Ä–æ–±—É–µ—Ç —Å–Ω–æ–≤–∞.
### –í–∏–¥—ã backoff
1. **Fixed backoff**
    - –ñ–¥—ë–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏.
    - –ü—Ä–æ—Å—Ç–æ–π, –Ω–æ –Ω–µ –≤—Å–µ–≥–¥–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π.
2. **Exponential backoff**
    - –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –Ω–µ—É–¥–∞—á–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏:
        ```
        waitTime = base * 2^n
        ```
    - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ —Å–µ—Ç–µ–≤—ã—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–∞—Ö –∏ lock-free –∞–ª–≥–æ—Ä–∏—Ç–º–∞—Ö.
3. **Randomized backoff**
    - –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è —Å–ª—É—á–∞–π–Ω–æ–µ –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ.
    - –ü–æ–º–æ–≥–∞–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Ç–æ–∫–æ–≤.
### –ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ backoff –ø—Ä–∏ CAS
```java
int retries = 0;
while (!atomicVar.compareAndSet(oldValue, newValue)) {
    retries++;
    try {
        Thread.sleep((long)(Math.random() * Math.pow(2, retries)));
    } catch (InterruptedException e) { }
}
```
- –ö–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ CAS –Ω–µ—É–¥–∞—á–Ω–∞, –ø–æ—Ç–æ–∫ –∂–¥—ë—Ç –Ω–µ–º–Ω–æ–≥–æ –¥–æ–ª—å—à–µ.
- –£–º–µ–Ω—å—à–∞–µ—Ç **spin-loop –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ CPU**.