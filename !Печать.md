# Stateless vs Stateful Operations in Stream API

В Java Stream API операции делятся на два основных типа: **stateless** (без состояния) и **stateful** (с состоянием). Это различие важно для понимания производительности и поведения потоков.

## Stateless Operations (Без состояния)

Stateless операции не зависят от состояния других элементов потока при обработке каждого элемента. Каждый элемент обрабатывается независимо.

**Характеристики:**
- Могут обрабатывать элементы параллельно без дополнительных накладных расходов
- Не требуют хранения информации о предыдущих элементах
- Обычно более эффективны

**Примеры stateless операций:**
- `filter()` - фильтрация элементов
- `map()` - преобразование элементов
- `flatMap()` - "разворачивание" потоков
- `peek()` - выполнение действия для каждого элемента

```java
list.stream()
    .filter(x -> x > 10)    // stateless
    .map(x -> x * 2)        // stateless
    .forEach(System.out::println);
```

## Stateful Operations (С состоянием)

Stateful операции зависят от состояния других элементов потока или требуют знания о других элементах для выполнения своей работы.

**Характеристики:**
- Могут требовать обработки всего потока перед выполнением операции
- Часто требуют дополнительной памяти для хранения состояния
- Могут снижать производительность, особенно в параллельных потоках

**Примеры stateful операций:**
- `distinct()` - удаление дубликатов
- `sorted()` - сортировка элементов
- `limit()` - ограничение количества элементов
- `skip()` - пропуск первых элементов

```java
list.stream()
    .distinct()             // stateful
    .sorted()               // stateful
    .limit(5)              // stateful
    .forEach(System.out::println);
```

## Особенности использования

1. **Порядок операций**: Оптимально располагать stateless операции перед stateful, чтобы уменьшить объем данных для stateful обработки.

2. **Параллельные потоки**: Stateful операции могут значительно снизить производительность параллельных потоков из-за необходимости синхронизации.

3. **Повторное использование**: Потоки нельзя использовать повторно, особенно после stateful операций.

Понимание различий между stateless и stateful операциями помогает писать более эффективный и производительный код при работе с Stream API.